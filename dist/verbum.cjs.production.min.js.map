{"version":3,"file":"verbum.cjs.production.min.js","sources":["../src/nodes/EmojiNode.tsx","../node_modules/style-inject/dist/style-inject.es.js","../src/ui/EquationEditor.tsx","../src/ui/KatexRenderer.tsx","../src/nodes/EquationNode.tsx","../src/collaboration.ts","../src/appSettings.ts","../src/context/SettingsContext.tsx","../src/context/SharedHistoryContext.tsx","../src/plugins/EmojisPlugin.ts","../src/shared-ts/src/getDOMSelection.ts","../src/plugins/ImagesPlugin.ts","../src/nodes/KeywordNode.ts","../src/plugins/KeywordsPlugin.ts","../src/shared/src/canUseDOM.ts","../src/shared/src/useLayoutEffect.ts","../src/nodes/MentionNode.ts","../src/plugins/MentionsPlugin.tsx","../src/plugins/TableActionMenuPlugin.tsx","../src/plugins/TreeViewPlugin.tsx","../src/ui/ContentEditable.tsx","../src/ui/ImageResizer.tsx","../src/ui/Placeholder.tsx","../src/nodes/ImageNode.tsx","../src/utils/join-classes.ts","../src/ui/Button.tsx","../src/nodes/PollNode.tsx","../src/themes/PlaygroundEditorTheme.ts","../src/themes/StickyEditorTheme.ts","../src/nodes/StickyNode.tsx","../src/nodes/TweetNode.tsx","../src/nodes/TypeaheadNode.ts","../src/nodes/YouTubeNode.tsx","../src/nodes/PlaygroundNodes.ts","../src/ui/Modal.tsx","../src/hooks/useModal.tsx","../src/plugins/MarkdownTransformers.ts","../src/hooks/useReport.ts","../src/plugins/SpeechToTextPlugin.ts","../src/plugins/ActionsPlugin.tsx","../src/plugins/AutoLinkPlugin.tsx","../src/plugins/CommentPlugin.tsx","../src/plugins/CharacterStylesPopupPlugin.tsx","../src/plugins/ClickableLinkPlugin.ts","../src/plugins/CodeHighlightPlugin.ts","../src/plugins/ListMaxIndentLevelPlugin.ts","../src/plugins/MarkdownShortcutPlugin.tsx","../src/plugins/TabFocusPlugin.tsx","../src/context/EditorContext.tsx","../src/utils/node.util.ts","../src/context/ToolbarContext.tsx","../src/ui/DropDown.tsx","../src/plugins/ToolbarPlugin/components/AlignDropdown.tsx","../src/ui/TextInput.tsx","../src/ui/FileInput.tsx","../src/plugins/EquationsPlugin.ts","../src/plugins/YouTubePlugin.ts","../src/ui/KatexEquationAlterer.tsx","../src/plugins/TableCellResizer.tsx","../src/plugins/HorizontalRulePlugin.ts","../src/plugins/ToolbarPlugin/components/InsertDropdown.tsx","../src/shared/src/environment.ts","../src/plugins/ToolbarPlugin/components/UndoButton.tsx","../src/plugins/ToolbarPlugin/components/RedoButton.tsx","../src/ui/Select.tsx","../src/plugins/ToolbarPlugin/components/CodeLanguageDropdown.tsx","../src/plugins/ToolbarPlugin/components/BlockFormatDropdown.tsx","../src/ui/Divider.tsx","../src/plugins/ToolbarPlugin/ToolbarPlugin.tsx","../src/ui/ColorPicker.tsx","../src/ui/LinkPreview.tsx","../src/plugins/ToolbarPlugin/components/FloatingLinkEditor.tsx","../src/plugins/ToolbarPlugin/components/FontFamilyDropdown.tsx","../src/plugins/ToolbarPlugin/components/FontSizeDropdown.tsx","../src/plugins/ToolbarPlugin/components/BackgroundColorPicker.tsx","../src/plugins/ToolbarPlugin/components/BoldButton.tsx","../src/plugins/ToolbarPlugin/components/CodeFormatButton.tsx","../src/Editor.tsx","../src/EditorComposer.tsx","../src/plugins/ToolbarPlugin/components/InsertLinkButton.tsx","../src/plugins/ToolbarPlugin/components/ItalicButton.tsx","../src/plugins/ToolbarPlugin/components/TextColorPicker.tsx","../src/plugins/ToolbarPlugin/components/TextFormatDropdown.tsx","../src/plugins/ToolbarPlugin/components/UnderlineButton.tsx"],"sourcesContent":["/**\n * Copyright (c) Meta Platforms, Inc. and affiliates.\n *\n * This source code is licensed under the MIT license found in the\n * LICENSE file in the root directory of this source tree.\n *\n */\n\nimport React from 'react';\n\nimport type { EditorConfig, LexicalNode, NodeKey } from 'lexical';\n\nimport SerializedTextNode from 'lexical';\n\nimport { Spread } from 'globals';\nimport { TextNode } from 'lexical';\n\nexport type SerializedEmojiNode = Spread<\n  {\n    className: string;\n    type: 'emoji';\n  },\n  typeof SerializedTextNode\n>;\n\nlet __className: string = 'EmojiNode';\nexport class EmojiNode extends TextNode {\n  static getType(): string {\n    return 'emoji';\n  }\n\n  static clone(node: EmojiNode): EmojiNode {\n    return new EmojiNode(__className, node.__text, node.__key);\n  }\n\n  constructor(className: string, text: string, key?: NodeKey) {\n    super(text, key);\n    __className = className;\n  }\n\n  createDOM(config: EditorConfig): HTMLElement {\n    const dom = document.createElement('span');\n    const inner = super.createDOM(config);\n    dom.className = __className;\n    inner.className = 'emoji-inner';\n    dom.appendChild(inner);\n    return dom;\n  }\n\n  updateDOM(\n    prevNode: TextNode,\n    dom: HTMLElement,\n    config: EditorConfig\n  ): boolean {\n    const inner = dom.firstChild;\n    if (inner === null) {\n      return true;\n    }\n    super.updateDOM(prevNode, inner as HTMLElement, config);\n    return false;\n  }\n\n  static importJSON(serializedNode: SerializedEmojiNode): EmojiNode {\n    const node = $createEmojiNode(\n      serializedNode.className,\n      serializedNode.text\n    );\n    node.setFormat(serializedNode.format);\n    node.setDetail(serializedNode.detail);\n    node.setMode(serializedNode.mode);\n    node.setStyle(serializedNode.style);\n    return node;\n  }\n\n  exportJSON(): SerializedEmojiNode {\n    return {\n      ...super.exportJSON(),\n      className: this.getClassName(),\n      type: 'emoji',\n    };\n  }\n\n  getClassName(): string {\n    const self = this.getLatest();\n    return self.__className;\n  }\n}\n\nexport function $isEmojiNode(\n  node: LexicalNode | null | undefined\n): node is EmojiNode {\n  return node instanceof EmojiNode;\n}\n\nexport function $createEmojiNode(\n  className: string,\n  emojiText: string\n): EmojiNode {\n  return new EmojiNode(className, emojiText).setMode('token');\n}\n","function styleInject(css, ref) {\n  if ( ref === void 0 ) ref = {};\n  var insertAt = ref.insertAt;\n\n  if (!css || typeof document === 'undefined') { return; }\n\n  var head = document.head || document.getElementsByTagName('head')[0];\n  var style = document.createElement('style');\n  style.type = 'text/css';\n\n  if (insertAt === 'top') {\n    if (head.firstChild) {\n      head.insertBefore(style, head.firstChild);\n    } else {\n      head.appendChild(style);\n    }\n  } else {\n    head.appendChild(style);\n  }\n\n  if (style.styleSheet) {\n    style.styleSheet.cssText = css;\n  } else {\n    style.appendChild(document.createTextNode(css));\n  }\n}\n\nexport default styleInject;\n","/**\n * Copyright (c) Meta Platforms, Inc. and affiliates.\n *\n * This source code is licensed under the MIT license found in the\n * LICENSE file in the root directory of this source tree.\n *\n */\n\nimport './EquationEditor.css';\n\nimport * as React from 'react';\nimport { ChangeEvent, RefObject } from 'react';\n\ntype BaseEquationEditorProps = {\n  equation: string;\n  inline: boolean;\n  inputRef: { current: null | HTMLInputElement | HTMLTextAreaElement };\n  setEquation: (string) => void;\n};\n\nexport default function EquationEditor({\n  equation,\n  setEquation,\n  inline,\n  inputRef,\n}: BaseEquationEditorProps): JSX.Element {\n  const onChange = (event) => {\n    setEquation(event.target.value);\n  };\n\n  const props = {\n    equation,\n    inputRef,\n    onChange,\n  };\n\n  return inline ? (\n    <InlineEquationEditor\n      {...props}\n      inputRef={inputRef as RefObject<HTMLInputElement>}\n    />\n  ) : (\n    <BlockEquationEditor\n      {...props}\n      inputRef={inputRef as RefObject<HTMLTextAreaElement>}\n    />\n  );\n}\n\ntype EquationEditorImplProps = {\n  equation: string;\n  inputRef: { current: null | HTMLInputElement };\n  onChange: (event: ChangeEvent<HTMLInputElement>) => void;\n};\n\nfunction InlineEquationEditor({\n  equation,\n  onChange,\n  inputRef,\n}: EquationEditorImplProps): JSX.Element {\n  return (\n    <span className=\"EquationEditor_inputBackground\">\n      <span className=\"EquationEditor_dollarSign\">$</span>\n      <input\n        className=\"EquationEditor_inlineEditor\"\n        value={equation}\n        onChange={onChange}\n        autoFocus={true}\n        ref={inputRef}\n      />\n      <span className=\"EquationEditor_dollarSign\">$</span>\n    </span>\n  );\n}\n\ntype BlockEquationEditorImplProps = {\n  equation: string;\n  inputRef: { current: null | HTMLTextAreaElement };\n  onChange: (event: ChangeEvent<HTMLTextAreaElement>) => void;\n};\n\nfunction BlockEquationEditor({\n  equation,\n  onChange,\n  inputRef,\n}: BlockEquationEditorImplProps): JSX.Element {\n  return (\n    <div className=\"EquationEditor_inputBackground\">\n      <span className=\"EquationEditor_dollarSign\">{'$$\\n'}</span>\n      <textarea\n        className=\"EquationEditor_blockEditor\"\n        value={equation}\n        onChange={onChange}\n        ref={inputRef}\n      />\n      <span className=\"EquationEditor_dollarSign\">{'\\n$$'}</span>\n    </div>\n  );\n}\n","/**\n * Copyright (c) Meta Platforms, Inc. and affiliates.\n *\n * This source code is licensed under the MIT license found in the\n * LICENSE file in the root directory of this source tree.\n *\n */\n\nimport katex from 'katex';\nimport * as React from 'react';\nimport { useEffect, useRef } from 'react';\n\nexport default function KatexRenderer({\n  equation,\n  inline,\n  onClick,\n}: Readonly<{\n  equation: string;\n  inline: boolean;\n  onClick: () => void;\n}>): JSX.Element {\n  const katexElementRef = useRef(null);\n\n  useEffect(() => {\n    const katexElement = katexElementRef.current;\n\n    if (katexElement !== null) {\n      katex.render(equation, katexElement, {\n        displayMode: !inline, // true === block display //\n        errorColor: '#cc0000',\n        output: 'html',\n        strict: 'warn',\n        throwOnError: false,\n        trust: false,\n      });\n    }\n  }, [equation, inline]);\n\n  return (\n    // We use spacers either side to ensure Android doesn't try and compose from the\n    // inner text from Katex. There didn't seem to be any other way of making this work,\n    // without having a physical space.\n    <>\n      <span className=\"spacer\"> </span>\n      <span\n        role=\"button\"\n        tabIndex={-1}\n        onClick={onClick}\n        ref={katexElementRef}\n      />\n      <span className=\"spacer\"> </span>\n    </>\n  );\n}\n","/**\n * Copyright (c) Meta Platforms, Inc. and affiliates.\n *\n * This source code is licensed under the MIT license found in the\n * LICENSE file in the root directory of this source tree.\n *\n */\n\nimport type {\n  EditorConfig,\n  LexicalNode,\n  NodeKey,\n  SerializedLexicalNode,\n} from 'lexical';\n\nimport { useLexicalComposerContext } from '@lexical/react/LexicalComposerContext';\nimport { mergeRegister } from '@lexical/utils';\nimport {\n  $getNodeByKey,\n  COMMAND_PRIORITY_HIGH,\n  DecoratorNode,\n  KEY_ESCAPE_COMMAND,\n  SELECTION_CHANGE_COMMAND,\n} from 'lexical';\nimport { Spread } from 'libdefs/globals';\nimport * as React from 'react';\nimport { useCallback, useEffect, useRef, useState } from 'react';\n\nimport EquationEditor from '../ui/EquationEditor';\nimport KatexRenderer from '../ui/KatexRenderer';\n\ntype EquationComponentProps = {\n  equation: string;\n  inline: boolean;\n  nodeKey: NodeKey;\n};\n\nfunction EquationComponent({\n  equation,\n  inline,\n  nodeKey,\n}: EquationComponentProps): JSX.Element {\n  const [editor] = useLexicalComposerContext();\n  const [equationValue, setEquationValue] = useState(equation);\n  const [showEquationEditor, setShowEquationEditor] = useState<boolean>(false);\n  const inputRef = useRef(null);\n\n  const onHide = useCallback(\n    (restoreSelection?: boolean) => {\n      setShowEquationEditor(false);\n      editor.update(() => {\n        const node = $getNodeByKey(nodeKey);\n        if ($isEquationNode(node)) {\n          node.setEquation(equationValue);\n          if (restoreSelection) {\n            node.selectNext(0, 0);\n          }\n        }\n      });\n    },\n    [editor, equationValue, nodeKey]\n  );\n\n  useEffect(() => {\n    if (showEquationEditor) {\n      return mergeRegister(\n        editor.registerCommand(\n          SELECTION_CHANGE_COMMAND,\n          (payload) => {\n            const activeElement = document.activeElement;\n            const inputElem = inputRef.current;\n            if (inputElem !== activeElement) {\n              onHide();\n            }\n            return false;\n          },\n          COMMAND_PRIORITY_HIGH\n        ),\n        editor.registerCommand(\n          KEY_ESCAPE_COMMAND,\n          (payload) => {\n            const activeElement = document.activeElement;\n            const inputElem = inputRef.current;\n            if (inputElem === activeElement) {\n              onHide(true);\n              return true;\n            }\n            return false;\n          },\n          COMMAND_PRIORITY_HIGH\n        )\n      );\n    }\n  }, [editor, onHide, showEquationEditor]);\n\n  return (\n    <>\n      {showEquationEditor ? (\n        <EquationEditor\n          equation={equationValue}\n          setEquation={setEquationValue}\n          inline={inline}\n          inputRef={inputRef}\n        />\n      ) : (\n        <KatexRenderer\n          equation={equationValue}\n          inline={inline}\n          onClick={() => {\n            setShowEquationEditor(true);\n          }}\n        />\n      )}\n    </>\n  );\n}\n\nexport type SerializedEquationNode = Spread<\n  {\n    type: 'equation';\n    equation: string;\n    inline: boolean;\n  },\n  SerializedLexicalNode\n>;\n\nexport class EquationNode extends DecoratorNode<JSX.Element> {\n  __equation: string;\n  __inline: boolean;\n\n  static getType(): string {\n    return 'equation';\n  }\n\n  static clone(node: EquationNode): EquationNode {\n    return new EquationNode(node.__equation, node.__inline, node.__key);\n  }\n\n  constructor(equation: string, inline?: boolean, key?: NodeKey) {\n    super(key);\n    this.__equation = equation;\n    this.__inline = inline ?? false;\n  }\n\n  static importJSON(serializedNode: SerializedEquationNode): EquationNode {\n    const node = $createEquationNode(\n      serializedNode.equation,\n      serializedNode.inline\n    );\n    return node;\n  }\n\n  exportJSON(): SerializedEquationNode {\n    return {\n      equation: this.getEquation(),\n      inline: this.__inline,\n      type: 'equation',\n      version: 1,\n    };\n  }\n\n  createDOM(_config: EditorConfig): HTMLElement {\n    return document.createElement(this.__inline ? 'span' : 'div');\n  }\n\n  updateDOM(prevNode: EquationNode): boolean {\n    // If the inline property changes, replace the element\n    return this.__inline !== prevNode.__inline;\n  }\n\n  getEquation(): string {\n    return this.__equation;\n  }\n\n  setEquation(equation: string): void {\n    const writable = this.getWritable();\n    writable.__equation = equation;\n  }\n\n  decorate(): JSX.Element {\n    return (\n      <EquationComponent\n        equation={this.__equation}\n        inline={this.__inline}\n        nodeKey={this.__key}\n      />\n    );\n  }\n}\n\nexport function $createEquationNode(\n  equation = '',\n  inline = false\n): EquationNode {\n  const equationNode = new EquationNode(equation, inline);\n  return equationNode;\n}\n\nexport function $isEquationNode(\n  node: LexicalNode | null | undefined\n): node is EquationNode {\n  return node instanceof EquationNode;\n}\n","/**\n * Copyright (c) Meta Platforms, Inc. and affiliates.\n *\n * This source code is licensed under the MIT license found in the\n * LICENSE file in the root directory of this source tree.\n *\n */\n\nimport { WebsocketProvider } from 'y-websocket';\nimport { Doc } from 'yjs';\n\nconst url = new URL(window.location.href);\nconst params = new URLSearchParams(url.search);\nconst WEBSOCKET_ENDPOINT = 'ws://localhost:1234';\nconst WEBSOCKET_SLUG = 'playground';\nconst WEBSOCKET_ID = params.get('collabId') || '0';\n\n// parent dom -> child doc\nexport function createWebsocketProvider(\n  id: string,\n  yjsDocMap: Map<string, Doc>\n): WebsocketProvider {\n  let doc = yjsDocMap.get(id);\n\n  if (doc === undefined) {\n    doc = new Doc();\n    yjsDocMap.set(id, doc);\n  } else {\n    doc.load();\n  }\n\n  return new WebsocketProvider(\n    WEBSOCKET_ENDPOINT,\n    WEBSOCKET_SLUG + '/' + WEBSOCKET_ID + '/' + id,\n    doc,\n    {\n      connect: false,\n    }\n  );\n}\n","/**\n * Copyright (c) Meta Platforms, Inc. and affiliates.\n *\n * This source code is licensed under the MIT license found in the\n * LICENSE file in the root directory of this source tree.\n *\n */\n\nexport type SettingName =\n  | 'disableBeforeInput'\n  | 'measureTypingPerf'\n  | 'isRichText'\n  | 'isCollab'\n  | 'isCharLimit'\n  | 'isCharLimitUtf8'\n  | 'isAutocomplete'\n  | 'showTreeView'\n  | 'showNestedEditorTreeView'\n  | 'emptyEditor';\n\nexport type Settings = Record<SettingName, boolean>;\n\nconst hostName = window.location.hostname;\nexport const isDevPlayground: boolean =\n  hostName !== 'playground.lexical.dev' &&\n  hostName !== 'lexical-playground.vercel.app';\n\nexport const DEFAULT_SETTINGS: Settings = {\n  disableBeforeInput: false,\n  emptyEditor: isDevPlayground,\n  isAutocomplete: false,\n  isCharLimit: false,\n  isCharLimitUtf8: false,\n  isCollab: false,\n  isRichText: true,\n  measureTypingPerf: false,\n  showNestedEditorTreeView: false,\n  showTreeView: true,\n};\n","/**\n * Copyright (c) Meta Platforms, Inc. and affiliates.\n *\n * This source code is licensed under the MIT license found in the\n * LICENSE file in the root directory of this source tree.\n *\n */\n\nimport type { SettingName } from '../appSettings';\n\nimport * as React from 'react';\nimport {\n  createContext,\n  useCallback,\n  useContext,\n  useMemo,\n  useState,\n} from 'react';\n\nimport { DEFAULT_SETTINGS } from '../appSettings';\n\ntype SettingsContextShape = {\n  setOption: (name: SettingName, value: boolean) => void;\n  settings: Record<SettingName, boolean>;\n};\n\nconst Context: React.Context<SettingsContextShape> = createContext({\n  setOption: (name: SettingName, value: boolean) => {\n    return;\n  },\n  settings: DEFAULT_SETTINGS,\n});\n\nexport const SettingsContext = ({\n  children,\n}: {\n  children: JSX.Element | string | (JSX.Element | string)[];\n}): JSX.Element => {\n  const [settings, setSettings] = useState(DEFAULT_SETTINGS);\n  const setOption = useCallback((setting: SettingName, value: boolean) => {\n    setSettings((options) => ({\n      ...options,\n      [setting as string]: value,\n    }));\n    if (DEFAULT_SETTINGS[setting] === value) {\n      setURLParam(setting, null);\n    } else {\n      setURLParam(setting, value);\n    }\n  }, []);\n  const contextValue = useMemo(() => {\n    return { setOption, settings };\n  }, [setOption, settings]);\n  return <Context.Provider value={contextValue}>{children}</Context.Provider>;\n};\n\nexport const useSettings = (): SettingsContextShape => {\n  return useContext(Context);\n};\n\nfunction setURLParam(param: SettingName, value: null | boolean) {\n  const url = new URL(window.location.href);\n  const params = new URLSearchParams(url.search);\n  if (value !== null) {\n    if (params.has(param)) {\n      params.set(param, String(value));\n    } else {\n      params.append(param, String(value));\n    }\n  } else {\n    if (params.has(param)) {\n      params.delete(param);\n    }\n  }\n  url.search = params.toString();\n  window.history.pushState(null, '', url.toString());\n}\n","/**\n * Copyright (c) Meta Platforms, Inc. and affiliates.\n *\n * This source code is licensed under the MIT license found in the\n * LICENSE file in the root directory of this source tree.\n *\n */\n\nimport type { HistoryState } from '@lexical/react/LexicalHistoryPlugin';\n\nimport { createEmptyHistoryState } from '@lexical/react/LexicalHistoryPlugin';\nimport * as React from 'react';\nimport { createContext, useContext, useMemo } from 'react';\n\ntype ContextShape = {\n  historyState: HistoryState;\n};\n\nconst Context: React.Context<ContextShape> = createContext({\n  historyState: { current: null, redoStack: [], undoStack: [] },\n});\n\nexport const SharedHistoryContext = ({\n  children,\n}: {\n  children: JSX.Element | string | (JSX.Element | string)[];\n}): JSX.Element => {\n  const historyContext = useMemo(\n    () => ({ historyState: createEmptyHistoryState() }),\n    []\n  );\n  return <Context.Provider value={historyContext}>{children}</Context.Provider>;\n};\n\nexport const useSharedHistoryContext = (): ContextShape => {\n  return useContext(Context);\n};\n","/**\n * Copyright (c) Meta Platforms, Inc. and affiliates.\n *\n * This source code is licensed under the MIT license found in the\n * LICENSE file in the root directory of this source tree.\n *\n */\n\nimport type { LexicalEditor } from 'lexical';\n\nimport { useLexicalComposerContext } from '@lexical/react/LexicalComposerContext';\nimport { TextNode } from 'lexical';\nimport { useEffect } from 'react';\n\nimport { $createEmojiNode, EmojiNode } from '../nodes/EmojiNode';\n\nconst emojis: Map<string, [string, string]> = new Map([\n  [':)', ['emoji happysmile', '🙂']],\n  [':D', ['emoji veryhappysmile', '😀']],\n  [':(', ['emoji unhappysmile', '🙁']],\n  ['<3', ['emoji heart', '❤']],\n  ['🙂', ['emoji happysmile', '🙂']],\n  ['😀', ['emoji veryhappysmile', '😀']],\n  ['🙁', ['emoji unhappysmile', '🙁']],\n  ['❤', ['emoji heart', '❤']],\n]);\n\nfunction findAndTransformEmoji(node: TextNode): null | TextNode {\n  const text = node.getTextContent();\n\n  for (let i = 0; i < text.length; i++) {\n    const emojiData = emojis.get(text[i]) || emojis.get(text.slice(i, i + 2));\n\n    if (emojiData !== undefined) {\n      const [emojiStyle, emojiText] = emojiData;\n      let targetNode;\n\n      if (i === 0) {\n        [targetNode] = node.splitText(i + 2);\n      } else {\n        [, targetNode] = node.splitText(i, i + 2);\n      }\n\n      const emojiNode = $createEmojiNode(emojiStyle, emojiText);\n      targetNode.replace(emojiNode);\n      return emojiNode;\n    }\n  }\n\n  return null;\n}\n\nfunction textNodeTransform(node: TextNode): void {\n  let targetNode = node;\n\n  while (targetNode !== null) {\n    if (!targetNode.isSimpleText()) {\n      return;\n    }\n\n    targetNode = findAndTransformEmoji(targetNode);\n  }\n}\n\nfunction useEmojis(editor: LexicalEditor): void {\n  useEffect(() => {\n    if (!editor.hasNodes([EmojiNode])) {\n      throw new Error('EmojisPlugin: EmojiNode not registered on editor');\n    }\n\n    return editor.registerNodeTransform(TextNode, textNodeTransform);\n  }, [editor]);\n}\n\nexport default function EmojisPlugin(): JSX.Element {\n  const [editor] = useLexicalComposerContext();\n  useEmojis(editor);\n  return null;\n}\n","/**\n * Copyright (c) Meta Platforms, Inc. and affiliates.\n *\n * This source code is licensed under the MIT license found in the\n * LICENSE file in the root directory of this source tree.\n *\n */\n\nconst getSelection = (): Selection => window.getSelection();\n\nexport default getSelection;\n","/**\n * Copyright (c) Meta Platforms, Inc. and affiliates.\n *\n * This source code is licensed under the MIT license found in the\n * LICENSE file in the root directory of this source tree.\n *\n */\nimport type { LexicalCommand, LexicalEditor } from 'lexical';\n\nimport { useLexicalComposerContext } from '@lexical/react/LexicalComposerContext';\nimport { mergeRegister } from '@lexical/utils';\nimport {\n  $createRangeSelection,\n  $getSelection,\n  $isNodeSelection,\n  $isRangeSelection,\n  $isRootNode,\n  $setSelection,\n  COMMAND_PRIORITY_EDITOR,\n  COMMAND_PRIORITY_HIGH,\n  COMMAND_PRIORITY_LOW,\n  createCommand,\n  DRAGSTART_COMMAND,\n  DRAGOVER_COMMAND,\n  DROP_COMMAND,\n} from 'lexical';\n\nimport { useEffect } from 'react';\nimport getSelection from '../shared-ts/src/getDOMSelection';\n\nimport {\n  $createImageNode,\n  $isImageNode,\n  ImageNode,\n  ImagePayload,\n} from '../nodes/ImageNode';\n\nexport type InsertImagePayload = Readonly<ImagePayload>;\n\nexport const INSERT_IMAGE_COMMAND: LexicalCommand<InsertImagePayload> =\n  createCommand();\nexport default function ImagesPlugin(): JSX.Element | null {\n  const [editor] = useLexicalComposerContext();\n\n  useEffect(() => {\n    if (!editor.hasNodes([ImageNode])) {\n      throw new Error('ImagesPlugin: ImageNode not registered on editor');\n    }\n\n    return mergeRegister(\n      editor.registerCommand<InsertImagePayload>(\n        INSERT_IMAGE_COMMAND,\n        (payload) => {\n          const selection = $getSelection();\n          if ($isRangeSelection(selection)) {\n            if ($isRootNode(selection.anchor.getNode())) {\n              selection.insertParagraph();\n            }\n            const imageNode = $createImageNode(payload);\n            selection.insertNodes([imageNode]);\n          }\n          return true;\n        },\n        COMMAND_PRIORITY_EDITOR\n      ),\n      editor.registerCommand<DragEvent>(\n        DRAGSTART_COMMAND,\n        (event) => {\n          return onDragStart(event);\n        },\n        COMMAND_PRIORITY_HIGH\n      ),\n      editor.registerCommand<DragEvent>(\n        DRAGOVER_COMMAND,\n        (event) => {\n          return onDragover(event);\n        },\n        COMMAND_PRIORITY_LOW\n      ),\n      editor.registerCommand<DragEvent>(\n        DROP_COMMAND,\n        (event) => {\n          return onDrop(event, editor);\n        },\n        COMMAND_PRIORITY_HIGH\n      )\n    );\n  }, [editor]);\n\n  return null;\n}\n\nconst TRANSPARENT_IMAGE =\n  'data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7';\nconst img = document.createElement('img');\nimg.src = TRANSPARENT_IMAGE;\n\nfunction onDragStart(event: DragEvent): boolean {\n  const node = getImageNodeInSelection();\n  if (!node) {\n    return false;\n  }\n  const dataTransfer = event.dataTransfer;\n  if (!dataTransfer) {\n    return false;\n  }\n  dataTransfer.setData('text/plain', '_');\n  dataTransfer.setDragImage(img, 0, 0);\n  dataTransfer.setData(\n    'application/x-lexical-drag',\n    JSON.stringify({\n      data: {\n        altText: node.__altText,\n        caption: node.__caption,\n        height: node.__height,\n        key: node.getKey(),\n        maxWidth: node.__maxWidth,\n        showCaption: node.__showCaption,\n        src: node.__src,\n        width: node.__width,\n      },\n      type: 'image',\n    })\n  );\n\n  return true;\n}\n\nfunction onDragover(event: DragEvent): boolean {\n  const node = getImageNodeInSelection();\n  if (!node) {\n    return false;\n  }\n  if (!canDropImage(event)) {\n    event.preventDefault();\n  }\n  return true;\n}\n\nfunction onDrop(event: DragEvent, editor: LexicalEditor): boolean {\n  const node = getImageNodeInSelection();\n  if (!node) {\n    return false;\n  }\n  const data = getDragImageData(event);\n  if (!data) {\n    return false;\n  }\n  event.preventDefault();\n  if (canDropImage(event)) {\n    const range = getDragSelection(event);\n    node.remove();\n    const rangeSelection = $createRangeSelection();\n    if (range !== null && range !== undefined) {\n      rangeSelection.applyDOMRange(range);\n    }\n    $setSelection(rangeSelection);\n    editor.dispatchCommand(INSERT_IMAGE_COMMAND, data);\n  }\n  return true;\n}\n\nfunction getImageNodeInSelection(): ImageNode | null {\n  const selection = $getSelection();\n  if (!$isNodeSelection(selection)) {\n    return null;\n  }\n  const nodes = selection.getNodes();\n  const node = nodes[0];\n  return $isImageNode(node) ? node : null;\n}\n\nfunction getDragImageData(event: DragEvent): null | InsertImagePayload {\n  const dragData = event.dataTransfer?.getData('application/x-lexical-drag');\n  if (!dragData) {\n    return null;\n  }\n  const { type, data } = JSON.parse(dragData);\n  if (type !== 'image') {\n    return null;\n  }\n\n  return data;\n}\n\ndeclare global {\n  interface DragEvent {\n    rangeOffset?: number;\n    rangeParent?: Node;\n  }\n}\n\nfunction canDropImage(event: DragEvent): boolean {\n  const target = event.target;\n  return !!(\n    target &&\n    target instanceof HTMLElement &&\n    !target.closest('code, span.editor-image') &&\n    target.parentElement &&\n    target.parentElement.closest('div.ContentEditable__root')\n  );\n}\n\nfunction getDragSelection(event: DragEvent): Range | null | undefined {\n  let range;\n  const domSelection = getSelection();\n  if (document.caretRangeFromPoint) {\n    range = document.caretRangeFromPoint(event.clientX, event.clientY);\n  } else if (event.rangeParent && domSelection !== null) {\n    domSelection.collapse(event.rangeParent, event.rangeOffset || 0);\n    range = domSelection.getRangeAt(0);\n  } else {\n    throw Error(`Cannot get the selection when dragging`);\n  }\n\n  return range;\n}\n","/**\n * Copyright (c) Meta Platforms, Inc. and affiliates.\n *\n * This source code is licensed under the MIT license found in the\n * LICENSE file in the root directory of this source tree.\n *\n */\n\nimport type { EditorConfig, LexicalNode } from 'lexical';\n\nimport SerializedTextNode from 'lexical';\n\nimport { Spread } from 'globals';\nimport { TextNode } from 'lexical';\n\nexport type SerializedKeywordNode = Spread<\n  {\n    type: 'keyword';\n    version: 1;\n  },\n  typeof SerializedTextNode\n>;\n\nexport class KeywordNode extends TextNode {\n  static getType(): string {\n    return 'keyword';\n  }\n\n  static clone(node: KeywordNode): KeywordNode {\n    return new KeywordNode(node.__text, node.__key);\n  }\n\n  static importJSON(serializedNode: SerializedKeywordNode): KeywordNode {\n    const node = $createKeywordNode(serializedNode.text);\n    node.setFormat(serializedNode.format);\n    node.setDetail(serializedNode.detail);\n    node.setMode(serializedNode.mode);\n    node.setStyle(serializedNode.style);\n    return node;\n  }\n\n  exportJSON(): SerializedKeywordNode {\n    return {\n      ...super.exportJSON(),\n      type: 'keyword',\n      version: 1,\n    };\n  }\n\n  createDOM(config: EditorConfig): HTMLElement {\n    const dom = super.createDOM(config);\n    dom.style.cursor = 'default';\n    dom.className = 'keyword';\n    return dom;\n  }\n\n  canInsertTextBefore(): boolean {\n    return false;\n  }\n\n  canInsertTextAfter(): boolean {\n    return false;\n  }\n\n  isTextEntity(): true {\n    return true;\n  }\n}\n\nexport function $createKeywordNode(keyword: string): KeywordNode {\n  return new KeywordNode(keyword);\n}\n\nexport function $isKeywordNode(\n  node: LexicalNode | null | undefined | undefined\n): boolean {\n  return node instanceof KeywordNode;\n}\n","/**\n * Copyright (c) Meta Platforms, Inc. and affiliates.\n *\n * This source code is licensed under the MIT license found in the\n * LICENSE file in the root directory of this source tree.\n *\n */\n\nimport type { TextNode } from 'lexical';\n\nimport { useLexicalComposerContext } from '@lexical/react/LexicalComposerContext';\nimport { useLexicalTextEntity } from '@lexical/react/useLexicalTextEntity';\nimport { useCallback, useEffect } from 'react';\n\nimport { $createKeywordNode, KeywordNode } from '../nodes/KeywordNode';\n\nconst KEYWORDS_REGEX =\n  /(^|$|[^A-Za-zªµºÀ-ÖØ-öø-ˁˆ-ˑˠ-ˤˬˮͰ-ʹͶͷͺ-ͽΆΈ-ΊΌΎ-ΡΣ-ϵϷ-ҁҊ-ԧԱ-Ֆՙա-ևא-תװ-ײؠ-يٮٯٱ-ۓەۥۦۮۯۺ-ۼۿܐܒ-ܯݍ-ޥޱߊ-ߪߴߵߺࠀ-ࠕࠚࠤࠨࡀ-ࡘࢠࢢ-ࢬऄ-हऽॐक़-ॡॱ-ॷॹ-ॿঅ-ঌএঐও-নপ-রলশ-হঽৎড়ঢ়য়-ৡৰৱਅ-ਊਏਐਓ-ਨਪ-ਰਲਲ਼ਵਸ਼ਸਹਖ਼-ੜਫ਼ੲ-ੴઅ-ઍએ-ઑઓ-નપ-રલળવ-હઽૐૠૡଅ-ଌଏଐଓ-ନପ-ରଲଳଵ-ହଽଡ଼ଢ଼ୟ-ୡୱஃஅ-ஊஎ-ஐஒ-கஙசஜஞடணதந-பம-ஹௐఅ-ఌఎ-ఐఒ-నప-ళవ-హఽౘౙౠౡಅ-ಌಎ-ಐಒ-ನಪ-ಳವ-ಹಽೞೠೡೱೲഅ-ഌഎ-ഐഒ-ഺഽൎൠൡൺ-ൿඅ-ඖක-නඳ-රලව-ෆก-ะาำเ-ๆກຂຄງຈຊຍດ-ທນ-ຟມ-ຣລວສຫອ-ະາຳຽເ-ໄໆໜ-ໟༀཀ-ཇཉ-ཬྈ-ྌက-ဪဿၐ-ၕၚ-ၝၡၥၦၮ-ၰၵ-ႁႎႠ-ჅჇჍა-ჺჼ-ቈቊ-ቍቐ-ቖቘቚ-ቝበ-ኈኊ-ኍነ-ኰኲ-ኵኸ-ኾዀዂ-ዅወ-ዖዘ-ጐጒ-ጕጘ-ፚᎀ-ᎏᎠ-Ᏼᐁ-ᙬᙯ-ᙿᚁ-ᚚᚠ-ᛪᜀ-ᜌᜎ-ᜑᜠ-ᜱᝀ-ᝑᝠ-ᝬᝮ-ᝰក-ឳៗៜᠠ-ᡷᢀ-ᢨᢪᢰ-ᣵᤀ-ᤜᥐ-ᥭᥰ-ᥴᦀ-ᦫᧁ-ᧇᨀ-ᨖᨠ-ᩔᪧᬅ-ᬳᭅ-ᭋᮃ-ᮠᮮᮯᮺ-ᯥᰀ-ᰣᱍ-ᱏᱚ-ᱽᳩ-ᳬᳮ-ᳱᳵᳶᴀ-ᶿḀ-ἕἘ-Ἕἠ-ὅὈ-Ὅὐ-ὗὙὛὝὟ-ώᾀ-ᾴᾶ-ᾼιῂ-ῄῆ-ῌῐ-ΐῖ-Ίῠ-Ῥῲ-ῴῶ-ῼⁱⁿₐ-ₜℂℇℊ-ℓℕℙ-ℝℤΩℨK-ℭℯ-ℹℼ-ℿⅅ-ⅉⅎↃↄⰀ-Ⱞⰰ-ⱞⱠ-ⳤⳫ-ⳮⳲⳳⴀ-ⴥⴧⴭⴰ-ⵧⵯⶀ-ⶖⶠ-ⶦⶨ-ⶮⶰ-ⶶⶸ-ⶾⷀ-ⷆⷈ-ⷎⷐ-ⷖⷘ-ⷞⸯ々〆〱-〵〻〼ぁ-ゖゝ-ゟァ-ヺー-ヿㄅ-ㄭㄱ-ㆎㆠ-ㆺㇰ-ㇿ㐀-䶵一-鿌ꀀ-ꒌꓐ-ꓽꔀ-ꘌꘐ-ꘟꘪꘫꙀ-ꙮꙿ-ꚗꚠ-ꛥꜗ-ꜟꜢ-ꞈꞋ-ꞎꞐ-ꞓꞠ-Ɦꟸ-ꠁꠃ-ꠅꠇ-ꠊꠌ-ꠢꡀ-ꡳꢂ-ꢳꣲ-ꣷꣻꤊ-ꤥꤰ-ꥆꥠ-ꥼꦄ-ꦲꧏꨀ-ꨨꩀ-ꩂꩄ-ꩋꩠ-ꩶꩺꪀ-ꪯꪱꪵꪶꪹ-ꪽꫀꫂꫛ-ꫝꫠ-ꫪꫲ-ꫴꬁ-ꬆꬉ-ꬎꬑ-ꬖꬠ-ꬦꬨ-ꬮꯀ-ꯢ가-힣ힰ-ퟆퟋ-ퟻ豈-舘並-龎ﬀ-ﬆﬓ-ﬗיִײַ-ﬨשׁ-זּטּ-לּמּנּסּףּפּצּ-ﮱﯓ-ﴽﵐ-ﶏﶒ-ﷇﷰ-ﷻﹰ-ﹴﹶ-ﻼＡ-Ｚａ-ｚｦ-ﾾￂ-ￇￊ-ￏￒ-ￗￚ-ￜ])(congrats|congratulations|gratuluju|gratuluji|gratulujeme|blahopřeju|blahopřeji|blahopřejeme|Til lykke|Tillykke|Glückwunsch|Gratuliere|felicitaciones|enhorabuena|paljon onnea|onnittelut|Félicitations|gratula|gratulálok|gratulálunk|congratulazioni|complimenti|おめでとう|おめでとうございます|축하해|축하해요|gratulerer|Gefeliciteerd|gratulacje|Parabéns|parabéns|felicitações|felicitări|мои поздравления|поздравляем|поздравляю|gratulujem|blahoželám|ยินดีด้วย|ขอแสดงความยินดี|tebrikler|tebrik ederim|恭喜|祝贺你|恭喜你|恭喜|恭喜|baie geluk|veels geluk|অভিনন্দন|Čestitam|Čestitke|Čestitamo|Συγχαρητήρια|Μπράβο|અભિનંદન|badhai|बधाई|अभिनंदन|Честитам|Свака част|hongera|வாழ்த்துகள்|வாழ்த்துக்கள்|అభినందనలు|അഭിനന്ദനങ്ങൾ|Chúc mừng|מזל טוב|mazel tov|mazal tov)(^|$|[^A-Za-zªµºÀ-ÖØ-öø-ˁˆ-ˑˠ-ˤˬˮͰ-ʹͶͷͺ-ͽΆΈ-ΊΌΎ-ΡΣ-ϵϷ-ҁҊ-ԧԱ-Ֆՙա-ևא-תװ-ײؠ-يٮٯٱ-ۓەۥۦۮۯۺ-ۼۿܐܒ-ܯݍ-ޥޱߊ-ߪߴߵߺࠀ-ࠕࠚࠤࠨࡀ-ࡘࢠࢢ-ࢬऄ-हऽॐक़-ॡॱ-ॷॹ-ॿঅ-ঌএঐও-নপ-রলশ-হঽৎড়ঢ়য়-ৡৰৱਅ-ਊਏਐਓ-ਨਪ-ਰਲਲ਼ਵਸ਼ਸਹਖ਼-ੜਫ਼ੲ-ੴઅ-ઍએ-ઑઓ-નપ-રલળવ-હઽૐૠૡଅ-ଌଏଐଓ-ନପ-ରଲଳଵ-ହଽଡ଼ଢ଼ୟ-ୡୱஃஅ-ஊஎ-ஐஒ-கஙசஜஞடணதந-பம-ஹௐఅ-ఌఎ-ఐఒ-నప-ళవ-హఽౘౙౠౡಅ-ಌಎ-ಐಒ-ನಪ-ಳವ-ಹಽೞೠೡೱೲഅ-ഌഎ-ഐഒ-ഺഽൎൠൡൺ-ൿඅ-ඖක-නඳ-රලව-ෆก-ะาำเ-ๆກຂຄງຈຊຍດ-ທນ-ຟມ-ຣລວສຫອ-ະາຳຽເ-ໄໆໜ-ໟༀཀ-ཇཉ-ཬྈ-ྌက-ဪဿၐ-ၕၚ-ၝၡၥၦၮ-ၰၵ-ႁႎႠ-ჅჇჍა-ჺჼ-ቈቊ-ቍቐ-ቖቘቚ-ቝበ-ኈኊ-ኍነ-ኰኲ-ኵኸ-ኾዀዂ-ዅወ-ዖዘ-ጐጒ-ጕጘ-ፚᎀ-ᎏᎠ-Ᏼᐁ-ᙬᙯ-ᙿᚁ-ᚚᚠ-ᛪᜀ-ᜌᜎ-ᜑᜠ-ᜱᝀ-ᝑᝠ-ᝬᝮ-ᝰក-ឳៗៜᠠ-ᡷᢀ-ᢨᢪᢰ-ᣵᤀ-ᤜᥐ-ᥭᥰ-ᥴᦀ-ᦫᧁ-ᧇᨀ-ᨖᨠ-ᩔᪧᬅ-ᬳᭅ-ᭋᮃ-ᮠᮮᮯᮺ-ᯥᰀ-ᰣᱍ-ᱏᱚ-ᱽᳩ-ᳬᳮ-ᳱᳵᳶᴀ-ᶿḀ-ἕἘ-Ἕἠ-ὅὈ-Ὅὐ-ὗὙὛὝὟ-ώᾀ-ᾴᾶ-ᾼιῂ-ῄῆ-ῌῐ-ΐῖ-Ίῠ-Ῥῲ-ῴῶ-ῼⁱⁿₐ-ₜℂℇℊ-ℓℕℙ-ℝℤΩℨK-ℭℯ-ℹℼ-ℿⅅ-ⅉⅎↃↄⰀ-Ⱞⰰ-ⱞⱠ-ⳤⳫ-ⳮⳲⳳⴀ-ⴥⴧⴭⴰ-ⵧⵯⶀ-ⶖⶠ-ⶦⶨ-ⶮⶰ-ⶶⶸ-ⶾⷀ-ⷆⷈ-ⷎⷐ-ⷖⷘ-ⷞⸯ々〆〱-〵〻〼ぁ-ゖゝ-ゟァ-ヺー-ヿㄅ-ㄭㄱ-ㆎㆠ-ㆺㇰ-ㇿ㐀-䶵一-鿌ꀀ-ꒌꓐ-ꓽꔀ-ꘌꘐ-ꘟꘪꘫꙀ-ꙮꙿ-ꚗꚠ-ꛥꜗ-ꜟꜢ-ꞈꞋ-ꞎꞐ-ꞓꞠ-Ɦꟸ-ꠁꠃ-ꠅꠇ-ꠊꠌ-ꠢꡀ-ꡳꢂ-ꢳꣲ-ꣷꣻꤊ-ꤥꤰ-ꥆꥠ-ꥼꦄ-ꦲꧏꨀ-ꨨꩀ-ꩂꩄ-ꩋꩠ-ꩶꩺꪀ-ꪯꪱꪵꪶꪹ-ꪽꫀꫂꫛ-ꫝꫠ-ꫪꫲ-ꫴꬁ-ꬆꬉ-ꬎꬑ-ꬖꬠ-ꬦꬨ-ꬮꯀ-ꯢ가-힣ힰ-ퟆퟋ-ퟻ豈-舘並-龎ﬀ-ﬆﬓ-ﬗיִײַ-ﬨשׁ-זּטּ-לּמּנּסּףּפּצּ-ﮱﯓ-ﴽﵐ-ﶏﶒ-ﷇﷰ-ﷻﹰ-ﹴﹶ-ﻼＡ-Ｚａ-ｚｦ-ﾾￂ-ￇￊ-ￏￒ-ￗￚ-ￜ])/i;\n\nexport default function KeywordsPlugin(): JSX.Element {\n  const [editor] = useLexicalComposerContext();\n\n  useEffect(() => {\n    if (!editor.hasNodes([KeywordNode])) {\n      throw new Error('KeywordsPlugin: KeywordNode not registered on editor');\n    }\n  }, [editor]);\n\n  const createKeywordNode = useCallback((textNode: TextNode): KeywordNode => {\n    return $createKeywordNode(textNode.getTextContent());\n  }, []);\n\n  const getKeywordMatch = useCallback((text: string) => {\n    const matchArr = KEYWORDS_REGEX.exec(text);\n\n    if (matchArr === null) {\n      return null;\n    }\n\n    const hashtagLength = matchArr[2].length;\n    const startOffset = matchArr.index + matchArr[1].length;\n    const endOffset = startOffset + hashtagLength;\n    return {\n      end: endOffset,\n      start: startOffset,\n    };\n  }, []);\n\n  useLexicalTextEntity<KeywordNode>(\n    getKeywordMatch,\n    KeywordNode,\n    createKeywordNode\n  );\n\n  return null;\n}\n","/**\n * Copyright (c) Meta Platforms, Inc. and affiliates.\n *\n * This source code is licensed under the MIT license found in the\n * LICENSE file in the root directory of this source tree.\n *\n * @flow strict\n */\n\nexport const CAN_USE_DOM: boolean =\n  typeof window !== 'undefined' &&\n  typeof window.document !== 'undefined' &&\n  typeof window.document.createElement !== 'undefined';\n","/**\n * Copyright (c) Meta Platforms, Inc. and affiliates.\n *\n * This source code is licensed under the MIT license found in the\n * LICENSE file in the root directory of this source tree.\n *\n * @flow strict\n */\n\nimport { useEffect, useLayoutEffect } from 'react';\nimport { CAN_USE_DOM } from './canUseDOM';\n\nconst useLayoutEffectImpl: typeof useLayoutEffect = CAN_USE_DOM\n  ? useLayoutEffect\n  : useEffect;\n\nexport default useLayoutEffectImpl;\n","/**\n * Copyright (c) Meta Platforms, Inc. and affiliates.\n *\n * This source code is licensed under the MIT license found in the\n * LICENSE file in the root directory of this source tree.\n *\n */\n\nimport type { EditorConfig, LexicalNode, NodeKey } from 'lexical';\n\nimport SerializedTextNode from 'lexical';\n\nimport { Spread } from 'globals';\nimport { TextNode } from 'lexical';\n\nexport type SerializedMentionNode = Spread<\n  {\n    mentionName: string;\n    type: 'mention';\n    version: 1;\n  },\n  typeof SerializedTextNode\n>;\n\nconst mentionStyle = 'background-color: rgba(24, 119, 232, 0.2)';\nexport class MentionNode extends TextNode {\n  __mention: string;\n\n  static getType(): string {\n    return 'mention';\n  }\n\n  static clone(node: MentionNode): MentionNode {\n    return new MentionNode(node.__mention, node.__text, node.__key);\n  }\n  static importJSON(serializedNode: SerializedMentionNode): MentionNode {\n    const node = $createMentionNode(serializedNode.mentionName);\n    node.setTextContent(serializedNode.text);\n    node.setFormat(serializedNode.format);\n    node.setDetail(serializedNode.detail);\n    node.setMode(serializedNode.mode);\n    node.setStyle(serializedNode.style);\n    return node;\n  }\n\n  constructor(mentionName: string, text?: string, key?: NodeKey) {\n    super(text ?? mentionName, key);\n    this.__mention = mentionName;\n  }\n\n  exportJSON(): SerializedMentionNode {\n    return {\n      ...super.exportJSON(),\n      mentionName: this.__mention,\n      type: 'mention',\n      version: 1,\n    };\n  }\n\n  createDOM(config: EditorConfig): HTMLElement {\n    const dom = super.createDOM(config);\n    dom.style.cssText = mentionStyle;\n    dom.className = 'mention';\n    return dom;\n  }\n\n  isTextEntity(): true {\n    return true;\n  }\n}\n\nexport function $createMentionNode(mentionName: string): MentionNode {\n  const mentionNode = new MentionNode(mentionName);\n  mentionNode.setMode('segmented').toggleDirectionless();\n  return mentionNode;\n}\n\nexport function $isMentionNode(\n  node: LexicalNode | null | undefined\n): node is MentionNode {\n  return node instanceof MentionNode;\n}\n","/**\n * Copyright (c) Meta Platforms, Inc. and affiliates.\n *\n * This source code is licensed under the MIT license found in the\n * LICENSE file in the root directory of this source tree.\n *\n */\n\nimport type { LexicalEditor, RangeSelection } from 'lexical';\n\nimport { useLexicalComposerContext } from '@lexical/react/LexicalComposerContext';\nimport { mergeRegister } from '@lexical/utils';\nimport {\n  $getSelection,\n  $isRangeSelection,\n  $isTextNode,\n  COMMAND_PRIORITY_LOW,\n  KEY_ARROW_DOWN_COMMAND,\n  KEY_ARROW_UP_COMMAND,\n  KEY_ENTER_COMMAND,\n  KEY_ESCAPE_COMMAND,\n  KEY_TAB_COMMAND,\n} from 'lexical';\nimport {\n  startTransition,\n  useCallback,\n  useEffect,\n  useRef,\n  useState,\n} from 'react';\nimport * as React from 'react';\nimport { createPortal } from 'react-dom';\nimport useLayoutEffect from '../shared/src/useLayoutEffect';\n\nimport { $createMentionNode, MentionNode } from '../nodes/MentionNode';\n\ntype MentionMatch = {\n  leadOffset: number;\n  matchingString: string;\n  replaceableString: string;\n};\n\ntype Resolution = {\n  match: MentionMatch;\n  range: Range;\n};\n\nconst PUNCTUATION =\n  '\\\\.,\\\\+\\\\*\\\\?\\\\$\\\\@\\\\|#{}\\\\(\\\\)\\\\^\\\\-\\\\[\\\\]\\\\\\\\/!%\\'\"~=<>_:;';\nconst NAME = '\\\\b[A-Z][^\\\\s' + PUNCTUATION + ']';\n\nconst DocumentMentionsRegex = {\n  NAME,\n  PUNCTUATION,\n};\n\nconst CapitalizedNameMentionsRegex = new RegExp(\n  '(^|[^#])((?:' + DocumentMentionsRegex.NAME + '{' + 1 + ',})$)'\n);\n\nconst PUNC = DocumentMentionsRegex.PUNCTUATION;\n\nconst TRIGGERS = ['@', '\\\\uff20'].join('');\n\n// Chars we expect to see in a mention (non-space, non-punctuation).\nconst VALID_CHARS = '[^' + TRIGGERS + PUNC + '\\\\s]';\n\n// Non-standard series of chars. Each series must be preceded and followed by\n// a valid char.\nconst VALID_JOINS =\n  '(?:' +\n  '\\\\.[ |$]|' + // E.g. \"r. \" in \"Mr. Smith\"\n  ' |' + // E.g. \" \" in \"Josh Duck\"\n  '[' +\n  PUNC +\n  ']|' + // E.g. \"-' in \"Salier-Hellendag\"\n  ')';\n\nconst LENGTH_LIMIT = 75;\n\nconst AtSignMentionsRegex = new RegExp(\n  '(^|\\\\s|\\\\()(' +\n    '[' +\n    TRIGGERS +\n    ']' +\n    '((?:' +\n    VALID_CHARS +\n    VALID_JOINS +\n    '){0,' +\n    LENGTH_LIMIT +\n    '})' +\n    ')$'\n);\n\n// 50 is the longest alias length limit.\nconst ALIAS_LENGTH_LIMIT = 50;\n\n// Regex used to match alias.\nconst AtSignMentionsRegexAliasRegex = new RegExp(\n  '(^|\\\\s|\\\\()(' +\n    '[' +\n    TRIGGERS +\n    ']' +\n    '((?:' +\n    VALID_CHARS +\n    '){0,' +\n    ALIAS_LENGTH_LIMIT +\n    '})' +\n    ')$'\n);\n\n// At most, 5 suggestions are shown in the popup.\nconst SUGGESTION_LIST_LENGTH_LIMIT = 5;\n\nconst mentionsCache = new Map();\n\nconst dummyMentionsData = [\n  'Aayla Secura',\n  'Adi Gallia',\n  'Admiral Dodd Rancit',\n  'Admiral Firmus Piett',\n  'Admiral Gial Ackbar',\n  'Admiral Ozzel',\n  'Admiral Raddus',\n  'Admiral Terrinald Screed',\n  'Admiral Trench',\n  'Admiral U.O. Statura',\n  'Agen Kolar',\n  'Agent Kallus',\n  'Aiolin and Morit Astarte',\n  'Aks Moe',\n  'Almec',\n  'Alton Kastle',\n  'Amee',\n  'AP-5',\n  'Armitage Hux',\n  'Artoo',\n  'Arvel Crynyd',\n  'Asajj Ventress',\n  'Aurra Sing',\n  'AZI-3',\n  'Bala-Tik',\n  'Barada',\n  'Bargwill Tomder',\n  'Baron Papanoida',\n  'Barriss Offee',\n  'Baze Malbus',\n  'Bazine Netal',\n  'BB-8',\n  'BB-9E',\n  'Ben Quadinaros',\n  'Berch Teller',\n  'Beru Lars',\n  'Bib Fortuna',\n  'Biggs Darklighter',\n  'Black Krrsantan',\n  'Bo-Katan Kryze',\n  'Boba Fett',\n  'Bobbajo',\n  'Bodhi Rook',\n  'Borvo the Hutt',\n  'Boss Nass',\n  'Bossk',\n  'Breha Antilles-Organa',\n  'Bren Derlin',\n  'Brendol Hux',\n  'BT-1',\n  'C-3PO',\n  'C1-10P',\n  'Cad Bane',\n  'Caluan Ematt',\n  'Captain Gregor',\n  'Captain Phasma',\n  'Captain Quarsh Panaka',\n  'Captain Rex',\n  'Carlist Rieekan',\n  'Casca Panzoro',\n  'Cassian Andor',\n  'Cassio Tagge',\n  'Cham Syndulla',\n  'Che Amanwe Papanoida',\n  'Chewbacca',\n  'Chi Eekway Papanoida',\n  'Chief Chirpa',\n  'Chirrut Îmwe',\n  'Ciena Ree',\n  'Cin Drallig',\n  'Clegg Holdfast',\n  'Cliegg Lars',\n  'Coleman Kcaj',\n  'Coleman Trebor',\n  'Colonel Kaplan',\n  'Commander Bly',\n  'Commander Cody (CC-2224)',\n  'Commander Fil (CC-3714)',\n  'Commander Fox',\n  'Commander Gree',\n  'Commander Jet',\n  'Commander Wolffe',\n  'Conan Antonio Motti',\n  'Conder Kyl',\n  'Constable Zuvio',\n  'Cordé',\n  'Cpatain Typho',\n  'Crix Madine',\n  'Cut Lawquane',\n  'Dak Ralter',\n  'Dapp',\n  'Darth Bane',\n  'Darth Maul',\n  'Darth Tyranus',\n  'Daultay Dofine',\n  'Del Meeko',\n  'Delian Mors',\n  'Dengar',\n  'Depa Billaba',\n  'Derek Klivian',\n  'Dexter Jettster',\n  'Dineé Ellberger',\n  'DJ',\n  'Doctor Aphra',\n  'Doctor Evazan',\n  'Dogma',\n  'Dormé',\n  'Dr. Cylo',\n  'Droidbait',\n  'Droopy McCool',\n  'Dryden Vos',\n  'Dud Bolt',\n  'Ebe E. Endocott',\n  'Echuu Shen-Jon',\n  'Eeth Koth',\n  'Eighth Brother',\n  'Eirtaé',\n  'Eli Vanto',\n  'Ellé',\n  'Ello Asty',\n  'Embo',\n  'Eneb Ray',\n  'Enfys Nest',\n  'EV-9D9',\n  'Evaan Verlaine',\n  'Even Piell',\n  'Ezra Bridger',\n  'Faro Argyus',\n  'Feral',\n  'Fifth Brother',\n  'Finis Valorum',\n  'Finn',\n  'Fives',\n  'FN-1824',\n  'FN-2003',\n  'Fodesinbeed Annodue',\n  'Fulcrum',\n  'FX-7',\n  'GA-97',\n  'Galen Erso',\n  'Gallius Rax',\n  'Garazeb \"Zeb\" Orrelios',\n  'Gardulla the Hutt',\n  'Garrick Versio',\n  'Garven Dreis',\n  'Gavyn Sykes',\n  'Gideon Hask',\n  'Gizor Dellso',\n  'Gonk droid',\n  'Grand Inquisitor',\n  'Greeata Jendowanian',\n  'Greedo',\n  'Greer Sonnel',\n  'Grievous',\n  'Grummgar',\n  'Gungi',\n  'Hammerhead',\n  'Han Solo',\n  'Harter Kalonia',\n  'Has Obbit',\n  'Hera Syndulla',\n  'Hevy',\n  'Hondo Ohnaka',\n  'Huyang',\n  'Iden Versio',\n  'IG-88',\n  'Ima-Gun Di',\n  'Inquisitors',\n  'Inspector Thanoth',\n  'Jabba',\n  'Jacen Syndulla',\n  'Jan Dodonna',\n  'Jango Fett',\n  'Janus Greejatus',\n  'Jar Jar Binks',\n  'Jas Emari',\n  'Jaxxon',\n  'Jek Tono Porkins',\n  'Jeremoch Colton',\n  'Jira',\n  'Jobal Naberrie',\n  'Jocasta Nu',\n  'Joclad Danva',\n  'Joh Yowza',\n  'Jom Barell',\n  'Joph Seastriker',\n  'Jova Tarkin',\n  'Jubnuk',\n  'Jyn Erso',\n  'K-2SO',\n  'Kanan Jarrus',\n  'Karbin',\n  'Karina the Great',\n  'Kes Dameron',\n  'Ketsu Onyo',\n  'Ki-Adi-Mundi',\n  'King Katuunko',\n  'Kit Fisto',\n  'Kitster Banai',\n  'Klaatu',\n  'Klik-Klak',\n  'Korr Sella',\n  'Kylo Ren',\n  'L3-37',\n  'Lama Su',\n  'Lando Calrissian',\n  'Lanever Villecham',\n  'Leia Organa',\n  'Letta Turmond',\n  'Lieutenant Kaydel Ko Connix',\n  'Lieutenant Thire',\n  'Lobot',\n  'Logray',\n  'Lok Durd',\n  'Longo Two-Guns',\n  'Lor San Tekka',\n  'Lorth Needa',\n  'Lott Dod',\n  'Luke Skywalker',\n  'Lumat',\n  'Luminara Unduli',\n  'Lux Bonteri',\n  'Lyn Me',\n  'Lyra Erso',\n  'Mace Windu',\n  'Malakili',\n  'Mama the Hutt',\n  'Mars Guo',\n  'Mas Amedda',\n  'Mawhonic',\n  'Max Rebo',\n  'Maximilian Veers',\n  'Maz Kanata',\n  'ME-8D9',\n  'Meena Tills',\n  'Mercurial Swift',\n  'Mina Bonteri',\n  'Miraj Scintel',\n  'Mister Bones',\n  'Mod Terrik',\n  'Moden Canady',\n  'Mon Mothma',\n  'Moradmin Bast',\n  'Moralo Eval',\n  'Morley',\n  'Mother Talzin',\n  'Nahdar Vebb',\n  'Nahdonnis Praji',\n  'Nien Nunb',\n  'Niima the Hutt',\n  'Nines',\n  'Norra Wexley',\n  'Nute Gunray',\n  'Nuvo Vindi',\n  'Obi-Wan Kenobi',\n  'Odd Ball',\n  'Ody Mandrell',\n  'Omi',\n  'Onaconda Farr',\n  'Oola',\n  'OOM-9',\n  'Oppo Rancisis',\n  'Orn Free Taa',\n  'Oro Dassyne',\n  'Orrimarko',\n  'Osi Sobeck',\n  'Owen Lars',\n  'Pablo-Jill',\n  'Padmé Amidala',\n  'Pagetti Rook',\n  'Paige Tico',\n  'Paploo',\n  'Petty Officer Thanisson',\n  'Pharl McQuarrie',\n  'Plo Koon',\n  'Po Nudo',\n  'Poe Dameron',\n  'Poggle the Lesser',\n  'Pong Krell',\n  'Pooja Naberrie',\n  'PZ-4CO',\n  'Quarrie',\n  'Quay Tolsite',\n  'Queen Apailana',\n  'Queen Jamillia',\n  'Queen Neeyutnee',\n  'Qui-Gon Jinn',\n  'Quiggold',\n  'Quinlan Vos',\n  'R2-D2',\n  'R2-KT',\n  'R3-S6',\n  'R4-P17',\n  'R5-D4',\n  'RA-7',\n  'Rabé',\n  'Rako Hardeen',\n  'Ransolm Casterfo',\n  'Rappertunie',\n  'Ratts Tyerell',\n  'Raymus Antilles',\n  'Ree-Yees',\n  'Reeve Panzoro',\n  'Rey',\n  'Ric Olié',\n  'Riff Tamson',\n  'Riley',\n  'Rinnriyin Di',\n  'Rio Durant',\n  'Rogue Squadron',\n  'Romba',\n  'Roos Tarpals',\n  'Rose Tico',\n  'Rotta the Hutt',\n  'Rukh',\n  'Rune Haako',\n  'Rush Clovis',\n  'Ruwee Naberrie',\n  'Ryoo Naberrie',\n  'Sabé',\n  'Sabine Wren',\n  'Saché',\n  'Saelt-Marae',\n  'Saesee Tiin',\n  'Salacious B. Crumb',\n  'San Hill',\n  'Sana Starros',\n  'Sarco Plank',\n  'Sarkli',\n  'Satine Kryze',\n  'Savage Opress',\n  'Sebulba',\n  'Senator Organa',\n  'Sergeant Kreel',\n  'Seventh Sister',\n  'Shaak Ti',\n  'Shara Bey',\n  'Shmi Skywalker',\n  'Shu Mai',\n  'Sidon Ithano',\n  'Sifo-Dyas',\n  'Sim Aloo',\n  'Siniir Rath Velus',\n  'Sio Bibble',\n  'Sixth Brother',\n  'Slowen Lo',\n  'Sly Moore',\n  'Snaggletooth',\n  'Snap Wexley',\n  'Snoke',\n  'Sola Naberrie',\n  'Sora Bulq',\n  'Strono Tuggs',\n  'Sy Snootles',\n  'Tallissan Lintra',\n  'Tarfful',\n  'Tasu Leech',\n  'Taun We',\n  'TC-14',\n  'Tee Watt Kaa',\n  'Teebo',\n  'Teedo',\n  'Teemto Pagalies',\n  'Temiri Blagg',\n  'Tessek',\n  'Tey How',\n  'Thane Kyrell',\n  'The Bendu',\n  'The Smuggler',\n  'Thrawn',\n  'Tiaan Jerjerrod',\n  'Tion Medon',\n  'Tobias Beckett',\n  'Tulon Voidgazer',\n  'Tup',\n  'U9-C4',\n  'Unkar Plutt',\n  'Val Beckett',\n  'Vanden Willard',\n  'Vice Admiral Amilyn Holdo',\n  'Vober Dand',\n  'WAC-47',\n  'Wag Too',\n  'Wald',\n  'Walrus Man',\n  'Warok',\n  'Wat Tambor',\n  'Watto',\n  'Wedge Antilles',\n  'Wes Janson',\n  'Wicket W. Warrick',\n  'Wilhuff Tarkin',\n  'Wollivan',\n  'Wuher',\n  'Wullf Yularen',\n  'Xamuel Lennox',\n  'Yaddle',\n  'Yarael Poof',\n  'Yoda',\n  'Zam Wesell',\n  'Zev Senesca',\n  'Ziro the Hutt',\n  'Zuckuss',\n];\n\nconst dummyLookupService = {\n  search(\n    string: string,\n    callback: (results: Array<string> | null) => void\n  ): void {\n    setTimeout(() => {\n      const results = dummyMentionsData.filter((mention) =>\n        mention.toLowerCase().includes(string.toLowerCase())\n      );\n      if (results.length === 0) {\n        callback(null);\n      } else {\n        callback(results);\n      }\n    }, 500);\n  },\n};\n\nfunction useMentionLookupService(mentionString) {\n  const [results, setResults] = useState<Array<string> | null>(null);\n\n  useEffect(() => {\n    const cachedResults = mentionsCache.get(mentionString);\n\n    if (cachedResults === null) {\n      return;\n    } else if (cachedResults !== undefined) {\n      setResults(cachedResults);\n      return;\n    }\n\n    mentionsCache.set(mentionString, null);\n    dummyLookupService.search(mentionString, (newResults) => {\n      mentionsCache.set(mentionString, newResults);\n      setResults(newResults);\n    });\n  }, [mentionString]);\n\n  return results;\n}\n\nfunction MentionsTypeaheadItem({\n  index,\n  isSelected,\n  onClick,\n  onMouseEnter,\n  result,\n}: {\n  index: number;\n  isSelected: boolean;\n  onClick: () => void;\n  onMouseEnter: () => void;\n  result: string;\n}) {\n  const liRef = useRef(null);\n\n  let className = 'item';\n  if (isSelected) {\n    className += ' selected';\n  }\n\n  return (\n    <li\n      key={result}\n      tabIndex={-1}\n      className={className}\n      ref={liRef}\n      role=\"option\"\n      aria-selected={isSelected}\n      id={'typeahead-item-' + index}\n      onMouseEnter={onMouseEnter}\n      onClick={onClick}\n    >\n      {result}\n    </li>\n  );\n}\n\nfunction MentionsTypeahead({\n  close,\n  editor,\n  resolution,\n}: {\n  close: () => void;\n  editor: LexicalEditor;\n  resolution: Resolution;\n}): JSX.Element {\n  const divRef = useRef(null);\n  const match = resolution.match;\n  const results = useMentionLookupService(match.matchingString);\n  const [selectedIndex, setSelectedIndex] = useState<null | number>(null);\n\n  useEffect(() => {\n    const div = divRef.current;\n    const rootElement = editor.getRootElement();\n    if (results !== null && div !== null && rootElement !== null) {\n      const range = resolution.range;\n      const { left, top, height } = range.getBoundingClientRect();\n      div.style.top = `${top + height + 2}px`;\n      div.style.left = `${left - 14}px`;\n      div.style.display = 'block';\n      rootElement.setAttribute('aria-controls', 'mentions-typeahead');\n\n      return () => {\n        div.style.display = 'none';\n        rootElement.removeAttribute('aria-controls');\n      };\n    }\n  }, [editor, resolution, results]);\n\n  const applyCurrentSelected = useCallback(() => {\n    if (results === null || selectedIndex === null) {\n      return;\n    }\n    const selectedEntry = results[selectedIndex];\n\n    close();\n\n    createMentionNodeFromSearchResult(editor, selectedEntry, match);\n  }, [close, match, editor, results, selectedIndex]);\n\n  const updateSelectedIndex = useCallback(\n    (index) => {\n      const rootElem = editor.getRootElement();\n      if (rootElem !== null) {\n        rootElem.setAttribute(\n          'aria-activedescendant',\n          'typeahead-item-' + index\n        );\n        setSelectedIndex(index);\n      }\n    },\n    [editor]\n  );\n\n  useEffect(() => {\n    return () => {\n      const rootElem = editor.getRootElement();\n      if (rootElem !== null) {\n        rootElem.removeAttribute('aria-activedescendant');\n      }\n    };\n  }, [editor]);\n\n  useLayoutEffect(() => {\n    if (results === null) {\n      setSelectedIndex(null);\n    } else if (selectedIndex === null) {\n      updateSelectedIndex(0);\n    }\n  }, [results, selectedIndex, updateSelectedIndex]);\n\n  useEffect(() => {\n    return mergeRegister(\n      editor.registerCommand<KeyboardEvent>(\n        KEY_ARROW_DOWN_COMMAND,\n        (payload) => {\n          const event = payload;\n          if (results !== null && selectedIndex !== null) {\n            if (\n              selectedIndex < SUGGESTION_LIST_LENGTH_LIMIT - 1 &&\n              selectedIndex !== results.length - 1\n            ) {\n              updateSelectedIndex(selectedIndex + 1);\n            }\n            event.preventDefault();\n            event.stopImmediatePropagation();\n          }\n          return true;\n        },\n        COMMAND_PRIORITY_LOW\n      ),\n      editor.registerCommand<KeyboardEvent>(\n        KEY_ARROW_UP_COMMAND,\n        (payload) => {\n          const event = payload;\n          if (results !== null && selectedIndex !== null) {\n            if (selectedIndex !== 0) {\n              updateSelectedIndex(selectedIndex - 1);\n            }\n            event.preventDefault();\n            event.stopImmediatePropagation();\n          }\n          return true;\n        },\n        COMMAND_PRIORITY_LOW\n      ),\n      editor.registerCommand<KeyboardEvent>(\n        KEY_ESCAPE_COMMAND,\n        (payload) => {\n          const event = payload;\n          if (results === null || selectedIndex === null) {\n            return false;\n          }\n          event.preventDefault();\n          event.stopImmediatePropagation();\n          close();\n          return true;\n        },\n        COMMAND_PRIORITY_LOW\n      ),\n      editor.registerCommand<KeyboardEvent>(\n        KEY_TAB_COMMAND,\n        (payload) => {\n          const event = payload;\n          if (results === null || selectedIndex === null) {\n            return false;\n          }\n          event.preventDefault();\n          event.stopImmediatePropagation();\n          applyCurrentSelected();\n          return true;\n        },\n        COMMAND_PRIORITY_LOW\n      ),\n      editor.registerCommand(\n        KEY_ENTER_COMMAND,\n        (event: KeyboardEvent | null) => {\n          if (results === null || selectedIndex === null) {\n            return false;\n          }\n          if (event !== null) {\n            event.preventDefault();\n            event.stopImmediatePropagation();\n          }\n          applyCurrentSelected();\n          return true;\n        },\n        COMMAND_PRIORITY_LOW\n      )\n    );\n  }, [\n    applyCurrentSelected,\n    close,\n    editor,\n    results,\n    selectedIndex,\n    updateSelectedIndex,\n  ]);\n\n  if (results === null) {\n    return null;\n  }\n\n  return (\n    <div\n      aria-label=\"Suggested mentions\"\n      id=\"mentions-typeahead\"\n      ref={divRef}\n      role=\"listbox\"\n    >\n      <ul>\n        {results.slice(0, SUGGESTION_LIST_LENGTH_LIMIT).map((result, i) => (\n          <MentionsTypeaheadItem\n            index={i}\n            isSelected={i === selectedIndex}\n            onClick={() => {\n              setSelectedIndex(i);\n              applyCurrentSelected();\n            }}\n            onMouseEnter={() => {\n              setSelectedIndex(i);\n            }}\n            key={result}\n            result={result}\n          />\n        ))}\n      </ul>\n    </div>\n  );\n}\n\nfunction checkForCapitalizedNameMentions(\n  text,\n  minMatchLength\n): MentionMatch | null {\n  const match = CapitalizedNameMentionsRegex.exec(text);\n  if (match !== null) {\n    // The strategy ignores leading whitespace but we need to know it's\n    // length to add it to the leadOffset\n    const maybeLeadingWhitespace = match[1];\n\n    const matchingString = match[2];\n    if (matchingString != null && matchingString.length >= minMatchLength) {\n      return {\n        leadOffset: match.index + maybeLeadingWhitespace.length,\n        matchingString,\n        replaceableString: matchingString,\n      };\n    }\n  }\n  return null;\n}\n\nfunction checkForAtSignMentions(text, minMatchLength): MentionMatch | null {\n  let match = AtSignMentionsRegex.exec(text);\n\n  if (match === null) {\n    match = AtSignMentionsRegexAliasRegex.exec(text);\n  }\n  if (match !== null) {\n    // The strategy ignores leading whitespace but we need to know it's\n    // length to add it to the leadOffset\n    const maybeLeadingWhitespace = match[1];\n\n    const matchingString = match[3];\n    if (matchingString.length >= minMatchLength) {\n      return {\n        leadOffset: match.index + maybeLeadingWhitespace.length,\n        matchingString,\n        replaceableString: match[2],\n      };\n    }\n  }\n  return null;\n}\n\nfunction getPossibleMentionMatch(text): MentionMatch | null {\n  const match = checkForAtSignMentions(text, 1);\n  return match === null ? checkForCapitalizedNameMentions(text, 3) : match;\n}\n\nfunction getTextUpToAnchor(selection: RangeSelection): string | null {\n  const anchor = selection.anchor;\n  if (anchor.type !== 'text') {\n    return null;\n  }\n  const anchorNode = anchor.getNode();\n  // We should not be attempting to extract mentions out of nodes\n  // that are already being used for other core things. This is\n  // especially true for immutable nodes, which can't be mutated at all.\n  if (!anchorNode.isSimpleText()) {\n    return null;\n  }\n  const anchorOffset = anchor.offset;\n  return anchorNode.getTextContent().slice(0, anchorOffset);\n}\n\nfunction tryToPositionRange(match: MentionMatch, range: Range): boolean {\n  const domSelection = window.getSelection();\n  if (domSelection === null || !domSelection.isCollapsed) {\n    return false;\n  }\n  const anchorNode = domSelection.anchorNode;\n  const startOffset = match.leadOffset;\n  const endOffset = domSelection.anchorOffset;\n  try {\n    range.setStart(anchorNode, startOffset);\n    range.setEnd(anchorNode, endOffset);\n  } catch (error) {\n    return false;\n  }\n\n  return true;\n}\n\nfunction getMentionsTextToSearch(editor: LexicalEditor): string | null {\n  let text = null;\n  editor.getEditorState().read(() => {\n    const selection = $getSelection();\n    if (!$isRangeSelection(selection)) {\n      return;\n    }\n    text = getTextUpToAnchor(selection);\n  });\n  return text;\n}\n\n/**\n * Walk backwards along user input and forward through entity title to try\n * and replace more of the user's text with entity.\n *\n * E.g. User types \"Hello Sarah Smit\" and we match \"Smit\" to \"Sarah Smith\".\n * Replacing just the match would give us \"Hello Sarah Sarah Smith\".\n * Instead we find the string \"Sarah Smit\" and replace all of it.\n */\nfunction getMentionOffset(\n  documentText: string,\n  entryText: string,\n  offset: number\n): number {\n  let triggerOffset = offset;\n  for (let ii = triggerOffset; ii <= entryText.length; ii++) {\n    if (documentText.substr(-ii) === entryText.substr(0, ii)) {\n      triggerOffset = ii;\n    }\n  }\n\n  return triggerOffset;\n}\n\n/**\n * From a Typeahead Search Result, replace plain text from search offset and\n * render a newly created MentionNode.\n */\nfunction createMentionNodeFromSearchResult(\n  editor: LexicalEditor,\n  entryText: string,\n  match: MentionMatch\n): void {\n  editor.update(() => {\n    const selection = $getSelection();\n    if (!$isRangeSelection(selection) || !selection.isCollapsed()) {\n      return;\n    }\n    const anchor = selection.anchor;\n    if (anchor.type !== 'text') {\n      return;\n    }\n    const anchorNode = anchor.getNode();\n    // We should not be attempting to extract mentions out of nodes\n    // that are already being used for other core things. This is\n    // especially true for immutable nodes, which can't be mutated at all.\n    if (!anchorNode.isSimpleText()) {\n      return;\n    }\n    const selectionOffset = anchor.offset;\n    const textContent = anchorNode.getTextContent().slice(0, selectionOffset);\n    const characterOffset = match.replaceableString.length;\n\n    // Given a known offset for the mention match, look backward in the\n    // text to see if there's a longer match to replace.\n    const mentionOffset = getMentionOffset(\n      textContent,\n      entryText,\n      characterOffset\n    );\n    const startOffset = selectionOffset - mentionOffset;\n    if (startOffset < 0) {\n      return;\n    }\n\n    let nodeToReplace;\n    if (startOffset === 0) {\n      [nodeToReplace] = anchorNode.splitText(selectionOffset);\n    } else {\n      [, nodeToReplace] = anchorNode.splitText(startOffset, selectionOffset);\n    }\n\n    const mentionNode = $createMentionNode(entryText);\n    nodeToReplace.replace(mentionNode);\n    mentionNode.select();\n  });\n}\n\nfunction isSelectionOnEntityBoundary(\n  editor: LexicalEditor,\n  offset: number\n): boolean {\n  if (offset !== 0) {\n    return false;\n  }\n  return editor.getEditorState().read(() => {\n    const selection = $getSelection();\n    if ($isRangeSelection(selection)) {\n      const anchor = selection.anchor;\n      const anchorNode = anchor.getNode();\n      const prevSibling = anchorNode.getPreviousSibling();\n      return $isTextNode(prevSibling) && prevSibling.isTextEntity();\n    }\n    return false;\n  });\n}\n\nfunction useMentions(editor: LexicalEditor): JSX.Element {\n  const [resolution, setResolution] = useState<Resolution | null>(null);\n\n  useEffect(() => {\n    if (!editor.hasNodes([MentionNode])) {\n      throw new Error('MentionsPlugin: MentionNode not registered on editor');\n    }\n  }, [editor]);\n\n  useEffect(() => {\n    let activeRange: Range | null = document.createRange();\n    let previousText = null;\n\n    const updateListener = () => {\n      const range = activeRange;\n      const text = getMentionsTextToSearch(editor);\n\n      if (text === previousText || range === null) {\n        return;\n      }\n      previousText = text;\n\n      if (text === null) {\n        return;\n      }\n      const match = getPossibleMentionMatch(text);\n      if (\n        match !== null &&\n        !isSelectionOnEntityBoundary(editor, match.leadOffset)\n      ) {\n        const isRangePositioned = tryToPositionRange(match, range);\n        if (isRangePositioned !== null) {\n          startTransition(() =>\n            setResolution({\n              match,\n              range,\n            })\n          );\n          return;\n        }\n      }\n      startTransition(() => setResolution(null));\n    };\n\n    const removeUpdateListener = editor.registerUpdateListener(updateListener);\n\n    return () => {\n      activeRange = null;\n      removeUpdateListener();\n    };\n  }, [editor]);\n\n  const closeTypeahead = useCallback(() => {\n    setResolution(null);\n  }, []);\n\n  return resolution === null || editor === null\n    ? null\n    : createPortal(\n        <MentionsTypeahead\n          close={closeTypeahead}\n          resolution={resolution}\n          editor={editor}\n        />,\n        document.body\n      );\n}\n\nexport default function MentionsPlugin(): JSX.Element {\n  const [editor] = useLexicalComposerContext();\n  return useMentions(editor);\n}\n","/**\n * Copyright (c) Meta Platforms, Inc. and affiliates.\n *\n * This source code is licensed under the MIT license found in the\n * LICENSE file in the root directory of this source tree.\n *\n */\n\nimport { useLexicalComposerContext } from '@lexical/react/LexicalComposerContext';\nimport {\n  $deleteTableColumn,\n  $getElementGridForTableNode,\n  $getTableCellNodeFromLexicalNode,\n  $getTableColumnIndexFromTableCellNode,\n  $getTableNodeFromLexicalNodeOrThrow,\n  $getTableRowIndexFromTableCellNode,\n  $insertTableColumn,\n  $insertTableRow,\n  $isTableCellNode,\n  $isTableRowNode,\n  $removeTableRowAtIndex,\n  getTableSelectionFromTableElement,\n  HTMLTableElementWithWithTableSelectionState,\n  TableCellHeaderStates,\n  TableCellNode,\n} from '@lexical/table';\nimport {\n  $getSelection,\n  $isGridSelection,\n  $isRangeSelection,\n  $setSelection,\n} from 'lexical';\nimport * as React from 'react';\nimport { ReactPortal, useCallback, useEffect, useRef, useState } from 'react';\nimport { createPortal } from 'react-dom';\n\ntype TableCellActionMenuProps = Readonly<{\n  contextRef: { current: null | HTMLElement };\n  onClose: () => void;\n  setIsMenuOpen: (isOpen: boolean) => void;\n  tableCellNode: TableCellNode;\n}>;\n\nfunction TableActionMenu({\n  onClose,\n  tableCellNode: _tableCellNode,\n  setIsMenuOpen,\n  contextRef,\n}: TableCellActionMenuProps) {\n  const [editor] = useLexicalComposerContext();\n  const dropDownRef = useRef<HTMLDivElement | null>(null);\n  const [tableCellNode, updateTableCellNode] = useState(_tableCellNode);\n  const [selectionCounts, updateSelectionCounts] = useState({\n    columns: 1,\n    rows: 1,\n  });\n\n  useEffect(() => {\n    return editor.registerMutationListener(TableCellNode, (nodeMutations) => {\n      const nodeUpdated =\n        nodeMutations.get(tableCellNode.getKey()) === 'updated';\n\n      if (nodeUpdated) {\n        editor.getEditorState().read(() => {\n          updateTableCellNode(tableCellNode.getLatest());\n        });\n      }\n    });\n  }, [editor, tableCellNode]);\n\n  useEffect(() => {\n    editor.getEditorState().read(() => {\n      const selection = $getSelection();\n\n      if ($isGridSelection(selection)) {\n        const selectionShape = selection.getShape();\n\n        updateSelectionCounts({\n          columns: selectionShape.toX - selectionShape.fromX + 1,\n          rows: selectionShape.toY - selectionShape.fromY + 1,\n        });\n      }\n    });\n  }, [editor]);\n\n  useEffect(() => {\n    const menuButtonElement = contextRef.current;\n    const dropDownElement = dropDownRef.current;\n\n    if (menuButtonElement != null && dropDownElement != null) {\n      const menuButtonRect = menuButtonElement.getBoundingClientRect();\n\n      dropDownElement.style.opacity = '1';\n\n      dropDownElement.style.left = `${\n        menuButtonRect.left + menuButtonRect.width + window.pageXOffset + 5\n      }px`;\n\n      dropDownElement.style.top = `${\n        menuButtonRect.top + window.pageYOffset\n      }px`;\n    }\n  }, [contextRef, dropDownRef]);\n\n  useEffect(() => {\n    function handleClickOutside(event: MouseEvent) {\n      if (\n        dropDownRef.current != null &&\n        contextRef.current != null &&\n        !dropDownRef.current.contains(event.target as Node) &&\n        !contextRef.current.contains(event.target as Node)\n      ) {\n        setIsMenuOpen(false);\n      }\n    }\n\n    window.addEventListener('click', handleClickOutside);\n\n    return () => window.removeEventListener('click', handleClickOutside);\n  }, [setIsMenuOpen, contextRef]);\n\n  const clearTableSelection = useCallback(() => {\n    editor.update(() => {\n      if (tableCellNode.isAttached()) {\n        const tableNode = $getTableNodeFromLexicalNodeOrThrow(tableCellNode);\n        const tableElement = editor.getElementByKey(\n          tableNode.getKey()\n        ) as HTMLTableElementWithWithTableSelectionState;\n\n        if (!tableElement) {\n          throw new Error('Expected to find tableElement in DOM');\n        }\n\n        const tableSelection = getTableSelectionFromTableElement(tableElement);\n        if (tableSelection !== null) {\n          tableSelection.clearHighlight();\n        }\n\n        tableNode.markDirty();\n        updateTableCellNode(tableCellNode.getLatest());\n      }\n\n      $setSelection(null);\n    });\n  }, [editor, tableCellNode]);\n\n  const insertTableRowAtSelection = useCallback(\n    (shouldInsertAfter: boolean) => {\n      editor.update(() => {\n        const selection = $getSelection();\n\n        const tableNode = $getTableNodeFromLexicalNodeOrThrow(tableCellNode);\n\n        let tableRowIndex;\n\n        if ($isGridSelection(selection)) {\n          const selectionShape = selection.getShape();\n          tableRowIndex = shouldInsertAfter\n            ? selectionShape.toY\n            : selectionShape.fromY;\n        } else {\n          tableRowIndex = $getTableRowIndexFromTableCellNode(tableCellNode);\n        }\n\n        const grid = $getElementGridForTableNode(editor, tableNode);\n\n        $insertTableRow(\n          tableNode,\n          tableRowIndex,\n          shouldInsertAfter,\n          selectionCounts.rows,\n          grid\n        );\n\n        clearTableSelection();\n\n        onClose();\n      });\n    },\n    [editor, tableCellNode, selectionCounts.rows, clearTableSelection, onClose]\n  );\n\n  const insertTableColumnAtSelection = useCallback(\n    (shouldInsertAfter: boolean) => {\n      editor.update(() => {\n        const selection = $getSelection();\n\n        const tableNode = $getTableNodeFromLexicalNodeOrThrow(tableCellNode);\n\n        let tableColumnIndex;\n\n        if ($isGridSelection(selection)) {\n          const selectionShape = selection.getShape();\n          tableColumnIndex = shouldInsertAfter\n            ? selectionShape.toX\n            : selectionShape.fromX;\n        } else {\n          tableColumnIndex =\n            $getTableColumnIndexFromTableCellNode(tableCellNode);\n        }\n\n        $insertTableColumn(\n          tableNode,\n          tableColumnIndex,\n          shouldInsertAfter,\n          selectionCounts.columns\n        );\n\n        clearTableSelection();\n\n        onClose();\n      });\n    },\n    [\n      editor,\n      tableCellNode,\n      selectionCounts.columns,\n      clearTableSelection,\n      onClose,\n    ]\n  );\n\n  const deleteTableRowAtSelection = useCallback(() => {\n    editor.update(() => {\n      const tableNode = $getTableNodeFromLexicalNodeOrThrow(tableCellNode);\n      const tableRowIndex = $getTableRowIndexFromTableCellNode(tableCellNode);\n\n      $removeTableRowAtIndex(tableNode, tableRowIndex);\n\n      clearTableSelection();\n      onClose();\n    });\n  }, [editor, tableCellNode, clearTableSelection, onClose]);\n\n  const deleteTableAtSelection = useCallback(() => {\n    editor.update(() => {\n      const tableNode = $getTableNodeFromLexicalNodeOrThrow(tableCellNode);\n      tableNode.remove();\n\n      clearTableSelection();\n      onClose();\n    });\n  }, [editor, tableCellNode, clearTableSelection, onClose]);\n\n  const deleteTableColumnAtSelection = useCallback(() => {\n    editor.update(() => {\n      const tableNode = $getTableNodeFromLexicalNodeOrThrow(tableCellNode);\n\n      const tableColumnIndex =\n        $getTableColumnIndexFromTableCellNode(tableCellNode);\n\n      $deleteTableColumn(tableNode, tableColumnIndex);\n\n      clearTableSelection();\n      onClose();\n    });\n  }, [editor, tableCellNode, clearTableSelection, onClose]);\n\n  const toggleTableRowIsHeader = useCallback(() => {\n    editor.update(() => {\n      const tableNode = $getTableNodeFromLexicalNodeOrThrow(tableCellNode);\n\n      const tableRowIndex = $getTableRowIndexFromTableCellNode(tableCellNode);\n\n      const tableRows = tableNode.getChildren();\n\n      if (tableRowIndex >= tableRows.length || tableRowIndex < 0) {\n        throw new Error('Expected table cell to be inside of table row.');\n      }\n\n      const tableRow = tableRows[tableRowIndex];\n\n      if (!$isTableRowNode(tableRow)) {\n        throw new Error('Expected table row');\n      }\n\n      tableRow.getChildren().forEach((tableCell) => {\n        if (!$isTableCellNode(tableCell)) {\n          throw new Error('Expected table cell');\n        }\n\n        tableCell.toggleHeaderStyle(TableCellHeaderStates.ROW);\n      });\n\n      clearTableSelection();\n      onClose();\n    });\n  }, [editor, tableCellNode, clearTableSelection, onClose]);\n\n  const toggleTableColumnIsHeader = useCallback(() => {\n    editor.update(() => {\n      const tableNode = $getTableNodeFromLexicalNodeOrThrow(tableCellNode);\n\n      const tableColumnIndex =\n        $getTableColumnIndexFromTableCellNode(tableCellNode);\n\n      const tableRows = tableNode.getChildren();\n\n      for (let r = 0; r < tableRows.length; r++) {\n        const tableRow = tableRows[r];\n\n        if (!$isTableRowNode(tableRow)) {\n          throw new Error('Expected table row');\n        }\n\n        const tableCells = tableRow.getChildren();\n\n        if (tableColumnIndex >= tableCells.length || tableColumnIndex < 0) {\n          throw new Error('Expected table cell to be inside of table row.');\n        }\n\n        const tableCell = tableCells[tableColumnIndex];\n\n        if (!$isTableCellNode(tableCell)) {\n          throw new Error('Expected table cell');\n        }\n\n        tableCell.toggleHeaderStyle(TableCellHeaderStates.COLUMN);\n      }\n\n      clearTableSelection();\n      onClose();\n    });\n  }, [editor, tableCellNode, clearTableSelection, onClose]);\n\n  return createPortal(\n    // eslint-disable-next-line jsx-a11y/no-static-element-interactions\n    <div\n      className=\"dropdown\"\n      ref={dropDownRef}\n      onClick={(e) => {\n        e.stopPropagation();\n      }}\n    >\n      <button className=\"item\" onClick={() => insertTableRowAtSelection(false)} type=\"button\">\n        <span className=\"text\">\n          Insert{' '}\n          {selectionCounts.rows === 1 ? 'row' : `${selectionCounts.rows} rows`}{' '}\n          above\n        </span>\n      </button>\n      <button className=\"item\" onClick={() => insertTableRowAtSelection(true)} type=\"button\">\n        <span className=\"text\">\n          Insert{' '}\n          {selectionCounts.rows === 1 ? 'row' : `${selectionCounts.rows} rows`}{' '}\n          below\n        </span>\n      </button>\n      <hr />\n      <button\n        className=\"item\"\n        onClick={() => insertTableColumnAtSelection(false)}\n        type=\"button\"\n      >\n        <span className=\"text\">\n          Insert{' '}\n          {selectionCounts.columns === 1\n            ? 'column'\n            : `${selectionCounts.columns} columns`}{' '}\n          left\n        </span>\n      </button>\n      <button\n        className=\"item\"\n        onClick={() => insertTableColumnAtSelection(true)}\n        type=\"button\"\n      >\n        <span className=\"text\">\n          Insert{' '}\n          {selectionCounts.columns === 1\n            ? 'column'\n            : `${selectionCounts.columns} columns`}{' '}\n          right\n        </span>\n      </button>\n      <hr />\n      <button className=\"item\" onClick={() => deleteTableColumnAtSelection()} type=\"button\">\n        <span className=\"text\">Delete column</span>\n      </button>\n      <button className=\"item\" onClick={() => deleteTableRowAtSelection()} type=\"button\">\n        <span className=\"text\">Delete row</span>\n      </button>\n      <button className=\"item\" onClick={() => deleteTableAtSelection()} type=\"button\">\n        <span className=\"text\">Delete table</span>\n      </button>\n      <hr />\n      <button className=\"item\" onClick={() => toggleTableRowIsHeader()} type=\"button\">\n        <span className=\"text\">\n          {(tableCellNode.__headerState & TableCellHeaderStates.ROW) ===\n          TableCellHeaderStates.ROW\n            ? 'Remove'\n            : 'Add'}{' '}\n          row header\n        </span>\n      </button>\n      <button className=\"item\" onClick={() => toggleTableColumnIsHeader()} type=\"button\">\n        <span className=\"text\">\n          {(tableCellNode.__headerState & TableCellHeaderStates.COLUMN) ===\n          TableCellHeaderStates.COLUMN\n            ? 'Remove'\n            : 'Add'}{' '}\n          column header\n        </span>\n      </button>\n    </div>,\n    document.body\n  );\n}\n\nfunction TableCellActionMenuContainer(): JSX.Element {\n  const [editor] = useLexicalComposerContext();\n\n  const menuButtonRef = useRef(null);\n  const menuRootRef = useRef(null);\n  const [isMenuOpen, setIsMenuOpen] = useState(false);\n\n  const [tableCellNode, setTableMenuCellNode] = useState<TableCellNode | null>(\n    null\n  );\n\n  const moveMenu = useCallback(() => {\n    const menu = menuButtonRef.current;\n    const selection = $getSelection();\n    const nativeSelection = window.getSelection();\n    const activeElement = document.activeElement;\n\n    if (selection == null || menu == null) {\n      setTableMenuCellNode(null);\n      return;\n    }\n\n    const rootElement = editor.getRootElement();\n\n    if (\n      $isRangeSelection(selection) &&\n      rootElement !== null &&\n      nativeSelection !== null &&\n      rootElement.contains(nativeSelection.anchorNode)\n    ) {\n      const tableCellNodeFromSelection = $getTableCellNodeFromLexicalNode(\n        selection.anchor.getNode()\n      );\n\n      if (tableCellNodeFromSelection == null) {\n        setTableMenuCellNode(null);\n        return;\n      }\n\n      const tableCellParentNodeDOM = editor.getElementByKey(\n        tableCellNodeFromSelection.getKey()\n      );\n\n      if (tableCellParentNodeDOM == null) {\n        setTableMenuCellNode(null);\n        return;\n      }\n\n      setTableMenuCellNode(tableCellNodeFromSelection);\n    } else if (!activeElement) {\n      setTableMenuCellNode(null);\n    }\n  }, [editor]);\n\n  useEffect(() => {\n    return editor.registerUpdateListener(() => {\n      editor.getEditorState().read(() => {\n        moveMenu();\n      });\n    });\n  });\n\n  useEffect(() => {\n    const menuButtonDOM = menuButtonRef.current as HTMLButtonElement | null;\n\n    if (menuButtonDOM != null && tableCellNode != null) {\n      const tableCellNodeDOM = editor.getElementByKey(tableCellNode.getKey());\n\n      if (tableCellNodeDOM != null) {\n        const tableCellRect = tableCellNodeDOM.getBoundingClientRect();\n        const menuRect = menuButtonDOM.getBoundingClientRect();\n\n        menuButtonDOM.style.opacity = '1';\n\n        menuButtonDOM.style.left = `${\n          tableCellRect.left +\n          window.pageXOffset -\n          menuRect.width +\n          tableCellRect.width -\n          10\n        }px`;\n\n        menuButtonDOM.style.top = `${\n          tableCellRect.top + window.pageYOffset + 5\n        }px`;\n      } else {\n        menuButtonDOM.style.opacity = '0';\n      }\n    }\n  }, [menuButtonRef, tableCellNode, editor]);\n\n  const prevTableCellDOM = useRef(tableCellNode);\n\n  useEffect(() => {\n    if (prevTableCellDOM.current !== tableCellNode) {\n      setIsMenuOpen(false);\n    }\n\n    prevTableCellDOM.current = tableCellNode;\n  }, [prevTableCellDOM, tableCellNode]);\n\n  return (\n    <div className=\"table-cell-action-button-container\" ref={menuButtonRef}>\n      {tableCellNode != null && (\n        <>\n          <button\n            className=\"table-cell-action-button chevron-down\"\n            onClick={(e) => {\n              e.stopPropagation();\n              setIsMenuOpen(!isMenuOpen);\n            }}\n            ref={menuRootRef}\n            type=\"button\"\n          >\n            <i className=\"chevron-down\" />\n          </button>\n          {isMenuOpen && (\n            <TableActionMenu\n              contextRef={menuRootRef}\n              setIsMenuOpen={setIsMenuOpen}\n              onClose={() => setIsMenuOpen(false)}\n              tableCellNode={tableCellNode}\n            />\n          )}\n        </>\n      )}\n    </div>\n  );\n}\n\nexport default function TableActionMenuPlugin(): ReactPortal {\n  return createPortal(<TableCellActionMenuContainer />, document.body);\n}\n","/**\n * Copyright (c) Meta Platforms, Inc. and affiliates.\n *\n * This source code is licensed under the MIT license found in the\n * LICENSE file in the root directory of this source tree.\n *\n */\n\nimport { useLexicalComposerContext } from '@lexical/react/LexicalComposerContext';\nimport { TreeView } from '@lexical/react/LexicalTreeView';\nimport * as React from 'react';\n\nexport default function TreeViewPlugin(): JSX.Element {\n  const [editor] = useLexicalComposerContext();\n  return (\n    <TreeView\n      viewClassName=\"tree-view-output\"\n      timeTravelPanelClassName=\"debug-timetravel-panel\"\n      timeTravelButtonClassName=\"debug-timetravel-button\"\n      timeTravelPanelSliderClassName=\"debug-timetravel-panel-slider\"\n      timeTravelPanelButtonClassName=\"debug-timetravel-panel-button\"\n      editor={editor}\n    />\n  );\n}\n","/**\n * Copyright (c) Meta Platforms, Inc. and affiliates.\n *\n * This source code is licensed under the MIT license found in the\n * LICENSE file in the root directory of this source tree.\n *\n */\n\nimport './ContentEditable.css';\n\nimport { ContentEditable } from '@lexical/react/LexicalContentEditable';\nimport * as React from 'react';\n\nexport default function LexicalContentEditable({\n  className,\n}: {\n  className?: string;\n}): JSX.Element {\n  return <ContentEditable className={className || 'ContentEditable__root'} />;\n}\n","/**\n * Copyright (c) Meta Platforms, Inc. and affiliates.\n *\n * This source code is licensed under the MIT license found in the\n * LICENSE file in the root directory of this source tree.\n *\n */\n\nimport type { LexicalEditor } from 'lexical';\n\nimport * as React from 'react';\nimport { useRef } from 'react';\n\nfunction clamp(value, min, max) {\n  return Math.min(Math.max(value, min), max);\n}\n\nconst Direction = {\n  east: 1 << 0,\n  north: 1 << 3,\n  south: 1 << 1,\n  west: 1 << 2,\n};\n\nexport default function ImageResizer({\n  onResizeStart,\n  onResizeEnd,\n  imageRef,\n  maxWidth,\n  editor,\n  showCaption,\n  setShowCaption,\n}: {\n  editor: LexicalEditor;\n  imageRef: { current: null | HTMLElement };\n  maxWidth?: number;\n  onResizeEnd: (width: 'inherit' | number, height: 'inherit' | number) => void;\n  onResizeStart: () => void;\n  setShowCaption: (boolean) => void;\n  showCaption: boolean;\n}): JSX.Element {\n  const buttonRef = useRef(null);\n  const positioningRef = useRef<{\n    currentHeight: 'inherit' | number;\n    currentWidth: 'inherit' | number;\n    direction: number;\n    isResizing: boolean;\n    ratio: number;\n    startHeight: number;\n    startWidth: number;\n    startX: number;\n    startY: number;\n  }>({\n    currentHeight: 0,\n    currentWidth: 0,\n    direction: 0,\n    isResizing: false,\n    ratio: 0,\n    startHeight: 0,\n    startWidth: 0,\n    startX: 0,\n    startY: 0,\n  });\n  const editorRootElement = editor.getRootElement();\n  // Find max width, accounting for editor padding.\n  const maxWidthContainer = maxWidth\n    ? maxWidth\n    : editorRootElement !== null\n    ? editorRootElement.getBoundingClientRect().width - 20\n    : 100;\n  const maxHeightContainer =\n    editorRootElement !== null\n      ? editorRootElement.getBoundingClientRect().height - 20\n      : 100;\n\n  const minWidth = 100;\n  const minHeight = 100;\n\n  const setStartCursor = (direction: number) => {\n    const ew = direction === Direction.east || direction === Direction.west;\n    const ns = direction === Direction.north || direction === Direction.south;\n    const nwse =\n      (direction & Direction.north && direction & Direction.west) ||\n      (direction & Direction.south && direction & Direction.east);\n\n    const cursorDir = ew ? 'ew' : ns ? 'ns' : nwse ? 'nwse' : 'nesw';\n\n    if (editorRootElement !== null) {\n      editorRootElement.style.setProperty(\n        'cursor',\n        `${cursorDir}-resize`,\n        'important'\n      );\n    }\n    if (document.body !== null) {\n      document.body.style.setProperty(\n        'cursor',\n        `${cursorDir}-resize`,\n        'important'\n      );\n    }\n  };\n\n  const setEndCursor = () => {\n    if (editorRootElement !== null) {\n      editorRootElement.style.setProperty('cursor', 'default');\n    }\n    if (document.body !== null) {\n      document.body.style.setProperty('cursor', 'default');\n    }\n  };\n\n  const handlePointerDown = (\n    event: React.PointerEvent<HTMLDivElement>,\n    direction: number\n  ) => {\n    const image = imageRef.current;\n    if (image !== null) {\n      const { width, height } = image.getBoundingClientRect();\n      const positioning = positioningRef.current;\n      positioning.startWidth = width;\n      positioning.startHeight = height;\n      positioning.ratio = width / height;\n      positioning.currentWidth = width;\n      positioning.currentHeight = height;\n      positioning.startX = event.clientX;\n      positioning.startY = event.clientY;\n      positioning.isResizing = true;\n      positioning.direction = direction;\n\n      setStartCursor(direction);\n      onResizeStart();\n\n      image.style.height = `${height}px`;\n      image.style.width = `${width}px`;\n\n      document.addEventListener('pointermove', handlePointerMove);\n      document.addEventListener('pointerup', handlePointerUp);\n    }\n  };\n  const handlePointerMove = (event: PointerEvent) => {\n    const image = imageRef.current;\n    const positioning = positioningRef.current;\n\n    const isHorizontal =\n      positioning.direction & (Direction.east | Direction.west);\n    const isVertical =\n      positioning.direction & (Direction.south | Direction.north);\n\n    if (image !== null && positioning.isResizing) {\n      // Corner cursor\n      if (isHorizontal && isVertical) {\n        let diff = Math.floor(positioning.startX - event.clientX);\n        diff = positioning.direction & Direction.east ? -diff : diff;\n\n        const width = clamp(\n          positioning.startWidth + diff,\n          minWidth,\n          maxWidthContainer\n        );\n\n        const height = width / positioning.ratio;\n        image.style.width = `${width}px`;\n        image.style.height = `${height}px`;\n        positioning.currentHeight = height;\n        positioning.currentWidth = width;\n      } else if (isVertical) {\n        let diff = Math.floor(positioning.startY - event.clientY);\n        diff = positioning.direction & Direction.south ? -diff : diff;\n\n        const height = clamp(\n          positioning.startHeight + diff,\n          minHeight,\n          maxHeightContainer\n        );\n\n        image.style.height = `${height}px`;\n        positioning.currentHeight = height;\n      } else {\n        let diff = Math.floor(positioning.startX - event.clientX);\n        diff = positioning.direction & Direction.east ? -diff : diff;\n\n        const width = clamp(\n          positioning.startWidth + diff,\n          minWidth,\n          maxWidthContainer\n        );\n\n        image.style.width = `${width}px`;\n        positioning.currentWidth = width;\n      }\n    }\n  };\n  const handlePointerUp = () => {\n    const image = imageRef.current;\n    const positioning = positioningRef.current;\n    if (image !== null && positioning.isResizing) {\n      const width = positioning.currentWidth;\n      const height = positioning.currentHeight;\n      positioning.startWidth = 0;\n      positioning.startHeight = 0;\n      positioning.ratio = 0;\n      positioning.startX = 0;\n      positioning.startY = 0;\n      positioning.currentWidth = 0;\n      positioning.currentHeight = 0;\n      positioning.isResizing = false;\n\n      setEndCursor();\n      onResizeEnd(width, height);\n\n      document.removeEventListener('pointermove', handlePointerMove);\n      document.removeEventListener('pointerup', handlePointerUp);\n    }\n  };\n  return (\n    <>\n      {!showCaption && (\n        <button\n          className=\"image-caption-button\"\n          ref={buttonRef}\n          onClick={() => {\n            setShowCaption(!showCaption);\n          }}\n        >\n          Add Caption\n        </button>\n      )}\n      <div\n        className=\"image-resizer image-resizer-n\"\n        onPointerDown={(event) => {\n          handlePointerDown(event, Direction.north);\n        }}\n      />\n      <div\n        className=\"image-resizer image-resizer-ne\"\n        onPointerDown={(event) => {\n          handlePointerDown(event, Direction.north | Direction.east);\n        }}\n      />\n      <div\n        className=\"image-resizer image-resizer-e\"\n        onPointerDown={(event) => {\n          handlePointerDown(event, Direction.east);\n        }}\n      />\n      <div\n        className=\"image-resizer image-resizer-se\"\n        onPointerDown={(event) => {\n          handlePointerDown(event, Direction.south | Direction.east);\n        }}\n      />\n      <div\n        className=\"image-resizer image-resizer-s\"\n        onPointerDown={(event) => {\n          handlePointerDown(event, Direction.south);\n        }}\n      />\n      <div\n        className=\"image-resizer image-resizer-sw\"\n        onPointerDown={(event) => {\n          handlePointerDown(event, Direction.south | Direction.west);\n        }}\n      />\n      <div\n        className=\"image-resizer image-resizer-w\"\n        onPointerDown={(event) => {\n          handlePointerDown(event, Direction.west);\n        }}\n      />\n      <div\n        className=\"image-resizer image-resizer-nw\"\n        onPointerDown={(event) => {\n          handlePointerDown(event, Direction.north | Direction.west);\n        }}\n      />\n    </>\n  );\n}\n","/**\n * Copyright (c) Meta Platforms, Inc. and affiliates.\n *\n * This source code is licensed under the MIT license found in the\n * LICENSE file in the root directory of this source tree.\n *\n */\n\nimport './Placeholder.css';\n\nimport * as React from 'react';\n\nexport default function Placeholder({\n  children,\n  className,\n}: {\n  children: JSX.Element | string | (JSX.Element | string)[];\n  className?: string;\n}): JSX.Element {\n  return <div className={className || 'Placeholder__root'}>{children}</div>;\n}\n","/**\n * Copyright (c) Meta Platforms, Inc. and affiliates.\n *\n * This source code is licensed under the MIT license found in the\n * LICENSE file in the root directory of this source tree.\n *\n */\n\nimport type {\n  EditorConfig,\n  LexicalEditor,\n  LexicalNode,\n  NodeKey,\n  SerializedEditor,\n  SerializedLexicalNode,\n} from 'lexical';\n\nimport './ImageNode.css';\n\nimport {\n  CollaborationPlugin,\n  useCollaborationContext,\n} from '@lexical/react/LexicalCollaborationPlugin';\nimport { useLexicalComposerContext } from '@lexical/react/LexicalComposerContext';\nimport { HashtagPlugin } from '@lexical/react/LexicalHashtagPlugin';\nimport { HistoryPlugin } from '@lexical/react/LexicalHistoryPlugin';\nimport { LinkPlugin } from '@lexical/react/LexicalLinkPlugin';\nimport { LexicalNestedComposer } from '@lexical/react/LexicalNestedComposer';\nimport { RichTextPlugin } from '@lexical/react/LexicalRichTextPlugin';\nimport { TablePlugin } from '@lexical/react/LexicalTablePlugin';\nimport { useLexicalNodeSelection } from '@lexical/react/useLexicalNodeSelection';\nimport { mergeRegister } from '@lexical/utils';\nimport {\n  $getNodeByKey,\n  $getSelection,\n  $isNodeSelection,\n  CLICK_COMMAND,\n  COMMAND_PRIORITY_LOW,\n  createEditor,\n  DecoratorNode,\n  KEY_BACKSPACE_COMMAND,\n  KEY_DELETE_COMMAND,\n} from 'lexical';\nimport { Spread } from 'libdefs/globals';\nimport * as React from 'react';\nimport { Suspense, useCallback, useEffect, useRef, useState } from 'react';\n\nimport { createWebsocketProvider } from '../collaboration';\nimport { useSettings } from '../context/SettingsContext';\nimport { useSharedHistoryContext } from '../context/SharedHistoryContext';\nimport EmojisPlugin from '../plugins/EmojisPlugin';\nimport ImagesPlugin from '../plugins/ImagesPlugin';\nimport KeywordsPlugin from '../plugins/KeywordsPlugin';\nimport MentionsPlugin from '../plugins/MentionsPlugin';\nimport TableCellActionMenuPlugin from '../plugins/TableActionMenuPlugin';\nimport TreeViewPlugin from '../plugins/TreeViewPlugin';\nimport ContentEditable from '../ui/ContentEditable';\nimport ImageResizer from '../ui/ImageResizer';\nimport Placeholder from '../ui/Placeholder';\n\nexport interface ImagePayload {\n  altText: string;\n  caption?: LexicalEditor;\n  height?: number;\n  key?: NodeKey;\n  maxWidth?: number;\n  showCaption?: boolean;\n  src: string;\n  width?: number;\n}\n\nconst imageCache = new Set();\n\nfunction useSuspenseImage(src: string) {\n  if (!imageCache.has(src)) {\n    throw new Promise((resolve) => {\n      const img = new Image();\n      img.src = src;\n      img.onload = () => {\n        imageCache.add(src);\n        resolve(null);\n      };\n    });\n  }\n}\n\nfunction LazyImage({\n  altText,\n  className,\n  imageRef,\n  src,\n  width,\n  height,\n  maxWidth,\n}: {\n  altText: string;\n  className: string | null;\n  height: 'inherit' | number;\n  imageRef: { current: null | HTMLImageElement };\n  maxWidth: number;\n  src: string;\n  width: 'inherit' | number;\n}): JSX.Element {\n  useSuspenseImage(src);\n  return (\n    <img\n      className={className}\n      src={src}\n      alt={altText}\n      ref={imageRef}\n      style={{\n        height,\n        maxWidth,\n        width,\n      }}\n      draggable=\"false\"\n    />\n  );\n}\n\nfunction ImageComponent({\n  src,\n  altText,\n  nodeKey,\n  width,\n  height,\n  maxWidth,\n  resizable,\n  showCaption,\n  caption,\n}: {\n  altText: string;\n  caption: LexicalEditor;\n  height: 'inherit' | number;\n  maxWidth: number;\n  nodeKey: NodeKey;\n  resizable: boolean;\n  showCaption: boolean;\n  src: string;\n  width: 'inherit' | number;\n}): JSX.Element {\n  const ref = useRef(null);\n  const [isSelected, setSelected, clearSelection] =\n    useLexicalNodeSelection(nodeKey);\n  const [isResizing, setIsResizing] = useState<boolean>(false);\n  const { yjsDocMap } = useCollaborationContext();\n  const [editor] = useLexicalComposerContext();\n  const isCollab = yjsDocMap.get('main') !== undefined;\n  const [selection, setSelection] = useState(null);\n\n  const onDelete = useCallback(\n    (payload: KeyboardEvent) => {\n      if (isSelected && $isNodeSelection($getSelection())) {\n        const event: KeyboardEvent = payload;\n        event.preventDefault();\n        const node = $getNodeByKey(nodeKey);\n        if ($isImageNode(node)) {\n          node.remove();\n        }\n        setSelected(false);\n      }\n      return false;\n    },\n    [isSelected, nodeKey, setSelected]\n  );\n\n  useEffect(() => {\n    return mergeRegister(\n      editor.registerUpdateListener(({ editorState }) => {\n        setSelection(editorState.read(() => $getSelection()));\n      }),\n      editor.registerCommand<MouseEvent>(\n        CLICK_COMMAND,\n        (payload) => {\n          const event = payload;\n\n          if (isResizing) {\n            return true;\n          }\n          if (event.target === ref.current) {\n            if (!event.shiftKey) {\n              clearSelection();\n            }\n            setSelected(!isSelected);\n            return true;\n          }\n\n          return false;\n        },\n        COMMAND_PRIORITY_LOW\n      ),\n      editor.registerCommand(\n        KEY_DELETE_COMMAND,\n        onDelete,\n        COMMAND_PRIORITY_LOW\n      ),\n      editor.registerCommand(\n        KEY_BACKSPACE_COMMAND,\n        onDelete,\n        COMMAND_PRIORITY_LOW\n      )\n    );\n  }, [\n    clearSelection,\n    editor,\n    isResizing,\n    isSelected,\n    nodeKey,\n    onDelete,\n    setSelected,\n  ]);\n\n  const setShowCaption = () => {\n    editor.update(() => {\n      const node = $getNodeByKey(nodeKey);\n      if ($isImageNode(node)) {\n        node.setShowCaption(true);\n      }\n    });\n  };\n\n  const onResizeEnd = (nextWidth, nextHeight) => {\n    // Delay hiding the resize bars for click case\n    setTimeout(() => {\n      setIsResizing(false);\n    }, 200);\n\n    editor.update(() => {\n      const node = $getNodeByKey(nodeKey);\n      if ($isImageNode(node)) {\n        node.setWidthAndHeight(nextWidth, nextHeight);\n      }\n    });\n  };\n\n  const onResizeStart = () => {\n    setIsResizing(true);\n  };\n\n  const { historyState } = useSharedHistoryContext();\n  const {\n    settings: { showNestedEditorTreeView },\n  } = useSettings();\n\n  const draggable = isSelected && $isNodeSelection(selection);\n  const isFocused = $isNodeSelection(selection) && (isSelected || isResizing);\n\n  return (\n    <Suspense fallback={null}>\n      <>\n        <div draggable={draggable}>\n          <LazyImage\n            className={isFocused ? 'focused' : null}\n            src={src}\n            altText={altText}\n            imageRef={ref}\n            width={width}\n            height={height}\n            maxWidth={maxWidth}\n          />\n        </div>\n        {showCaption && (\n          <div className=\"image-caption-container\">\n            <LexicalNestedComposer initialEditor={caption}>\n              <MentionsPlugin />\n              <TablePlugin />\n              <TableCellActionMenuPlugin />\n              <ImagesPlugin />\n              <LinkPlugin />\n              <EmojisPlugin />\n              <HashtagPlugin />\n              <KeywordsPlugin />\n              {isCollab ? (\n                <CollaborationPlugin\n                  id={caption.getKey()}\n                  providerFactory={createWebsocketProvider}\n                  shouldBootstrap={true}\n                />\n              ) : (\n                <HistoryPlugin externalHistoryState={historyState} />\n              )}\n              <RichTextPlugin\n                contentEditable={\n                  <ContentEditable className=\"ImageNode__contentEditable\" />\n                }\n                placeholder={\n                  <Placeholder className=\"ImageNode__placeholder\">\n                    Enter a caption...\n                  </Placeholder>\n                }\n                initialEditorState={null}\n              />\n              {showNestedEditorTreeView === true ? <TreeViewPlugin /> : null}\n            </LexicalNestedComposer>\n          </div>\n        )}\n        {resizable && isFocused && (\n          <ImageResizer\n            showCaption={showCaption}\n            setShowCaption={setShowCaption}\n            editor={editor}\n            imageRef={ref}\n            maxWidth={maxWidth}\n            onResizeStart={onResizeStart}\n            onResizeEnd={onResizeEnd}\n          />\n        )}\n      </>\n    </Suspense>\n  );\n}\n\nexport type SerializedImageNode = Spread<\n  {\n    altText: string;\n    caption: SerializedEditor;\n    height?: number;\n    maxWidth: number;\n    showCaption: boolean;\n    src: string;\n    width?: number;\n    type: 'image';\n    version: 1;\n  },\n  SerializedLexicalNode\n>;\n\nexport class ImageNode extends DecoratorNode<JSX.Element> {\n  __src: string;\n  __altText: string;\n  __width: 'inherit' | number;\n  __height: 'inherit' | number;\n  __maxWidth: number;\n  __showCaption: boolean;\n  __caption: LexicalEditor;\n\n  static getType(): string {\n    return 'image';\n  }\n\n  static clone(node: ImageNode): ImageNode {\n    return new ImageNode(\n      node.__src,\n      node.__altText,\n      node.__maxWidth,\n      node.__width,\n      node.__height,\n      node.__showCaption,\n      node.__caption,\n      node.__key\n    );\n  }\n\n  static importJSON(serializedNode: SerializedImageNode): ImageNode {\n    const { altText, height, width, maxWidth, caption, src, showCaption } =\n      serializedNode;\n    const node = $createImageNode({\n      altText,\n      height,\n      maxWidth,\n      showCaption,\n      src,\n      width,\n    });\n    const nestedEditor = node.__caption;\n    const editorState = nestedEditor.parseEditorState(caption.editorState);\n    if (!editorState.isEmpty()) {\n      nestedEditor.setEditorState(editorState);\n    }\n    return node;\n  }\n\n  constructor(\n    src: string,\n    altText: string,\n    maxWidth: number,\n    width?: 'inherit' | number,\n    height?: 'inherit' | number,\n    showCaption?: boolean,\n    caption?: LexicalEditor,\n    key?: NodeKey\n  ) {\n    super(key);\n    this.__src = src;\n    this.__altText = altText;\n    this.__maxWidth = maxWidth;\n    this.__width = width || 'inherit';\n    this.__height = height || 'inherit';\n    this.__showCaption = showCaption || false;\n    this.__caption = caption || createEditor();\n  }\n\n  exportJSON(): SerializedImageNode {\n    return {\n      altText: this.getAltText(),\n      caption: this.__caption.toJSON(),\n      height: this.__height === 'inherit' ? 0 : this.__height,\n      maxWidth: this.__maxWidth,\n      showCaption: this.__showCaption,\n      src: this.getSrc(),\n      type: 'image',\n      version: 1,\n      width: this.__width === 'inherit' ? 0 : this.__width,\n    };\n  }\n\n  setWidthAndHeight(\n    width: 'inherit' | number,\n    height: 'inherit' | number\n  ): void {\n    const writable = this.getWritable();\n    writable.__width = width;\n    writable.__height = height;\n  }\n\n  setShowCaption(showCaption: boolean): void {\n    const writable = this.getWritable();\n    writable.__showCaption = showCaption;\n  }\n\n  // View\n\n  createDOM(config: EditorConfig): HTMLElement {\n    const span = document.createElement('span');\n    const theme = config.theme;\n    const className = theme.image;\n    if (className !== undefined) {\n      span.className = className;\n    }\n    return span;\n  }\n\n  updateDOM(): false {\n    return false;\n  }\n\n  getSrc(): string {\n    return this.__src;\n  }\n\n  getAltText(): string {\n    return this.__altText;\n  }\n\n  decorate(): JSX.Element {\n    return (\n      <ImageComponent\n        src={this.__src}\n        altText={this.__altText}\n        width={this.__width}\n        height={this.__height}\n        maxWidth={this.__maxWidth}\n        nodeKey={this.getKey()}\n        showCaption={this.__showCaption}\n        caption={this.__caption}\n        resizable={true}\n      />\n    );\n  }\n}\n\nexport function $createImageNode({\n  altText,\n  height,\n  maxWidth = 500,\n  src,\n  width,\n  showCaption,\n  caption,\n  key,\n}: ImagePayload): ImageNode {\n  return new ImageNode(\n    src,\n    altText,\n    maxWidth,\n    width,\n    height,\n    showCaption,\n    caption,\n    key\n  );\n}\n\nexport function $isImageNode(\n  node: LexicalNode | null | undefined\n): node is ImageNode {\n  return node instanceof ImageNode;\n}\n","/**\n * Copyright (c) Meta Platforms, Inc. and affiliates.\n *\n * This source code is licensed under the MIT license found in the\n * LICENSE file in the root directory of this source tree.\n *\n */\n\nexport default function joinClasses(...args) {\n  return args.filter(Boolean).join(' ');\n}\n","/**\n * Copyright (c) Meta Platforms, Inc. and affiliates.\n *\n * This source code is licensed under the MIT license found in the\n * LICENSE file in the root directory of this source tree.\n *\n */\n\nimport './Button.css';\n\nimport * as React from 'react';\n\nimport joinClasses from '../utils/join-classes';\n\nexport default function Button({\n  'data-test-id': dataTestId,\n  children,\n  className,\n  onClick,\n  disabled,\n  small,\n  title,\n}: {\n  'data-test-id'?: string;\n  children: JSX.Element | string | (JSX.Element | string)[];\n  className?: string;\n  disabled?: boolean;\n  onClick: () => void;\n  small?: boolean;\n  title?: string;\n}): JSX.Element {\n  return (\n    <button\n      disabled={disabled}\n      className={joinClasses(\n        'Button__root',\n        disabled && 'Button__disabled',\n        small && 'Button__small',\n        className\n      )}\n      onClick={onClick}\n      title={title}\n      aria-label={title}\n      {...(dataTestId && { 'data-test-id': dataTestId })}\n    >\n      {children}\n    </button>\n  );\n}\n","/**\n * Copyright (c) Meta Platforms, Inc. and affiliates.\n *\n * This source code is licensed under the MIT license found in the\n * LICENSE file in the root directory of this source tree.\n *\n */\n\nimport type {\n  DOMConversionMap,\n  DOMConversionOutput,\n  DOMExportOutput,\n  LexicalNode,\n  NodeKey,\n  SerializedLexicalNode,\n} from 'lexical';\n\nimport './PollNode.css';\n\nimport { useCollaborationContext } from '@lexical/react/LexicalCollaborationPlugin';\nimport { useLexicalComposerContext } from '@lexical/react/LexicalComposerContext';\nimport { $getNodeByKey, DecoratorNode } from 'lexical';\nimport { Spread } from 'libdefs/globals';\nimport * as React from 'react';\nimport { useMemo, useRef } from 'react';\n\nimport Button from '../ui/Button';\nimport joinClasses from '../utils/join-classes';\n\ntype Options = ReadonlyArray<Option>;\n\ntype Option = Readonly<{\n  text: string;\n  uid: string;\n  votes: Array<number>;\n}>;\n\nfunction createUID(): string {\n  return Math.random()\n    .toString(36)\n    .replace(/[^a-z]+/g, '')\n    .substr(0, 5);\n}\n\nfunction createPollOption(text = ''): Option {\n  return {\n    text,\n    uid: createUID(),\n    votes: [],\n  };\n}\n\nfunction cloneOption(\n  option: Option,\n  text: string,\n  votes?: Array<number>\n): Option {\n  return {\n    text,\n    uid: option.uid,\n    votes: votes || Array.from(option.votes),\n  };\n}\n\nfunction getTotalVotes(options: Options): number {\n  return options.reduce((totalVotes, next) => {\n    return totalVotes + next.votes.length;\n  }, 0);\n}\n\nfunction PollOptionComponent({\n  option,\n  index,\n  options,\n  totalVotes,\n  withPollNode,\n}: {\n  index: number;\n  option: Option;\n  options: Options;\n  totalVotes: number;\n  withPollNode: (cb: (PollNode) => void) => void;\n}): JSX.Element {\n  const { clientID } = useCollaborationContext();\n  const checkboxRef = useRef(null);\n  const votesArray = option.votes;\n  const checkedIndex = votesArray.indexOf(clientID);\n  const checked = checkedIndex !== -1;\n  const votes = votesArray.length;\n  const text = option.text;\n\n  return (\n    <div className=\"PollNode__optionContainer\">\n      <div\n        className={joinClasses(\n          'PollNode__optionCheckboxWrapper',\n          checked && 'PollNode__optionCheckboxChecked'\n        )}\n      >\n        <input\n          ref={checkboxRef}\n          className=\"PollNode__optionCheckbox\"\n          type=\"checkbox\"\n          onChange={(e) => {\n            withPollNode((node) => {\n              node.toggleVote(option, clientID);\n            });\n          }}\n          checked={checked}\n        />\n      </div>\n      <div className=\"PollNode__optionInputWrapper\">\n        <div\n          className=\"PollNode__optionInputVotes\"\n          style={{ width: `${votes === 0 ? 0 : (votes / totalVotes) * 100}%` }}\n        />\n        <span className=\"PollNode__optionInputVotesCount\">\n          {votes > 0 && (votes === 1 ? '1 vote' : `${votes} votes`)}\n        </span>\n        <input\n          className=\"PollNode__optionInput\"\n          type=\"text\"\n          value={text}\n          onChange={(e) => {\n            withPollNode((node) => {\n              node.setOptionText(option, e.target.value);\n            });\n          }}\n          placeholder={`Option ${index + 1}`}\n        />\n      </div>\n      <button\n        disabled={options.length < 3}\n        className={joinClasses(\n          'PollNode__optionDelete',\n          options.length < 3 && 'PollNode__optionDeleteDisabled'\n        )}\n        arial-label=\"Remove\"\n        onClick={() => {\n          withPollNode((node) => {\n            node.deleteOption(option);\n          });\n        }}\n      />\n    </div>\n  );\n}\n\nfunction PollComponent({\n  question,\n  options,\n  nodeKey,\n}: {\n  nodeKey: NodeKey;\n  options: Options;\n  question: string;\n}): JSX.Element {\n  const [editor] = useLexicalComposerContext();\n  const totalVotes = useMemo(() => getTotalVotes(options), [options]);\n\n  const withPollNode = (cb: (node: PollNode) => void): void => {\n    editor.update(() => {\n      const node = $getNodeByKey(nodeKey);\n      if ($isPollNode(node)) {\n        cb(node);\n      }\n    });\n  };\n\n  const addOption = () => {\n    withPollNode((node) => {\n      node.addOption(createPollOption());\n    });\n  };\n\n  return (\n    <div className=\"PollNode__container\">\n      <h2 className=\"PollNode__heading\">{question}</h2>\n      {options.map((option, index) => {\n        const key = option.uid;\n        return (\n          <PollOptionComponent\n            key={key}\n            withPollNode={withPollNode}\n            option={option}\n            index={index}\n            options={options}\n            totalVotes={totalVotes}\n          />\n        );\n      })}\n      <div className=\"PollNode__footer\">\n        <Button onClick={addOption} small={true}>\n          Add Option\n        </Button>\n      </div>\n    </div>\n  );\n}\n\nexport type SerializedPollNode = Spread<\n  {\n    question: string;\n    options: Options;\n    type: 'poll';\n    version: 1;\n  },\n  SerializedLexicalNode\n>;\n\nfunction convertPollElement(domNode: HTMLElement): DOMConversionOutput {\n  const question = domNode.getAttribute('data-lexical-poll-question');\n  const node = $createPollNode(question);\n  return { node };\n}\n\nexport class PollNode extends DecoratorNode<JSX.Element> {\n  __question: string;\n  __options: Options;\n\n  static getType(): string {\n    return 'poll';\n  }\n\n  static clone(node: PollNode): PollNode {\n    return new PollNode(node.__question, node.__options, node.__key);\n  }\n\n  static importJSON(serializedNode: SerializedPollNode): PollNode {\n    const node = $createPollNode(serializedNode.question);\n    serializedNode.options.forEach(node.addOption);\n    return node;\n  }\n\n  constructor(question: string, options?: Options, key?: NodeKey) {\n    super(key);\n    this.__question = question;\n    this.__options = options || [createPollOption(), createPollOption()];\n  }\n\n  exportJSON(): SerializedPollNode {\n    return {\n      options: this.__options,\n      question: this.__question,\n      type: 'poll',\n      version: 1,\n    };\n  }\n\n  addOption(option: Option): void {\n    const self = this.getWritable();\n    const options = Array.from(self.__options);\n    options.push(option);\n    self.__options = options;\n  }\n\n  deleteOption(option: Option): void {\n    const self = this.getWritable();\n    const options = Array.from(self.__options);\n    const index = options.indexOf(option);\n    options.splice(index, 1);\n    self.__options = options;\n  }\n\n  setOptionText(option: Option, text: string): void {\n    const self = this.getWritable();\n    const clonedOption = cloneOption(option, text);\n    const options = Array.from(self.__options);\n    const index = options.indexOf(option);\n    options[index] = clonedOption;\n    self.__options = options;\n  }\n\n  toggleVote(option: Option, clientID: number): void {\n    const self = this.getWritable();\n    const votes = option.votes;\n    const votesClone = Array.from(votes);\n    const voteIndex = votes.indexOf(clientID);\n    if (voteIndex === -1) {\n      votesClone.push(clientID);\n    } else {\n      votesClone.splice(voteIndex, 1);\n    }\n    const clonedOption = cloneOption(option, option.text, votesClone);\n    const options = Array.from(self.__options);\n    const index = options.indexOf(option);\n    options[index] = clonedOption;\n    self.__options = options;\n  }\n\n  static importDOM(): DOMConversionMap | null {\n    return {\n      span: (domNode: HTMLElement) => {\n        if (!domNode.hasAttribute('data-lexical-poll-question')) {\n          return null;\n        }\n        return {\n          conversion: convertPollElement,\n          priority: 2,\n        };\n      },\n    };\n  }\n\n  exportDOM(): DOMExportOutput {\n    const element = document.createElement('span');\n    element.setAttribute('data-lexical-poll-question', this.__question);\n    return { element };\n  }\n\n  createDOM(): HTMLElement {\n    const elem = document.createElement('span');\n    elem.style.display = 'inline-block';\n    return elem;\n  }\n\n  updateDOM(): false {\n    return false;\n  }\n\n  decorate(): JSX.Element {\n    return (\n      <PollComponent\n        question={this.__question}\n        options={this.__options}\n        nodeKey={this.__key}\n      />\n    );\n  }\n}\n\nexport function $createPollNode(question: string): PollNode {\n  return new PollNode(question);\n}\n\nexport function $isPollNode(\n  node: LexicalNode | null | undefined\n): node is PollNode {\n  return node instanceof PollNode;\n}\n","/**\n * Copyright (c) Meta Platforms, Inc. and affiliates.\n *\n * This source code is licensed under the MIT license found in the\n * LICENSE file in the root directory of this source tree.\n *\n */\n\nimport type { EditorThemeClasses } from 'lexical';\n\nimport './PlaygroundEditorTheme.css';\n\nconst theme: EditorThemeClasses = {\n  characterLimit: 'PlaygroundEditorTheme__characterLimit',\n  code: 'PlaygroundEditorTheme__code',\n  codeHighlight: {\n    atrule: 'PlaygroundEditorTheme__tokenAttr',\n    attr: 'PlaygroundEditorTheme__tokenAttr',\n    boolean: 'PlaygroundEditorTheme__tokenProperty',\n    builtin: 'PlaygroundEditorTheme__tokenSelector',\n    cdata: 'PlaygroundEditorTheme__tokenComment',\n    char: 'PlaygroundEditorTheme__tokenSelector',\n    class: 'PlaygroundEditorTheme__tokenFunction',\n    'class-name': 'PlaygroundEditorTheme__tokenFunction',\n    comment: 'PlaygroundEditorTheme__tokenComment',\n    constant: 'PlaygroundEditorTheme__tokenProperty',\n    deleted: 'PlaygroundEditorTheme__tokenProperty',\n    doctype: 'PlaygroundEditorTheme__tokenComment',\n    entity: 'PlaygroundEditorTheme__tokenOperator',\n    function: 'PlaygroundEditorTheme__tokenFunction',\n    important: 'PlaygroundEditorTheme__tokenVariable',\n    inserted: 'PlaygroundEditorTheme__tokenSelector',\n    keyword: 'PlaygroundEditorTheme__tokenAttr',\n    namespace: 'PlaygroundEditorTheme__tokenVariable',\n    number: 'PlaygroundEditorTheme__tokenProperty',\n    operator: 'PlaygroundEditorTheme__tokenOperator',\n    prolog: 'PlaygroundEditorTheme__tokenComment',\n    property: 'PlaygroundEditorTheme__tokenProperty',\n    punctuation: 'PlaygroundEditorTheme__tokenPunctuation',\n    regex: 'PlaygroundEditorTheme__tokenVariable',\n    selector: 'PlaygroundEditorTheme__tokenSelector',\n    string: 'PlaygroundEditorTheme__tokenSelector',\n    symbol: 'PlaygroundEditorTheme__tokenProperty',\n    tag: 'PlaygroundEditorTheme__tokenProperty',\n    url: 'PlaygroundEditorTheme__tokenOperator',\n    variable: 'PlaygroundEditorTheme__tokenVariable',\n  },\n  hashtag: 'PlaygroundEditorTheme__hashtag',\n  heading: {\n    h1: 'PlaygroundEditorTheme__h1',\n    h2: 'PlaygroundEditorTheme__h2',\n    h3: 'PlaygroundEditorTheme__h3',\n    h4: 'PlaygroundEditorTheme__h4',\n    h5: 'PlaygroundEditorTheme__h5',\n  },\n  image: 'editor-image',\n  link: 'PlaygroundEditorTheme__link',\n  list: {\n    listitem: 'PlaygroundEditorTheme__listItem',\n    listitemChecked: 'PlaygroundEditorTheme__listItemChecked',\n    listitemUnchecked: 'PlaygroundEditorTheme__listItemUnchecked',\n    nested: {\n      listitem: 'PlaygroundEditorTheme__nestedListItem',\n    },\n    olDepth: [\n      'PlaygroundEditorTheme__ol1',\n      'PlaygroundEditorTheme__ol2',\n      'PlaygroundEditorTheme__ol3',\n      'PlaygroundEditorTheme__ol4',\n      'PlaygroundEditorTheme__ol5',\n    ],\n    ul: 'PlaygroundEditorTheme__ul',\n  },\n  ltr: 'PlaygroundEditorTheme__ltr',\n  mark: 'PlaygroundEditorTheme__mark',\n  markOverlap: 'PlaygroundEditorTheme__markOverlap',\n  paragraph: 'PlaygroundEditorTheme__paragraph',\n  quote: 'PlaygroundEditorTheme__quote',\n  rtl: 'PlaygroundEditorTheme__rtl',\n  table: 'PlaygroundEditorTheme__table',\n  tableCell: 'PlaygroundEditorTheme__tableCell',\n  tableCellHeader: 'PlaygroundEditorTheme__tableCellHeader',\n  text: {\n    bold: 'PlaygroundEditorTheme__textBold',\n    code: 'PlaygroundEditorTheme__textCode',\n    italic: 'PlaygroundEditorTheme__textItalic',\n    strikethrough: 'PlaygroundEditorTheme__textStrikethrough',\n    subscript: 'PlaygroundEditorTheme__textSubscript',\n    superscript: 'PlaygroundEditorTheme__textSuperscript',\n    underline: 'PlaygroundEditorTheme__textUnderline',\n    underlineStrikethrough: 'PlaygroundEditorTheme__textUnderlineStrikethrough',\n  },\n};\n\nexport default theme;\n","/**\n * Copyright (c) Meta Platforms, Inc. and affiliates.\n *\n * This source code is licensed under the MIT license found in the\n * LICENSE file in the root directory of this source tree.\n *\n */\n\nimport type { EditorThemeClasses } from 'lexical';\n\nimport './StickyEditorTheme.css';\n\nimport baseTheme from './PlaygroundEditorTheme';\n\nconst theme: EditorThemeClasses = {\n  ...baseTheme,\n  paragraph: 'StickyEditorTheme__paragraph',\n};\n\nexport default theme;\n","/**\n * Copyright (c) Meta Platforms, Inc. and affiliates.\n *\n * This source code is licensed under the MIT license found in the\n * LICENSE file in the root directory of this source tree.\n *\n */\n\nimport type {\n  EditorConfig,\n  LexicalEditor,\n  LexicalNode,\n  NodeKey,\n  SerializedLexicalNode,\n} from 'lexical';\n\nimport './StickyNode.css';\n\nimport {\n  CollaborationPlugin,\n  useCollaborationContext,\n} from '@lexical/react/LexicalCollaborationPlugin';\nimport { useLexicalComposerContext } from '@lexical/react/LexicalComposerContext';\nimport { HistoryPlugin } from '@lexical/react/LexicalHistoryPlugin';\nimport { LexicalNestedComposer } from '@lexical/react/LexicalNestedComposer';\nimport { PlainTextPlugin } from '@lexical/react/LexicalPlainTextPlugin';\nimport {\n  $getNodeByKey,\n  $setSelection,\n  createEditor,\n  DecoratorNode,\n} from 'lexical';\nimport { Spread } from 'libdefs/globals';\nimport * as React from 'react';\nimport { useEffect, useRef } from 'react';\nimport { createPortal } from 'react-dom';\nimport useLayoutEffect from '../shared/src/useLayoutEffect';\n\nimport { createWebsocketProvider } from '../collaboration';\nimport { useSharedHistoryContext } from '../context/SharedHistoryContext';\nimport StickyEditorTheme from '../themes/StickyEditorTheme';\nimport ContentEditable from '../ui/ContentEditable';\nimport Placeholder from '../ui/Placeholder';\n\nfunction positionSticky(stickyElem: HTMLElement, positioning): void {\n  const style = stickyElem.style;\n  const rootElementRect = positioning.rootElementRect;\n  const rectLeft = rootElementRect !== null ? rootElementRect.left : 0;\n  const rectTop = rootElementRect !== null ? rootElementRect.top : 0;\n  style.top = rectTop + positioning.y + 'px';\n  style.left = rectLeft + positioning.x + 'px';\n}\n\nfunction StickyComponent({\n  x,\n  y,\n  nodeKey,\n  color,\n  caption,\n}: {\n  caption: LexicalEditor;\n  color: 'pink' | 'yellow';\n  nodeKey: NodeKey;\n  x: number;\n  y: number;\n}): JSX.Element {\n  const [editor] = useLexicalComposerContext();\n  const stickyContainerRef = useRef<null | HTMLDivElement>(null);\n  const positioningRef = useRef<{\n    isDragging: boolean;\n    offsetX: number;\n    offsetY: number;\n    rootElementRect: null | ClientRect;\n    x: number;\n    y: number;\n  }>({\n    isDragging: false,\n    offsetX: 0,\n    offsetY: 0,\n    rootElementRect: null,\n    x: 0,\n    y: 0,\n  });\n  const { yjsDocMap } = useCollaborationContext();\n  const isCollab = yjsDocMap.get('main') !== undefined;\n\n  useEffect(() => {\n    const position = positioningRef.current;\n    position.x = x;\n    position.y = y;\n\n    const stickyContainer = stickyContainerRef.current;\n    if (stickyContainer !== null) {\n      positionSticky(stickyContainer, position);\n    }\n  }, [x, y]);\n\n  useLayoutEffect(() => {\n    const position = positioningRef.current;\n    const resizeObserver = new ResizeObserver((entries) => {\n      for (let i = 0; i < entries.length; i++) {\n        const entry = entries[i];\n        const { target } = entry;\n        position.rootElementRect = target.getBoundingClientRect();\n        const stickyContainer = stickyContainerRef.current;\n        if (stickyContainer !== null) {\n          positionSticky(stickyContainer, position);\n        }\n      }\n    });\n\n    const removeRootListener = editor.registerRootListener(\n      (nextRootElem, prevRootElem) => {\n        if (prevRootElem !== null) {\n          resizeObserver.unobserve(prevRootElem);\n        }\n        if (nextRootElem !== null) {\n          resizeObserver.observe(nextRootElem);\n        }\n      }\n    );\n\n    const handleWindowResize = () => {\n      const rootElement = editor.getRootElement();\n      const stickyContainer = stickyContainerRef.current;\n      if (rootElement !== null && stickyContainer !== null) {\n        position.rootElementRect = rootElement.getBoundingClientRect();\n        positionSticky(stickyContainer, position);\n      }\n    };\n\n    window.addEventListener('resize', handleWindowResize);\n\n    return () => {\n      window.removeEventListener('resize', handleWindowResize);\n      removeRootListener();\n    };\n  }, [editor]);\n\n  useEffect(() => {\n    const stickyContainer = stickyContainerRef.current;\n    if (stickyContainer !== null) {\n      // Delay adding transition so we don't trigger the\n      // transition on load of the sticky.\n      setTimeout(() => {\n        stickyContainer.style.setProperty(\n          'transition',\n          'top 0.3s ease 0s, left 0.3s ease 0s'\n        );\n      }, 500);\n    }\n  }, []);\n\n  const handlePointerMove = (event: PointerEvent) => {\n    const stickyContainer = stickyContainerRef.current;\n    const positioning = positioningRef.current;\n    const rootElementRect = positioning.rootElementRect;\n    if (\n      stickyContainer !== null &&\n      positioning.isDragging &&\n      rootElementRect !== null\n    ) {\n      positioning.x = event.pageX - positioning.offsetX - rootElementRect.left;\n      positioning.y = event.pageY - positioning.offsetY - rootElementRect.top;\n      positionSticky(stickyContainer, positioning);\n    }\n  };\n\n  const handlePointerUp = (event: PointerEvent) => {\n    const stickyContainer = stickyContainerRef.current;\n    const positioning = positioningRef.current;\n    if (stickyContainer !== null) {\n      positioning.isDragging = false;\n      stickyContainer.classList.remove('dragging');\n      editor.update(() => {\n        const node = $getNodeByKey(nodeKey);\n        if ($isStickyNode(node)) {\n          node.setPosition(positioning.x, positioning.y);\n        }\n      });\n    }\n    document.removeEventListener('pointermove', handlePointerMove);\n    document.removeEventListener('pointerup', handlePointerUp);\n  };\n\n  const handleDelete = () => {\n    editor.update(() => {\n      const node = $getNodeByKey(nodeKey);\n      if ($isStickyNode(node)) {\n        node.remove();\n      }\n    });\n  };\n\n  const handleColorChange = () => {\n    editor.update(() => {\n      const node = $getNodeByKey(nodeKey);\n      if ($isStickyNode(node)) {\n        node.toggleColor();\n      }\n    });\n  };\n\n  const { historyState } = useSharedHistoryContext();\n\n  return (\n    <div ref={stickyContainerRef} className=\"sticky-note-container\">\n      <div\n        className={`sticky-note ${color}`}\n        onPointerDown={(event) => {\n          const stickyContainer = stickyContainerRef.current;\n          if (\n            stickyContainer == null ||\n            event.button === 2 ||\n            event.target !== stickyContainer.firstChild\n          ) {\n            // Right click or click on editor should not work\n            return;\n          }\n          const stickContainer = stickyContainer;\n          const positioning = positioningRef.current;\n          if (stickContainer !== null) {\n            const { top, left } = stickContainer.getBoundingClientRect();\n            positioning.offsetX = event.clientX - left;\n            positioning.offsetY = event.clientY - top;\n            positioning.isDragging = true;\n            stickContainer.classList.add('dragging');\n            document.addEventListener('pointermove', handlePointerMove);\n            document.addEventListener('pointerup', handlePointerUp);\n            event.preventDefault();\n          }\n        }}\n      >\n        <button\n          onClick={handleDelete}\n          className=\"delete\"\n          aria-label=\"Delete sticky note\"\n          title=\"Delete\"\n        >\n          X\n        </button>\n        <button\n          onClick={handleColorChange}\n          className=\"color\"\n          aria-label=\"Change sticky note color\"\n          title=\"Color\"\n        >\n          <i className=\"bucket\" />\n        </button>\n        <LexicalNestedComposer\n          initialEditor={caption}\n          initialTheme={StickyEditorTheme}\n        >\n          {isCollab ? (\n            <CollaborationPlugin\n              id={caption.getKey()}\n              providerFactory={createWebsocketProvider}\n              shouldBootstrap={true}\n            />\n          ) : (\n            <HistoryPlugin externalHistoryState={historyState} />\n          )}\n          <PlainTextPlugin\n            contentEditable={\n              <ContentEditable className=\"StickyNode__contentEditable\" />\n            }\n            placeholder={\n              <Placeholder className=\"StickyNode__placeholder\">\n                What's up?\n              </Placeholder>\n            }\n            initialEditorState={null}\n          />\n        </LexicalNestedComposer>\n      </div>\n    </div>\n  );\n}\n\ntype StickyNoteColor = 'pink' | 'yellow';\n\nexport type SerializedStickyNode = Spread<\n  {\n    xOffset: number;\n    yOffset: number;\n    color: StickyNoteColor;\n    caption: LexicalEditor;\n    type: 'sticky';\n    version: 1;\n  },\n  SerializedLexicalNode\n>;\n\nexport class StickyNode extends DecoratorNode<JSX.Element> {\n  __x: number;\n  __y: number;\n  __color: StickyNoteColor;\n  __caption: LexicalEditor;\n\n  static getType(): string {\n    return 'sticky';\n  }\n\n  static clone(node: StickyNode): StickyNode {\n    return new StickyNode(\n      node.__x,\n      node.__y,\n      node.__color,\n      node.__caption,\n      node.__key\n    );\n  }\n  static importJSON(serializedNode: SerializedStickyNode): StickyNode {\n    return new StickyNode(\n      serializedNode.xOffset,\n      serializedNode.yOffset,\n      serializedNode.color,\n      serializedNode.caption\n    );\n  }\n\n  constructor(\n    x: number,\n    y: number,\n    color: 'pink' | 'yellow',\n    caption?: LexicalEditor,\n    key?: NodeKey\n  ) {\n    super(key);\n    this.__x = x;\n    this.__y = y;\n    this.__caption = caption || createEditor();\n    this.__color = color;\n  }\n\n  exportJSON(): SerializedStickyNode {\n    return {\n      caption: this.__caption,\n      color: this.__color,\n      type: 'sticky',\n      version: 1,\n      xOffset: this.__x,\n      yOffset: this.__y,\n    };\n  }\n\n  createDOM(config: EditorConfig): HTMLElement {\n    const div = document.createElement('div');\n    div.style.display = 'contents';\n    return div;\n  }\n\n  updateDOM(): false {\n    return false;\n  }\n\n  setPosition(x: number, y: number): void {\n    const writable = this.getWritable();\n    writable.__x = x;\n    writable.__y = y;\n    $setSelection(null);\n  }\n\n  toggleColor(): void {\n    const writable = this.getWritable();\n    writable.__color = writable.__color === 'pink' ? 'yellow' : 'pink';\n  }\n\n  decorate(editor: LexicalEditor): JSX.Element {\n    return createPortal(\n      <StickyComponent\n        color={this.__color}\n        x={this.__x}\n        y={this.__y}\n        nodeKey={this.getKey()}\n        caption={this.__caption}\n      />,\n      document.body\n    );\n  }\n\n  isIsolated(): true {\n    return true;\n  }\n}\n\nexport function $isStickyNode(\n  node: LexicalNode | null | undefined\n): node is StickyNode {\n  return node instanceof StickyNode;\n}\n\nexport function $createStickyNode(\n  xOffset: number,\n  yOffset: number\n): StickyNode {\n  return new StickyNode(xOffset, yOffset, 'yellow');\n}\n","/**\n * Copyright (c) Meta Platforms, Inc. and affiliates.\n *\n * This source code is licensed under the MIT license found in the\n * LICENSE file in the root directory of this source tree.\n *\n */\n\nimport type {\n  DOMConversionMap,\n  DOMConversionOutput,\n  DOMExportOutput,\n  EditorConfig,\n  ElementFormatType,\n  LexicalEditor,\n  LexicalNode,\n  NodeKey,\n  Spread,\n} from 'lexical';\n\nimport { BlockWithAlignableContents } from '@lexical/react/LexicalBlockWithAlignableContents';\nimport {\n  DecoratorBlockNode,\n  SerializedDecoratorBlockNode,\n} from '@lexical/react/LexicalDecoratorBlockNode';\nimport * as React from 'react';\nimport { useCallback, useEffect, useRef, useState } from 'react';\n\nconst WIDGET_SCRIPT_URL = 'https://platform.twitter.com/widgets.js';\n\ntype TweetComponentProps = Readonly<{\n  className: Readonly<{\n    base: string;\n    focus: string;\n  }>;\n  format: ElementFormatType | null;\n  loadingComponent?: JSX.Element | string;\n  nodeKey: NodeKey;\n  onError?: (error: string) => void;\n  onLoad?: () => void;\n  tweetID: string;\n}>;\n\nfunction convertTweetElement(\n  domNode: HTMLDivElement\n): DOMConversionOutput | null {\n  const id = domNode.getAttribute('data-lexical-tweet-id');\n  if (id) {\n    const node = $createTweetNode(id);\n    return { node };\n  }\n  return null;\n}\n\nlet isTwitterScriptLoading = true;\n\nfunction TweetComponent({\n  className,\n  format,\n  loadingComponent,\n  nodeKey,\n  onError,\n  onLoad,\n  tweetID,\n}: TweetComponentProps) {\n  const containerRef = useRef<HTMLDivElement | null>(null);\n\n  const previousTweetIDRef = useRef<string>('');\n  const [isTweetLoading, setIsTweetLoading] = useState(false);\n\n  const createTweet = useCallback(async () => {\n    try {\n      // @ts-expect-error Twitter is attached to the window.\n      await window.twttr.widgets.createTweet(tweetID, containerRef.current);\n\n      setIsTweetLoading(false);\n      isTwitterScriptLoading = false;\n\n      if (onLoad) {\n        onLoad();\n      }\n    } catch (error) {\n      if (onError) {\n        onError(String(error));\n      }\n    }\n  }, [onError, onLoad, tweetID]);\n\n  useEffect(() => {\n    if (tweetID !== previousTweetIDRef.current) {\n      setIsTweetLoading(true);\n\n      if (isTwitterScriptLoading) {\n        const script = document.createElement('script');\n        script.src = WIDGET_SCRIPT_URL;\n        script.async = true;\n        document.body?.appendChild(script);\n        script.onload = createTweet;\n        if (onError) {\n          script.onerror = onError as OnErrorEventHandler;\n        }\n      } else {\n        createTweet();\n      }\n\n      if (previousTweetIDRef) {\n        previousTweetIDRef.current = tweetID;\n      }\n    }\n  }, [createTweet, onError, tweetID]);\n\n  return (\n    <BlockWithAlignableContents\n      className={className}\n      format={format}\n      nodeKey={nodeKey}\n    >\n      {isTweetLoading ? loadingComponent : null}\n      <div\n        style={{ display: 'inline-block', width: '550px' }}\n        ref={containerRef}\n      />\n    </BlockWithAlignableContents>\n  );\n}\n\nexport type SerializedTweetNode = Spread<\n  {\n    id: string;\n    type: 'tweet';\n    version: 1;\n  },\n  SerializedDecoratorBlockNode\n>;\n\nexport class TweetNode extends DecoratorBlockNode {\n  __id: string;\n\n  static getType(): string {\n    return 'tweet';\n  }\n\n  static clone(node: TweetNode): TweetNode {\n    return new TweetNode(node.__id, node.__format, node.__key);\n  }\n\n  static importJSON(serializedNode: SerializedTweetNode): TweetNode {\n    const node = $createTweetNode(serializedNode.id);\n    node.setFormat(serializedNode.format);\n    return node;\n  }\n\n  exportJSON(): SerializedTweetNode {\n    return {\n      ...super.exportJSON(),\n      id: this.getId(),\n      type: 'tweet',\n      version: 1,\n    };\n  }\n\n  static importDOM(): DOMConversionMap<HTMLDivElement> | null {\n    return {\n      div: (domNode: HTMLDivElement) => {\n        if (!domNode.hasAttribute('data-lexical-tweet-id')) {\n          return null;\n        }\n        return {\n          conversion: convertTweetElement,\n          priority: 2,\n        };\n      },\n    };\n  }\n\n  exportDOM(): DOMExportOutput {\n    const element = document.createElement('div');\n    element.setAttribute('data-lexical-tweet-id', this.__id);\n    return { element };\n  }\n\n  constructor(id: string, format?: ElementFormatType, key?: NodeKey) {\n    super(format, key);\n    this.__id = id;\n  }\n\n  getId(): string {\n    return this.__id;\n  }\n\n  decorate(editor: LexicalEditor, config: EditorConfig): JSX.Element {\n    const embedBlockTheme = config.theme.embedBlock || {};\n    const className = {\n      base: embedBlockTheme.base || '',\n      focus: embedBlockTheme.focus || '',\n    };\n    return (\n      <TweetComponent\n        className={className}\n        format={this.__format}\n        loadingComponent=\"Loading...\"\n        nodeKey={this.getKey()}\n        tweetID={this.__id}\n      />\n    );\n  }\n\n  isTopLevel(): true {\n    return true;\n  }\n}\n\nexport function $createTweetNode(tweetID: string): TweetNode {\n  return new TweetNode(tweetID);\n}\n\nexport function $isTweetNode(\n  node: TweetNode | LexicalNode | null | undefined\n): node is TweetNode {\n  return node instanceof TweetNode;\n}\n","/**\n * Copyright (c) Meta Platforms, Inc. and affiliates.\n *\n * This source code is licensed under the MIT license found in the\n * LICENSE file in the root directory of this source tree.\n *\n */\n\nimport type { EditorConfig } from 'lexical';\nimport SerializedTextNode from 'lexical';\n\nimport { Spread } from 'globals';\nimport { TextNode } from 'lexical';\n\nexport type SerializedTypeaheadNode = Spread<\n  {\n    type: 'typeahead';\n    version: 1;\n  },\n  typeof SerializedTextNode\n>;\n\nexport class TypeaheadNode extends TextNode {\n  static clone(node: TypeaheadNode): TypeaheadNode {\n    return new TypeaheadNode(node.__text, node.__key);\n  }\n\n  static getType(): 'typeahead' {\n    return 'typeahead';\n  }\n\n  static importJSON(serializedNode: SerializedTypeaheadNode): TypeaheadNode {\n    const node = $createTypeaheadNode(serializedNode.text);\n    node.setFormat(serializedNode.format);\n    node.setDetail(serializedNode.detail);\n    node.setMode(serializedNode.mode);\n    node.setStyle(serializedNode.style);\n    return node;\n  }\n\n  exportJSON(): SerializedTypeaheadNode {\n    return {\n      ...super.exportJSON(),\n      type: 'typeahead',\n      version: 1,\n    };\n  }\n\n  createDOM(config: EditorConfig): HTMLElement {\n    const dom = super.createDOM(config);\n    dom.style.cssText = 'color: #ccc;';\n    return dom;\n  }\n}\n\nexport function $createTypeaheadNode(text: string): TypeaheadNode {\n  return new TypeaheadNode(text).setMode('inert');\n}\n","/**\n * Copyright (c) Meta Platforms, Inc. and affiliates.\n *\n * This source code is licensed under the MIT license found in the\n * LICENSE file in the root directory of this source tree.\n *\n */\n\nimport type {\n  EditorConfig,\n  ElementFormatType,\n  LexicalEditor,\n  LexicalNode,\n  NodeKey,\n  Spread,\n} from 'lexical';\n\nimport { BlockWithAlignableContents } from '@lexical/react/LexicalBlockWithAlignableContents';\nimport {\n  DecoratorBlockNode,\n  SerializedDecoratorBlockNode,\n} from '@lexical/react/LexicalDecoratorBlockNode';\nimport * as React from 'react';\n\ntype YouTubeComponentProps = Readonly<{\n  className: Readonly<{\n    base: string;\n    focus: string;\n  }>;\n  format: ElementFormatType | null;\n  nodeKey: NodeKey;\n  videoID: string;\n}>;\n\nfunction YouTubeComponent({\n  className,\n  format,\n  nodeKey,\n  videoID,\n}: YouTubeComponentProps) {\n  return (\n    <BlockWithAlignableContents\n      className={className}\n      format={format}\n      nodeKey={nodeKey}\n    >\n      <iframe\n        width=\"560\"\n        height=\"315\"\n        src={`https://www.youtube.com/embed/${videoID}`}\n        frameBorder=\"0\"\n        allow=\"accelerometer; autoplay; clipboard-write; encrypted-media; gyroscope; picture-in-picture\"\n        allowFullScreen={true}\n        title=\"YouTube video\"\n      />\n    </BlockWithAlignableContents>\n  );\n}\n\nexport type SerializedYouTubeNode = Spread<\n  {\n    videoID: string;\n    type: 'youtube';\n    version: 1;\n  },\n  SerializedDecoratorBlockNode\n>;\n\nexport class YouTubeNode extends DecoratorBlockNode {\n  __id: string;\n\n  static getType(): string {\n    return 'youtube';\n  }\n\n  static clone(node: YouTubeNode): YouTubeNode {\n    return new YouTubeNode(node.__id, node.__format, node.__key);\n  }\n\n  static importJSON(serializedNode: SerializedYouTubeNode): YouTubeNode {\n    const node = $createYouTubeNode(serializedNode.videoID);\n    node.setFormat(serializedNode.format);\n    return node;\n  }\n\n  exportJSON(): SerializedYouTubeNode {\n    return {\n      ...super.exportJSON(),\n      type: 'youtube',\n      version: 1,\n      videoID: this.__id,\n    };\n  }\n\n  constructor(id: string, format?: ElementFormatType, key?: NodeKey) {\n    super(format, key);\n    this.__id = id;\n  }\n\n  updateDOM(): false {\n    return false;\n  }\n\n  getId(): string {\n    return this.__id;\n  }\n\n  decorate(_editor: LexicalEditor, config: EditorConfig): JSX.Element {\n    const embedBlockTheme = config.theme.embedBlock || {};\n    const className = {\n      base: embedBlockTheme.base || '',\n      focus: embedBlockTheme.focus || '',\n    };\n    return (\n      <YouTubeComponent\n        className={className}\n        format={this.__format}\n        nodeKey={this.getKey()}\n        videoID={this.__id}\n      />\n    );\n  }\n\n  isTopLevel(): true {\n    return true;\n  }\n}\n\nexport function $createYouTubeNode(videoID: string): YouTubeNode {\n  return new YouTubeNode(videoID);\n}\n\nexport function $isYouTubeNode(\n  node: YouTubeNode | LexicalNode | null | undefined\n): node is YouTubeNode {\n  return node instanceof YouTubeNode;\n}\n","/**\n * Copyright (c) Meta Platforms, Inc. and affiliates.\n *\n * This source code is licensed under the MIT license found in the\n * LICENSE file in the root directory of this source tree.\n *\n */\n\nimport type { LexicalNode } from 'lexical';\n\nimport { CodeHighlightNode, CodeNode } from '@lexical/code';\nimport { HashtagNode } from '@lexical/hashtag';\nimport { AutoLinkNode, LinkNode } from '@lexical/link';\nimport { ListItemNode, ListNode } from '@lexical/list';\nimport { MarkNode } from '@lexical/mark';\nimport { OverflowNode } from '@lexical/overflow';\nimport { HorizontalRuleNode } from '@lexical/react/LexicalHorizontalRuleNode';\nimport { HeadingNode, QuoteNode } from '@lexical/rich-text';\nimport { TableCellNode, TableNode, TableRowNode } from '@lexical/table';\nimport { Class } from 'utility-types';\n\nimport { EmojiNode } from './EmojiNode';\nimport { EquationNode } from './EquationNode';\n// import { ExcalidrawNode } from './ExcalidrawNode';\nimport { ImageNode } from './ImageNode';\nimport { KeywordNode } from './KeywordNode';\nimport { MentionNode } from './MentionNode';\nimport { PollNode } from './PollNode';\nimport { StickyNode } from './StickyNode';\nimport { TweetNode } from './TweetNode';\nimport { TypeaheadNode } from './TypeaheadNode';\nimport { YouTubeNode } from './YouTubeNode';\n\nconst PlaygroundNodes: Array<Class<LexicalNode>> = [\n  HeadingNode,\n  ListNode,\n  ListItemNode,\n  QuoteNode,\n  CodeNode,\n  TableNode,\n  TableCellNode,\n  TableRowNode,\n  HashtagNode,\n  CodeHighlightNode,\n  AutoLinkNode,\n  LinkNode,\n  OverflowNode,\n  PollNode,\n  StickyNode,\n  ImageNode,\n  MentionNode,\n  EmojiNode,\n  // ExcalidrawNode,\n  EquationNode,\n  TypeaheadNode,\n  KeywordNode,\n  HorizontalRuleNode,\n  TweetNode,\n  YouTubeNode,\n  MarkNode,\n];\n\nexport default PlaygroundNodes;\n","/**\n * Copyright (c) Meta Platforms, Inc. and affiliates.\n *\n * This source code is licensed under the MIT license found in the\n * LICENSE file in the root directory of this source tree.\n *\n */\n\nimport './Modal.css';\n\nimport * as React from 'react';\nimport { useEffect, useRef } from 'react';\nimport { createPortal } from 'react-dom';\n\nfunction PortalImpl({\n  onClose,\n  children,\n  title,\n  closeOnClickOutside,\n}: {\n  children: JSX.Element | string | (JSX.Element | string)[];\n  closeOnClickOutside: boolean;\n  onClose: () => void;\n  title: string;\n}) {\n  const modalRef = useRef<HTMLDivElement>();\n\n  useEffect(() => {\n    if (modalRef.current !== null) {\n      modalRef.current.focus();\n    }\n  }, []);\n\n  useEffect(() => {\n    let modalOverlayElement = null;\n    const handler = (event) => {\n      if (event.keyCode === 27) {\n        onClose();\n      }\n    };\n    const clickOutsideHandler = (event: MouseEvent) => {\n      const target = event.target;\n      if (\n        modalRef.current !== null &&\n        !modalRef.current.contains(target as Node) &&\n        closeOnClickOutside\n      ) {\n        onClose();\n      }\n    };\n    if (modalRef.current !== null) {\n      modalOverlayElement = modalRef.current?.parentElement;\n      if (modalOverlayElement !== null) {\n        modalOverlayElement?.addEventListener('click', clickOutsideHandler);\n      }\n    }\n\n    window.addEventListener('keydown', handler);\n\n    return () => {\n      window.removeEventListener('keydown', handler);\n      if (modalOverlayElement !== null) {\n        modalOverlayElement?.removeEventListener('click', clickOutsideHandler);\n      }\n    };\n  }, [closeOnClickOutside, onClose]);\n\n  return (\n    <div className=\"Modal__overlay\" role=\"dialog\">\n      <div className=\"Modal__modal\" tabIndex={-1} ref={modalRef}>\n        <h2 className=\"Modal__title\">{title}</h2>\n        <button\n          className=\"Modal__closeButton\"\n          aria-label=\"Close modal\"\n          type=\"button\"\n          onClick={onClose}\n        >\n          X\n        </button>\n        <div className=\"Modal__content\">{children}</div>\n      </div>\n    </div>\n  );\n}\n\nexport default function Modal({\n  onClose,\n  children,\n  title,\n  closeOnClickOutside = false,\n}: {\n  children: JSX.Element | string | (JSX.Element | string)[];\n  closeOnClickOutside?: boolean;\n  onClose: () => void;\n  title: string;\n}): JSX.Element {\n  return createPortal(\n    <PortalImpl\n      onClose={onClose}\n      title={title}\n      closeOnClickOutside={closeOnClickOutside}\n    >\n      {children}\n    </PortalImpl>,\n    document.body\n  );\n}\n","/**\n * Copyright (c) Meta Platforms, Inc. and affiliates.\n *\n * This source code is licensed under the MIT license found in the\n * LICENSE file in the root directory of this source tree.\n *\n */\n\nimport { useCallback, useMemo, useState } from 'react';\nimport * as React from 'react';\n\nimport Modal from '../ui/Modal';\n\nexport default function useModal(): [\n  JSX.Element,\n  (title: string, showModal: (onClose: () => void) => JSX.Element) => void\n] {\n  const [modalContent, setModalContent] = useState<null | {\n    closeOnClickOutside: boolean;\n    content: JSX.Element;\n    title: string;\n  }>(null);\n\n  const onClose = useCallback(() => {\n    setModalContent(null);\n  }, []);\n\n  const modal = useMemo(() => {\n    if (modalContent === null) {\n      return null;\n    }\n    const { title, content, closeOnClickOutside } = modalContent;\n    return (\n      <Modal\n        onClose={onClose}\n        title={title}\n        closeOnClickOutside={closeOnClickOutside}\n      >\n        {content}\n      </Modal>\n    );\n  }, [modalContent, onClose]);\n\n  const showModal = useCallback(\n    (\n      title,\n      // eslint-disable-next-line no-shadow\n      getContent: (onClose: () => void) => JSX.Element,\n      closeOnClickOutside = false\n    ) => {\n      setModalContent({\n        closeOnClickOutside,\n        content: getContent(onClose),\n        title,\n      });\n    },\n    [onClose]\n  );\n\n  return [modal, showModal];\n}\n","/**\n * Copyright (c) Meta Platforms, Inc. and affiliates.\n *\n * This source code is licensed under the MIT license found in the\n * LICENSE file in the root directory of this source tree.\n *\n */\n\nimport type {\n  ElementTransformer,\n  TextMatchTransformer,\n  Transformer,\n} from '@lexical/markdown';\nimport type { ElementNode, LexicalNode } from 'lexical';\n\nimport {\n  CHECK_LIST,\n  ELEMENT_TRANSFORMERS,\n  TEXT_FORMAT_TRANSFORMERS,\n  TEXT_MATCH_TRANSFORMERS,\n} from '@lexical/markdown';\nimport {\n  $createHorizontalRuleNode,\n  $isHorizontalRuleNode,\n} from '@lexical/react/LexicalHorizontalRuleNode';\nimport {\n  $createTableCellNode,\n  $createTableNode,\n  $createTableRowNode,\n  $isTableNode,\n  $isTableRowNode,\n  TableCellHeaderStates,\n  TableCellNode,\n  TableNode,\n} from '@lexical/table';\nimport {\n  $createParagraphNode,\n  $createTextNode,\n  $isElementNode,\n  $isParagraphNode,\n  $isTextNode,\n} from 'lexical';\n\nimport { $createEquationNode, $isEquationNode } from '../nodes/EquationNode';\nimport { $createImageNode, $isImageNode } from '../nodes/ImageNode';\nimport { $createTweetNode, $isTweetNode } from '../nodes/TweetNode';\n\nexport const HR: ElementTransformer = {\n  export: (node: LexicalNode) => {\n    return $isHorizontalRuleNode(node) ? '***' : null;\n  },\n  regExp: /^(---|\\*\\*\\*|___)\\s?$/,\n  replace: (parentNode, _1, _2, isImport) => {\n    const line = $createHorizontalRuleNode();\n\n    // TODO: Get rid of isImport flag\n    if (isImport || parentNode.getNextSibling() != null) {\n      parentNode.replace(line);\n    } else {\n      parentNode.insertBefore(line);\n    }\n\n    line.selectNext();\n  },\n  type: 'element',\n};\n\nexport const IMAGE: TextMatchTransformer = {\n  export: (node, exportChildren, exportFormat) => {\n    if (!$isImageNode(node)) {\n      return null;\n    }\n\n    return `![${node.getAltText()}](${node.getSrc()})`;\n  },\n  importRegExp: /!(?:\\[([^[]*)\\])(?:\\(([^(]+)\\))/,\n  regExp: /!(?:\\[([^[]*)\\])(?:\\(([^(]+)\\))$/,\n  replace: (textNode, match) => {\n    const [, altText, src] = match;\n    const imageNode = $createImageNode({\n      altText,\n      maxWidth: 800,\n      src,\n    });\n    textNode.replace(imageNode);\n  },\n  trigger: ')',\n  type: 'text-match',\n};\n\nexport const EQUATION: TextMatchTransformer = {\n  export: (node, exportChildren, exportFormat) => {\n    if (!$isEquationNode(node)) {\n      return null;\n    }\n\n    return `$${node.getEquation()}$`;\n  },\n  importRegExp: /\\$([^$].+?)\\$/,\n  regExp: /\\$([^$].+?)\\$$/,\n  replace: (textNode, match) => {\n    const [, equation] = match;\n    const equationNode = $createEquationNode(equation, true);\n    textNode.replace(equationNode);\n  },\n  trigger: '$',\n  type: 'text-match',\n};\n\nexport const TWEET: ElementTransformer = {\n  export: (node) => {\n    if (!$isTweetNode(node)) {\n      return null;\n    }\n\n    return `<tweet id=\"${node.getId()}\" />`;\n  },\n  regExp: /<tweet id=\"([^\"]+?)\"\\s?\\/>\\s?$/,\n  replace: (textNode, _1, match) => {\n    const [, id] = match;\n    const tweetNode = $createTweetNode(id);\n    textNode.replace(tweetNode);\n  },\n  type: 'element',\n};\n\n// Very primitive table setup\nconst TABLE_ROW_REG_EXP = /^(?:\\|)(.+)(?:\\|)\\s?$/;\n\nexport const TABLE: ElementTransformer = {\n  export: (\n    node: LexicalNode,\n    exportChildren: (elementNode: ElementNode) => string\n  ) => {\n    if (!$isTableNode(node)) {\n      return null;\n    }\n\n    const output = [];\n\n    for (const row of node.getChildren()) {\n      const rowOutput = [];\n\n      if ($isTableRowNode(row)) {\n        for (const cell of row.getChildren()) {\n          // It's TableCellNode (hence ElementNode) so it's just to make flow happy\n          if ($isElementNode(cell)) {\n            rowOutput.push(exportChildren(cell));\n          }\n        }\n      }\n\n      output.push(`| ${rowOutput.join(' | ')} |`);\n    }\n\n    return output.join('\\n');\n  },\n  regExp: TABLE_ROW_REG_EXP,\n  replace: (parentNode, _1, match) => {\n    const matchCells = mapToTableCells(match[0]);\n\n    if (matchCells == null) {\n      return;\n    }\n\n    const rows = [matchCells];\n    let sibling = parentNode.getPreviousSibling();\n    let maxCells = matchCells.length;\n\n    while (sibling) {\n      if (!$isParagraphNode(sibling)) {\n        break;\n      }\n\n      if (sibling.getChildrenSize() !== 1) {\n        break;\n      }\n\n      const firstChild = sibling.getFirstChild();\n\n      if (!$isTextNode(firstChild)) {\n        break;\n      }\n\n      const cells = mapToTableCells(firstChild.getTextContent());\n\n      if (cells == null) {\n        break;\n      }\n\n      maxCells = Math.max(maxCells, cells.length);\n      rows.unshift(cells);\n      const previousSibling = sibling.getPreviousSibling();\n      sibling.remove();\n      sibling = previousSibling;\n    }\n\n    const table = $createTableNode();\n\n    for (const cells of rows) {\n      const tableRow = $createTableRowNode();\n      table.append(tableRow);\n\n      for (let i = 0; i < maxCells; i++) {\n        tableRow.append(i < cells.length ? cells[i] : createTableCell(null));\n      }\n    }\n\n    const previousSibling = parentNode.getPreviousSibling();\n    if (\n      $isTableNode(previousSibling) &&\n      getTableColumnsSize(previousSibling) === maxCells\n    ) {\n      previousSibling.append(...table.getChildren());\n      parentNode.remove();\n    } else {\n      parentNode.replace(table);\n    }\n\n    table.selectEnd();\n  },\n  type: 'element',\n};\n\nfunction getTableColumnsSize(table: TableNode) {\n  const row = table.getFirstChild();\n  return $isTableRowNode(row) ? row.getChildrenSize() : 0;\n}\n\nconst createTableCell = (\n  textContent: string | null | undefined\n): TableCellNode => {\n  const cell = $createTableCellNode(TableCellHeaderStates.NO_STATUS);\n  const paragraph = $createParagraphNode();\n\n  if (textContent != null) {\n    paragraph.append($createTextNode(textContent.trim()));\n  }\n\n  cell.append(paragraph);\n  return cell;\n};\n\nconst mapToTableCells = (textContent: string): Array<TableCellNode> | null => {\n  // TODO:\n  // For now plain text, single node. Can be expanded to more complex content\n  // including formatted text\n  const match = textContent.match(TABLE_ROW_REG_EXP);\n\n  if (!match || !match[1]) {\n    return null;\n  }\n\n  return match[1].split('|').map((text) => createTableCell(text));\n};\n\nexport const PLAYGROUND_TRANSFORMERS: Array<Transformer> = [\n  TABLE,\n  HR,\n  IMAGE,\n  EQUATION,\n  TWEET,\n  CHECK_LIST,\n  ...ELEMENT_TRANSFORMERS,\n  ...TEXT_FORMAT_TRANSFORMERS,\n  ...TEXT_MATCH_TRANSFORMERS,\n];\n","/**\n * Copyright (c) Meta Platforms, Inc. and affiliates.\n *\n * This source code is licensed under the MIT license found in the\n * LICENSE file in the root directory of this source tree.\n *\n */\n\nimport { useCallback, useEffect, useRef } from 'react';\n\nconst getElement = (): HTMLElement => {\n  let element = document.getElementById('report-container');\n\n  if (element === null) {\n    element = document.createElement('div');\n    element.id = 'report-container';\n    element.style.position = 'fixed';\n    element.style.top = '50%';\n    element.style.left = '50%';\n    element.style.fontSize = '32px';\n    element.style.transform = 'translate(-50%, -50px)';\n    element.style.padding = '20px';\n    element.style.background = 'rgba(240, 240, 240, 0.4)';\n    element.style.borderRadius = '20px';\n\n    if (document.body) {\n      document.body.appendChild(element);\n    }\n  }\n\n  return element;\n};\n\nexport default function useReport(): (arg0: string) => NodeJS.Timeout {\n  const timer = useRef<NodeJS.Timeout | null>(null);\n  const cleanup = useCallback(() => {\n    clearTimeout(timer.current);\n\n    if (document.body) {\n      document.body.removeChild(getElement());\n    }\n  }, []);\n\n  useEffect(() => {\n    return cleanup;\n  }, [cleanup]);\n\n  return useCallback(\n    (content) => {\n      // eslint-disable-next-line no-console\n      console.log(content);\n      const element = getElement();\n      clearTimeout(timer.current);\n      element.innerHTML = content;\n      timer.current = setTimeout(cleanup, 1000);\n      return timer.current;\n    },\n    [cleanup]\n  );\n}\n","/**\n * Copyright (c) Meta Platforms, Inc. and affiliates.\n *\n * This source code is licensed under the MIT license found in the\n * LICENSE file in the root directory of this source tree.\n *\n */\n\nimport type { LexicalCommand, LexicalEditor, RangeSelection } from 'lexical';\n\nimport { useLexicalComposerContext } from '@lexical/react/LexicalComposerContext';\nimport {\n  $getSelection,\n  $isRangeSelection,\n  COMMAND_PRIORITY_EDITOR,\n  createCommand,\n  REDO_COMMAND,\n  UNDO_COMMAND,\n} from 'lexical';\nimport { useEffect, useRef, useState } from 'react';\n\nimport useReport from '../hooks/useReport';\n\nexport const SPEECH_TO_TEXT_COMMAND: LexicalCommand<boolean> = createCommand();\n\nconst VOICE_COMMANDS: Readonly<\n  Record<\n    string,\n    (arg0: { editor: LexicalEditor; selection: RangeSelection }) => void\n  >\n> = {\n  '\\n': ({ selection }) => {\n    selection.insertParagraph();\n  },\n  redo: ({ editor }) => {\n    editor.dispatchCommand(REDO_COMMAND, undefined);\n  },\n  undo: ({ editor }) => {\n    editor.dispatchCommand(UNDO_COMMAND, undefined);\n  },\n};\n\nexport const SUPPORT_SPEECH_RECOGNITION: boolean =\n  'SpeechRecognition' in window || 'webkitSpeechRecognition' in window;\n\nfunction SpeechToTextPlugin(): null {\n  const [editor] = useLexicalComposerContext();\n  const [isEnabled, setIsEnabled] = useState<boolean>(false);\n  const SpeechRecognition =\n    // @ts-ignore\n    window.SpeechRecognition || window.webkitSpeechRecognition;\n  const recognition = useRef<typeof SpeechRecognition | null>(null);\n  const report = useReport();\n\n  useEffect(() => {\n    if (isEnabled && recognition.current === null) {\n      recognition.current = new SpeechRecognition();\n      recognition.current.continuous = true;\n      recognition.current.interimResults = true;\n      recognition.current.addEventListener(\n        'result',\n        (event: typeof SpeechRecognition) => {\n          const resultItem = event.results.item(event.resultIndex);\n          const { transcript } = resultItem.item(0);\n          report(transcript);\n\n          if (!resultItem.isFinal) {\n            return;\n          }\n\n          editor.update(() => {\n            const selection = $getSelection();\n\n            if ($isRangeSelection(selection)) {\n              const command = VOICE_COMMANDS[transcript.toLowerCase().trim()];\n\n              if (command) {\n                command({\n                  editor,\n                  selection,\n                });\n              } else if (transcript.match(/\\s*\\n\\s*/)) {\n                selection.insertParagraph();\n              } else {\n                selection.insertText(transcript);\n              }\n            }\n          });\n        }\n      );\n    }\n\n    if (recognition.current) {\n      if (isEnabled) {\n        recognition.current.start();\n      } else {\n        recognition.current.stop();\n      }\n    }\n\n    return () => {\n      if (recognition.current !== null) {\n        recognition.current.stop();\n      }\n    };\n  }, [SpeechRecognition, editor, isEnabled, report]);\n  useEffect(() => {\n    return editor.registerCommand(\n      SPEECH_TO_TEXT_COMMAND,\n      (_isEnabled: boolean) => {\n        setIsEnabled(_isEnabled);\n        return true;\n      },\n      COMMAND_PRIORITY_EDITOR\n    );\n  }, [editor]);\n\n  return null;\n}\n\nexport default (SUPPORT_SPEECH_RECOGNITION\n  ? SpeechToTextPlugin\n  : () => null) as () => null;\n","/**\n * Copyright (c) Meta Platforms, Inc. and affiliates.\n *\n * This source code is licensed under the MIT license found in the\n * LICENSE file in the root directory of this source tree.\n *\n */\n\nimport type { LexicalEditor } from 'lexical';\n\nimport { $createCodeNode, $isCodeNode } from '@lexical/code';\nimport { exportFile, importFile } from '@lexical/file';\nimport {\n  $convertFromMarkdownString,\n  $convertToMarkdownString,\n} from '@lexical/markdown';\nimport { useCollaborationContext } from '@lexical/react/LexicalCollaborationPlugin';\nimport { useLexicalComposerContext } from '@lexical/react/LexicalComposerContext';\nimport { mergeRegister } from '@lexical/utils';\nimport { CONNECTED_COMMAND, TOGGLE_CONNECT_COMMAND } from '@lexical/yjs';\nimport {\n  $createTextNode,\n  $getRoot,\n  $isParagraphNode,\n  CLEAR_EDITOR_COMMAND,\n  COMMAND_PRIORITY_EDITOR,\n} from 'lexical';\nimport * as React from 'react';\nimport { useCallback, useEffect, useState } from 'react';\n\nimport useModal from '../hooks/useModal';\nimport Button from '../ui/Button';\nimport { PLAYGROUND_TRANSFORMERS } from './MarkdownTransformers';\nimport {\n  SPEECH_TO_TEXT_COMMAND,\n  SUPPORT_SPEECH_RECOGNITION,\n} from './SpeechToTextPlugin';\n\nexport default function ActionsPlugin({\n  isRichText,\n}: {\n  isRichText: boolean;\n}): JSX.Element {\n  const [editor] = useLexicalComposerContext();\n  const [isReadOnly, setIsReadyOnly] = useState(() => editor.isReadOnly());\n  const [isSpeechToText, setIsSpeechToText] = useState(false);\n  const [connected, setConnected] = useState(false);\n  const [isEditorEmpty, setIsEditorEmpty] = useState(true);\n  const [modal, showModal] = useModal();\n  const { yjsDocMap } = useCollaborationContext();\n  const isCollab = yjsDocMap.get('main') !== undefined;\n\n  useEffect(() => {\n    return mergeRegister(\n      editor.registerReadOnlyListener((readOnly) => {\n        setIsReadyOnly(readOnly);\n      }),\n      editor.registerCommand<boolean>(\n        CONNECTED_COMMAND,\n        (payload) => {\n          const isConnected = payload;\n          setConnected(isConnected);\n          return false;\n        },\n        COMMAND_PRIORITY_EDITOR\n      )\n    );\n  }, [editor]);\n\n  useEffect(() => {\n    return editor.registerUpdateListener(() => {\n      editor.getEditorState().read(() => {\n        const root = $getRoot();\n        const children = root.getChildren();\n\n        if (children.length > 1) {\n          setIsEditorEmpty(false);\n        } else {\n          if ($isParagraphNode(children[0])) {\n            const paragraphChildren = children[0].getChildren();\n            setIsEditorEmpty(paragraphChildren.length === 0);\n          } else {\n            setIsEditorEmpty(false);\n          }\n        }\n      });\n    });\n  }, [editor]);\n\n  const handleMarkdownToggle = useCallback(() => {\n    editor.update(() => {\n      const root = $getRoot();\n      const firstChild = root.getFirstChild();\n      if ($isCodeNode(firstChild) && firstChild.getLanguage() === 'markdown') {\n        $convertFromMarkdownString(\n          firstChild.getTextContent(),\n          PLAYGROUND_TRANSFORMERS\n        );\n      } else {\n        const markdown = $convertToMarkdownString(PLAYGROUND_TRANSFORMERS);\n        root\n          .clear()\n          .append(\n            $createCodeNode('markdown').append($createTextNode(markdown))\n          );\n      }\n      root.selectEnd();\n    });\n  }, [editor]);\n\n  return (\n    <div className=\"actions\">\n      {SUPPORT_SPEECH_RECOGNITION && (\n        <button\n          onClick={() => {\n            editor.dispatchCommand(SPEECH_TO_TEXT_COMMAND, !isSpeechToText);\n            setIsSpeechToText(!isSpeechToText);\n          }}\n          className={\n            'action-button action-button-mic ' +\n            (isSpeechToText ? 'active' : '')\n          }\n          title=\"Speech To Text\"\n          aria-label={`${isSpeechToText ? 'Enable' : 'Disable'} speech to text`}\n          type=\"button\"\n        >\n          <i className=\"mic\" />\n        </button>\n      )}\n      <button\n        className=\"action-button import\"\n        onClick={() => importFile(editor)}\n        title=\"Import\"\n        aria-label=\"Import editor state from JSON\"\n        type=\"button\"\n      >\n        <i className=\"import\" />\n      </button>\n      <button\n        className=\"action-button export\"\n        onClick={() =>\n          exportFile(editor, {\n            fileName: `Playground ${new Date().toISOString()}`,\n            source: 'Playground',\n          })\n        }\n        title=\"Export\"\n        aria-label=\"Export editor state to JSON\"\n        type=\"button\"\n      >\n        <i className=\"export\" />\n      </button>\n      <button\n        className=\"action-button clear\"\n        disabled={isEditorEmpty}\n        onClick={() => {\n          showModal('Clear editor', (onClose) => (\n            <ShowClearDialog editor={editor} onClose={onClose} />\n          ));\n        }}\n        title=\"Clear\"\n        aria-label=\"Clear editor contents\"\n        type=\"button\"\n      >\n        <i className=\"clear\" />\n      </button>\n      <button\n        className={`action-button ${isReadOnly ? 'unlock' : 'lock'}`}\n        onClick={() => {\n          editor.setReadOnly(!editor.isReadOnly());\n        }}\n        title=\"Read-Only Mode\"\n        aria-label={`${isReadOnly ? 'Unlock' : 'Lock'} read-only mode`}\n        type=\"button\"\n      >\n        <i className={isReadOnly ? 'unlock' : 'lock'} />\n      </button>\n      <button\n        className=\"action-button\"\n        onClick={handleMarkdownToggle}\n        title=\"Convert From Markdown\"\n        aria-label=\"Convert from markdown\"\n        type=\"button\"\n      >\n        <i className=\"markdown\" />\n      </button>\n      {isCollab && (\n        <button\n          className=\"action-button connect\"\n          onClick={() => {\n            editor.dispatchCommand(TOGGLE_CONNECT_COMMAND, !connected);\n          }}\n          title={`${\n            connected ? 'Disconnect' : 'Connect'\n          } Collaborative Editing`}\n          aria-label={`${\n            connected ? 'Disconnect from' : 'Connect to'\n          } a collaborative editing server`}\n          type=\"button\"\n        >\n          <i className={connected ? 'disconnect' : 'connect'} />\n        </button>\n      )}\n      {modal}\n    </div>\n  );\n}\n\nfunction ShowClearDialog({\n  editor,\n  onClose,\n}: {\n  editor: LexicalEditor;\n  onClose: () => void;\n}): JSX.Element {\n  return (\n    <>\n      Are you sure you want to clear the editor?\n      <div className=\"Modal__content\">\n        <Button\n          onClick={() => {\n            editor.dispatchCommand(CLEAR_EDITOR_COMMAND, undefined);\n            editor.focus();\n            onClose();\n          }}\n        >\n          Clear\n        </Button>{' '}\n        <Button\n          onClick={() => {\n            editor.focus();\n            onClose();\n          }}\n        >\n          Cancel\n        </Button>\n      </div>\n    </>\n  );\n}\n","/**\n * Copyright (c) Meta Platforms, Inc. and affiliates.\n *\n * This source code is licensed under the MIT license found in the\n * LICENSE file in the root directory of this source tree.\n *\n */\n\nimport { AutoLinkPlugin } from '@lexical/react/LexicalAutoLinkPlugin';\nimport * as React from 'react';\n\nconst URL_MATCHER =\n  /((https?:\\/\\/(www\\.)?)|(www\\.))[-a-zA-Z0-9@:%._+~#=]{1,256}\\.[a-zA-Z0-9()]{1,6}\\b([-a-zA-Z0-9()@:%_+.~#?&//=]*)/;\n\nconst EMAIL_MATCHER =\n  /(([^<>()[\\]\\\\.,;:\\s@\"]+(\\.[^<>()[\\]\\\\.,;:\\s@\"]+)*)|(\".+\"))@((\\[[0-9]{1,3}\\.[0-9]{1,3}\\.[0-9]{1,3}\\.[0-9]{1,3}\\])|(([a-zA-Z\\-0-9]+\\.)+[a-zA-Z]{2,}))/;\n\nconst MATCHERS = [\n  (text) => {\n    const match = URL_MATCHER.exec(text);\n    return (\n      match && {\n        index: match.index,\n        length: match[0].length,\n        text: match[0],\n        url: match[0],\n      }\n    );\n  },\n  (text) => {\n    const match = EMAIL_MATCHER.exec(text);\n    return (\n      match && {\n        index: match.index,\n        length: match[0].length,\n        text: match[0],\n        url: `mailto:${match[0]}`,\n      }\n    );\n  },\n];\n\nexport default function LexicalAutoLinkPlugin(): JSX.Element {\n  return <AutoLinkPlugin matchers={MATCHERS} />;\n}\n","/**\n * Copyright (c) Meta Platforms, Inc. and affiliates.\n *\n * This source code is licensed under the MIT license found in the\n * LICENSE file in the root directory of this source tree.\n *\n */\n\nimport {\n  Comment,\n  Comments,\n  CommentStore,\n  createComment,\n  createThread,\n  Thread,\n  useCommentStore,\n} from '../commenting';\nimport type {\n  EditorState,\n  LexicalCommand,\n  LexicalEditor,\n  NodeKey,\n} from 'lexical';\n\nimport './CommentPlugin.css';\n\nimport {\n  $createMarkNode,\n  $getMarkIDs,\n  $isMarkNode,\n  $unwrapMarkNode,\n  $wrapSelectionInMarkNode,\n  MarkNode,\n} from '@lexical/mark';\nimport { AutoFocusPlugin } from '@lexical/react/LexicalAutoFocusPlugin';\nimport { ClearEditorPlugin } from '@lexical/react/LexicalClearEditorPlugin';\nimport { LexicalComposer } from '@lexical/react/LexicalComposer';\nimport { useLexicalComposerContext } from '@lexical/react/LexicalComposerContext';\nimport { HistoryPlugin } from '@lexical/react/LexicalHistoryPlugin';\nimport { OnChangePlugin } from '@lexical/react/LexicalOnChangePlugin';\nimport { PlainTextPlugin } from '@lexical/react/LexicalPlainTextPlugin';\nimport { createDOMRange, createRectsFromDOMRange } from '@lexical/selection';\nimport { $isRootTextContentEmpty, $rootTextContent } from '@lexical/text';\nimport { mergeRegister, registerNestedElementResolver } from '@lexical/utils';\nimport {\n  $getNodeByKey,\n  $getSelection,\n  $isRangeSelection,\n  $isTextNode,\n  CLEAR_EDITOR_COMMAND,\n  COMMAND_PRIORITY_EDITOR,\n  createCommand,\n  KEY_ESCAPE_COMMAND,\n} from 'lexical';\nimport { useCallback, useEffect, useMemo, useRef, useState } from 'react';\nimport * as React from 'react';\nimport { createPortal } from 'react-dom';\nimport useLayoutEffect from '../shared/src/useLayoutEffect';\n\nimport useModal from '../hooks/useModal';\nimport CommentEditorTheme from '../themes/CommentEditorTheme';\nimport Button from '../ui/Button';\nimport ContentEditable from '../ui/ContentEditable';\nimport Placeholder from '../ui/Placeholder';\nimport type { Doc } from 'yjs';\nimport { useCollaborationContext } from '@lexical/react/LexicalCollaborationPlugin';\nimport { WebsocketProvider } from 'y-websocket';\n\nexport const INSERT_INLINE_COMMAND: LexicalCommand<void> = createCommand();\n\nfunction AddCommentBox({\n  anchorKey,\n  editor,\n  onAddComment,\n}: {\n  anchorKey: NodeKey;\n  editor: LexicalEditor;\n  onAddComment: () => void;\n}): JSX.Element {\n  const boxRef = useRef<HTMLDivElement>(null);\n\n  const updatePosition = useCallback(() => {\n    const boxElem = boxRef.current;\n    const rootElement = editor.getRootElement();\n    const anchorElement = editor.getElementByKey(anchorKey);\n\n    if (boxElem !== null && rootElement !== null && anchorElement !== null) {\n      const { right } = rootElement.getBoundingClientRect();\n      const { top } = anchorElement.getBoundingClientRect();\n      boxElem.style.left = `${right - 20}px`;\n      boxElem.style.top = `${top - 30}px`;\n    }\n  }, [anchorKey, editor]);\n\n  useEffect(() => {\n    window.addEventListener('resize', updatePosition);\n\n    return () => {\n      window.removeEventListener('resize', updatePosition);\n    };\n  }, [editor, updatePosition]);\n\n  useLayoutEffect(() => {\n    updatePosition();\n  }, [anchorKey, editor, updatePosition]);\n\n  return (\n    <div className=\"CommentPlugin_AddCommentBox\" ref={boxRef}>\n      <button\n        className=\"CommentPlugin_AddCommentBox_button\"\n        onClick={onAddComment}\n        type=\"button\"\n      >\n        <i className=\"icon add-comment\" />\n      </button>\n    </div>\n  );\n}\n\nfunction EditorRefPlugin({\n  editorRef,\n}: {\n  editorRef: { current: null | LexicalEditor };\n}): null {\n  const [editor] = useLexicalComposerContext();\n\n  useLayoutEffect(() => {\n    editorRef.current = editor;\n    return () => {\n      editorRef.current = null;\n    };\n  }, [editor, editorRef]);\n\n  return null;\n}\n\nfunction EscapeHandlerPlugin({\n  onEscape,\n}: {\n  onEscape: (e: KeyboardEvent) => boolean;\n}): null {\n  const [editor] = useLexicalComposerContext();\n\n  useEffect(() => {\n    return editor.registerCommand(\n      KEY_ESCAPE_COMMAND,\n      (event: KeyboardEvent) => {\n        return onEscape(event);\n      },\n      2\n    );\n  }, [editor, onEscape]);\n\n  return null;\n}\n\nfunction PlainTextEditor({\n  className,\n  autoFocus,\n  onEscape,\n  onChange,\n  editorRef,\n  placeholder = 'Type a comment...',\n}: {\n  autoFocus?: boolean;\n  className?: string;\n  editorRef?: { current: null | LexicalEditor };\n  onChange: (editorState: EditorState, editor: LexicalEditor) => void;\n  onEscape: (e: KeyboardEvent) => boolean;\n  placeholder?: string;\n}) {\n  const initialConfig = {\n    namespace: 'Commenting',\n    nodes: [],\n    onError: (error: Error) => {\n      throw error;\n    },\n    theme: CommentEditorTheme,\n  };\n\n  return (\n    <LexicalComposer initialConfig={initialConfig}>\n      <div className=\"CommentPlugin_CommentInputBox_EditorContainer\">\n        <PlainTextPlugin\n          contentEditable={<ContentEditable className={className} />}\n          placeholder={<Placeholder>{placeholder}</Placeholder>}\n        />\n        <OnChangePlugin onChange={onChange} />\n        <HistoryPlugin />\n        {autoFocus !== false && <AutoFocusPlugin />}\n        <EscapeHandlerPlugin onEscape={onEscape} />\n        <ClearEditorPlugin />\n        {editorRef !== undefined && <EditorRefPlugin editorRef={editorRef} />}\n      </div>\n    </LexicalComposer>\n  );\n}\n\nfunction useOnChange(\n  setContent: (text: string) => void,\n  setCanSubmit: (canSubmit: boolean) => void\n) {\n  return useCallback(\n    (editorState: EditorState, _editor: LexicalEditor) => {\n      editorState.read(() => {\n        setContent($rootTextContent());\n        setCanSubmit(!$isRootTextContentEmpty(_editor.isComposing(), true));\n      });\n    },\n    [setCanSubmit, setContent]\n  );\n}\n\nfunction CommentInputBox({\n  editor,\n  cancelAddComment,\n  submitAddComment,\n}: {\n  cancelAddComment: () => void;\n  editor: LexicalEditor;\n  submitAddComment: (\n    commentOrThread: Comment | Thread,\n    isInlineComment: boolean\n  ) => void;\n}) {\n  const [content, setContent] = useState('');\n  const [canSubmit, setCanSubmit] = useState(false);\n  const boxRef = useRef<HTMLDivElement>(null);\n  const selectionState = useMemo(\n    () => ({\n      container: document.createElement('div'),\n      elements: [],\n    }),\n    []\n  );\n  const author = useCollabAuthorName();\n\n  const updateLocation = useCallback(() => {\n    editor.getEditorState().read(() => {\n      const selection = $getSelection();\n\n      if ($isRangeSelection(selection)) {\n        const anchor = selection.anchor;\n        const focus = selection.focus;\n        const range = createDOMRange(\n          editor,\n          anchor.getNode(),\n          anchor.offset,\n          focus.getNode(),\n          focus.offset\n        );\n        const boxElem = boxRef.current;\n        if (range !== null && boxElem !== null) {\n          const { left, bottom, width } = range.getBoundingClientRect();\n          const selectionRects = createRectsFromDOMRange(editor, range);\n          let correctedLeft =\n            selectionRects.length === 1 ? left + width / 2 - 125 : left - 125;\n          if (correctedLeft < 10) {\n            correctedLeft = 10;\n          }\n          boxElem.style.left = `${correctedLeft}px`;\n          boxElem.style.top = `${bottom + 20}px`;\n          const selectionRectsLength = selectionRects.length;\n          const { container } = selectionState;\n          const elements: Array<HTMLSpanElement> = selectionState.elements;\n          const elementsLength = elements.length;\n\n          for (let i = 0; i < selectionRectsLength; i++) {\n            const selectionRect = selectionRects[i];\n            let elem: HTMLSpanElement = elements[i];\n            if (elem === undefined) {\n              elem = document.createElement('span');\n              elements[i] = elem;\n              container.appendChild(elem);\n            }\n            const color = '255, 212, 0';\n            const style = `position:absolute;top:${selectionRect.top}px;left:${selectionRect.left}px;height:${selectionRect.height}px;width:${selectionRect.width}px;background-color:rgba(${color}, 0.3);pointer-events:none;z-index:5;`;\n            elem.style.cssText = style;\n          }\n          for (let i = elementsLength - 1; i >= selectionRectsLength; i--) {\n            const elem = elements[i];\n            container.removeChild(elem);\n            elements.pop();\n          }\n        }\n      }\n    });\n  }, [editor, selectionState]);\n\n  useLayoutEffect(() => {\n    updateLocation();\n    const container = selectionState.container;\n    const body = document.body;\n    if (body !== null) {\n      body.appendChild(container);\n      return () => {\n        body.removeChild(container);\n      };\n    }\n  }, [selectionState.container, updateLocation]);\n\n  useEffect(() => {\n    window.addEventListener('resize', updateLocation);\n\n    return () => {\n      window.removeEventListener('resize', updateLocation);\n    };\n  }, [updateLocation]);\n\n  const onEscape = (event: KeyboardEvent): boolean => {\n    event.preventDefault();\n    cancelAddComment();\n    return true;\n  };\n\n  const submitComment = () => {\n    if (canSubmit) {\n      let quote = editor.getEditorState().read(() => {\n        const selection = $getSelection();\n        return selection !== null ? selection.getTextContent() : '';\n      });\n      if (quote.length > 100) {\n        quote = quote.slice(0, 99) + '…';\n      }\n      submitAddComment(\n        createThread(quote, [createComment(content, author)]),\n        true\n      );\n    }\n  };\n\n  const onChange = useOnChange(setContent, setCanSubmit);\n\n  return (\n    <div className=\"CommentPlugin_CommentInputBox\" ref={boxRef}>\n      <PlainTextEditor\n        className=\"CommentPlugin_CommentInputBox_Editor\"\n        onEscape={onEscape}\n        onChange={onChange}\n      />\n      <div className=\"CommentPlugin_CommentInputBox_Buttons\">\n        <Button\n          onClick={cancelAddComment}\n          className=\"CommentPlugin_CommentInputBox_Button\"\n        >\n          Cancel\n        </Button>\n        <Button\n          onClick={submitComment}\n          disabled={!canSubmit}\n          className=\"CommentPlugin_CommentInputBox_Button primary\"\n        >\n          Comment\n        </Button>\n      </div>\n    </div>\n  );\n}\n\nfunction CommentsComposer({\n  submitAddComment,\n  thread,\n  placeholder,\n}: {\n  placeholder?: string;\n  submitAddComment: (\n    commentOrThread: Comment,\n    isInlineComment: boolean,\n    // eslint-disable-next-line no-shadow\n    thread?: Thread\n  ) => void;\n  thread?: Thread;\n}) {\n  const [content, setContent] = useState('');\n  const [canSubmit, setCanSubmit] = useState(false);\n  const editorRef = useRef<LexicalEditor>(null);\n  const author = useCollabAuthorName();\n\n  const onChange = useOnChange(setContent, setCanSubmit);\n\n  const submitComment = () => {\n    if (canSubmit) {\n      submitAddComment(createComment(content, author), false, thread);\n      const editor = editorRef.current;\n      if (editor !== null) {\n        editor.dispatchCommand(CLEAR_EDITOR_COMMAND, undefined);\n      }\n    }\n  };\n\n  return (\n    <>\n      <PlainTextEditor\n        className=\"CommentPlugin_CommentsPanel_Editor\"\n        autoFocus={false}\n        onEscape={() => {\n          return true;\n        }}\n        onChange={onChange}\n        editorRef={editorRef}\n        placeholder={placeholder}\n      />\n      <Button\n        className=\"CommentPlugin_CommentsPanel_SendButton\"\n        onClick={submitComment}\n        disabled={!canSubmit}\n      >\n        <i className=\"send\" />\n      </Button>\n    </>\n  );\n}\n\nfunction ShowDeleteCommentOrThreadDialog({\n  commentOrThread,\n  deleteCommentOrThread,\n  onClose,\n  thread = undefined,\n}: {\n  commentOrThread: Comment | Thread;\n\n  deleteCommentOrThread: (\n    comment: Comment | Thread,\n    // eslint-disable-next-line no-shadow\n    thread?: Thread\n  ) => void;\n  onClose: () => void;\n  thread?: Thread;\n}): JSX.Element {\n  return (\n    <>\n      Are you sure you want to delete this {commentOrThread.type}?\n      <div className=\"Modal__content\">\n        <Button\n          onClick={() => {\n            deleteCommentOrThread(commentOrThread, thread);\n            onClose();\n          }}\n        >\n          Delete\n        </Button>{' '}\n        <Button\n          onClick={() => {\n            onClose();\n          }}\n        >\n          Cancel\n        </Button>\n      </div>\n    </>\n  );\n}\n\nfunction CommentsPanelListComment({\n  comment,\n  deleteComment,\n  thread,\n  rtf,\n}: {\n  comment: Comment;\n  deleteComment: (\n    commentOrThread: Comment | Thread,\n    // eslint-disable-next-line no-shadow\n    thread?: Thread\n  ) => void;\n  rtf: null; //FIXME: Intl.RelativeTimeFormat gives build error;\n  thread?: Thread;\n}): JSX.Element {\n  const seconds = Math.round((comment.timeStamp - performance.now()) / 1000);\n  const minutes = Math.round(seconds / 60);\n  const [modal, showModal] = useModal();\n\n  return (\n    <li className=\"CommentPlugin_CommentsPanel_List_Comment\">\n      <div className=\"CommentPlugin_CommentsPanel_List_Details\">\n        <span className=\"CommentPlugin_CommentsPanel_List_Comment_Author\">\n          {comment.author}\n        </span>\n        <span className=\"CommentPlugin_CommentsPanel_List_Comment_Time\">\n          {/* · {seconds > -10 ? 'Just now' : rtf.format(minutes, 'minute')} */}\n        </span>\n      </div>\n      <p\n        className={\n          comment.deleted ? 'CommentPlugin_CommentsPanel_DeletedComment' : ''\n        }\n      >\n        {comment.content}\n      </p>\n      {!comment.deleted && (\n        <>\n          <Button\n            onClick={() => {\n              showModal('Delete Comment', (onClose) => (\n                <ShowDeleteCommentOrThreadDialog\n                  commentOrThread={comment}\n                  deleteCommentOrThread={deleteComment}\n                  thread={thread}\n                  onClose={onClose}\n                />\n              ));\n            }}\n            className=\"CommentPlugin_CommentsPanel_List_DeleteButton\"\n          >\n            <i className=\"delete\" />\n          </Button>\n          {modal}\n        </>\n      )}\n    </li>\n  );\n}\n\nfunction CommentsPanelList({\n  activeIDs,\n  comments,\n  deleteCommentOrThread,\n  listRef,\n  submitAddComment,\n  markNodeMap,\n}: {\n  activeIDs: Array<string>;\n  comments: Comments;\n  deleteCommentOrThread: (\n    commentOrThread: Comment | Thread,\n    thread?: Thread\n  ) => void;\n  listRef: { current: null | HTMLUListElement };\n  markNodeMap: Map<string, Set<NodeKey>>;\n  submitAddComment: (\n    commentOrThread: Comment | Thread,\n    isInlineComment: boolean,\n    thread?: Thread\n  ) => void;\n}): JSX.Element {\n  const [editor] = useLexicalComposerContext();\n  const [counter, setCounter] = useState(0);\n  const [modal, showModal] = useModal();\n  // const rtf = useMemo(\n  //   () =>\n  //     new Intl.RelativeTimeFormat('en', {\n  //       localeMatcher: 'best fit',\n  //       numeric: 'auto',\n  //       style: 'short',\n  //     }),\n  //   []\n  // ); //FIXME: it is closed to fix a build error\n  const rtf = null;\n\n  useEffect(() => {\n    // Used to keep the time stamp up to date\n    const id = setTimeout(() => {\n      setCounter(counter + 1);\n    }, 10000);\n\n    return () => {\n      clearTimeout(id);\n    };\n  }, [counter]);\n\n  return (\n    <ul className=\"CommentPlugin_CommentsPanel_List\" ref={listRef}>\n      {comments.map((commentOrThread) => {\n        const id = commentOrThread.id;\n        if (commentOrThread.type === 'thread') {\n          const handleClickThread = () => {\n            const markNodeKeys = markNodeMap.get(id);\n            if (\n              markNodeKeys !== undefined &&\n              (activeIDs === null || activeIDs.indexOf(id) === -1)\n            ) {\n              const activeElement = document.activeElement;\n              // Move selection to the start of the mark, so that we\n              // update the UI with the selected thread.\n              editor.update(\n                () => {\n                  const markNodeKey = Array.from(markNodeKeys)[0];\n                  const markNode = $getNodeByKey<MarkNode>(markNodeKey);\n                  if ($isMarkNode(markNode)) {\n                    markNode.selectStart();\n                  }\n                },\n                {\n                  onUpdate() {\n                    // Restore selection to the previous element\n                    if (activeElement !== null) {\n                      (activeElement as HTMLElement).focus();\n                    }\n                  },\n                }\n              );\n            }\n          };\n\n          return (\n            // eslint-disable-next-line jsx-a11y/no-noninteractive-element-interactions\n            <li\n              key={id}\n              onClick={handleClickThread}\n              className={`CommentPlugin_CommentsPanel_List_Thread ${\n                markNodeMap.has(id) ? 'interactive' : ''\n              } ${activeIDs.indexOf(id) === -1 ? '' : 'active'}`}\n            >\n              <div className=\"CommentPlugin_CommentsPanel_List_Thread_QuoteBox\">\n                <blockquote className=\"CommentPlugin_CommentsPanel_List_Thread_Quote\">\n                  {'> '}\n                  <span>{commentOrThread.quote}</span>\n                </blockquote>\n                {/* INTRODUCE DELETE THREAD HERE*/}\n                <Button\n                  onClick={() => {\n                    showModal('Delete Thread', (onClose) => (\n                      <ShowDeleteCommentOrThreadDialog\n                        commentOrThread={commentOrThread}\n                        deleteCommentOrThread={deleteCommentOrThread}\n                        onClose={onClose}\n                      />\n                    ));\n                  }}\n                  className=\"CommentPlugin_CommentsPanel_List_DeleteButton\"\n                >\n                  <i className=\"delete\" />\n                </Button>\n                {modal}\n              </div>\n              <ul className=\"CommentPlugin_CommentsPanel_List_Thread_Comments\">\n                {commentOrThread.comments.map((comment) => (\n                  <CommentsPanelListComment\n                    key={comment.id}\n                    comment={comment}\n                    deleteComment={deleteCommentOrThread}\n                    thread={commentOrThread}\n                    rtf={rtf}\n                  />\n                ))}\n              </ul>\n              <div className=\"CommentPlugin_CommentsPanel_List_Thread_Editor\">\n                <CommentsComposer\n                  submitAddComment={submitAddComment}\n                  thread={commentOrThread}\n                  placeholder=\"Reply to comment...\"\n                />\n              </div>\n            </li>\n          );\n        }\n        return (\n          <CommentsPanelListComment\n            key={id}\n            comment={commentOrThread}\n            deleteComment={deleteCommentOrThread}\n            rtf={rtf}\n          />\n        );\n      })}\n    </ul>\n  );\n}\n\nfunction CommentsPanel({\n  activeIDs,\n  deleteCommentOrThread,\n  comments,\n  submitAddComment,\n  markNodeMap,\n}: {\n  activeIDs: Array<string>;\n  comments: Comments;\n  deleteCommentOrThread: (\n    commentOrThread: Comment | Thread,\n    thread?: Thread\n  ) => void;\n  markNodeMap: Map<string, Set<NodeKey>>;\n  submitAddComment: (\n    commentOrThread: Comment | Thread,\n    isInlineComment: boolean,\n    thread?: Thread\n  ) => void;\n}): JSX.Element {\n  const listRef = useRef<HTMLUListElement>(null);\n  const isEmpty = comments.length === 0;\n\n  return (\n    <div className=\"CommentPlugin_CommentsPanel\">\n      <h2 className=\"CommentPlugin_CommentsPanel_Heading\">Comments</h2>\n      {isEmpty ? (\n        <div className=\"CommentPlugin_CommentsPanel_Empty\">No Comments</div>\n      ) : (\n        <CommentsPanelList\n          activeIDs={activeIDs}\n          comments={comments}\n          deleteCommentOrThread={deleteCommentOrThread}\n          listRef={listRef}\n          submitAddComment={submitAddComment}\n          markNodeMap={markNodeMap}\n        />\n      )}\n    </div>\n  );\n}\n\nfunction useCollabAuthorName(): string {\n  const collabContext = useCollaborationContext();\n  const { yjsDocMap, name } = collabContext;\n  return yjsDocMap.has('comments') ? name : 'Playground User';\n}\n\nexport default function CommentPlugin({\n  providerFactory,\n}: {\n  providerFactory?: (\n    id: string,\n    yjsDocMap: Map<string, Doc>\n  ) => WebsocketProvider;\n}): JSX.Element {\n  const collabContext = useCollaborationContext();\n  const [editor] = useLexicalComposerContext();\n  const commentStore = useMemo(() => new CommentStore(editor), [editor]);\n  const comments = useCommentStore(commentStore);\n  const markNodeMap = useMemo<Map<string, Set<NodeKey>>>(() => {\n    return new Map();\n  }, []);\n  const [activeAnchorKey, setActiveAnchorKey] = useState<NodeKey | null>();\n  const [activeIDs, setActiveIDs] = useState<Array<string>>([]);\n  const [showCommentInput, setShowCommentInput] = useState(false);\n  const [showComments, setShowComments] = useState(false);\n  const { yjsDocMap } = collabContext;\n\n  useEffect(() => {\n    if (providerFactory) {\n      const provider = providerFactory('comments', yjsDocMap);\n      return commentStore.registerCollaboration(provider);\n    }\n  }, [commentStore, providerFactory, yjsDocMap]);\n\n  const cancelAddComment = useCallback(() => {\n    editor.update(() => {\n      const selection = $getSelection();\n      // Restore selection\n      if (selection !== null) {\n        selection.dirty = true;\n      }\n    });\n    setShowCommentInput(false);\n  }, [editor]);\n\n  const deleteCommentOrThread = useCallback(\n    (comment: Comment | Thread, thread?: Thread) => {\n      if (comment.type === 'comment') {\n        const deletionInfo = commentStore.deleteCommentOrThread(\n          comment,\n          thread\n        );\n        if (!deletionInfo) return;\n        const { markedComment, index } = deletionInfo;\n        commentStore.addComment(markedComment, thread, index);\n      } else {\n        commentStore.deleteCommentOrThread(comment);\n        // Remove ids from associated marks\n        const id = thread !== undefined ? thread.id : comment.id;\n        const markNodeKeys = markNodeMap.get(id);\n        if (markNodeKeys !== undefined) {\n          // Do async to avoid causing a React infinite loop\n          setTimeout(() => {\n            editor.update(() => {\n              for (const key of markNodeKeys) {\n                const node: null | MarkNode = $getNodeByKey(key);\n                if ($isMarkNode(node)) {\n                  node.deleteID(id);\n                  if (node.getIDs().length === 0) {\n                    $unwrapMarkNode(node);\n                  }\n                }\n              }\n            });\n          });\n        }\n      }\n    },\n    [commentStore, editor, markNodeMap]\n  );\n\n  const submitAddComment = useCallback(\n    (\n      commentOrThread: Comment | Thread,\n      isInlineComment: boolean,\n      thread?: Thread\n    ) => {\n      commentStore.addComment(commentOrThread, thread);\n      if (isInlineComment) {\n        editor.update(() => {\n          const selection = $getSelection();\n          if ($isRangeSelection(selection)) {\n            const focus = selection.focus;\n            const anchor = selection.anchor;\n            const isBackward = selection.isBackward();\n            const id = commentOrThread.id;\n\n            // Wrap content in a MarkNode\n            $wrapSelectionInMarkNode(selection, isBackward, id);\n\n            // Make selection collapsed at the end\n            if (isBackward) {\n              focus.set(anchor.key, anchor.offset, anchor.type);\n            } else {\n              anchor.set(focus.key, focus.offset, focus.type);\n            }\n          }\n        });\n        setShowCommentInput(false);\n      }\n    },\n    [commentStore, editor]\n  );\n\n  useEffect(() => {\n    const changedElems: Array<HTMLElement> = [];\n    for (let i = 0; i < activeIDs.length; i++) {\n      const id = activeIDs[i];\n      const keys = markNodeMap.get(id);\n      if (keys !== undefined) {\n        for (const key of keys) {\n          const elem = editor.getElementByKey(key);\n          if (elem !== null) {\n            elem.classList.add('selected');\n            changedElems.push(elem);\n            setShowComments(true);\n          }\n        }\n      }\n    }\n    return () => {\n      for (let i = 0; i < changedElems.length; i++) {\n        const changedElem = changedElems[i];\n        changedElem.classList.remove('selected');\n      }\n    };\n  }, [activeIDs, editor, markNodeMap]);\n\n  useEffect(() => {\n    const markNodeKeysToIDs: Map<NodeKey, Array<string>> = new Map();\n\n    return mergeRegister(\n      registerNestedElementResolver<MarkNode>(\n        editor,\n        MarkNode,\n        (from: MarkNode) => {\n          return $createMarkNode(from.getIDs());\n        },\n        (from: MarkNode, to: MarkNode) => {\n          // Merge the IDs\n          const ids = from.getIDs();\n          ids.forEach((id) => {\n            to.addID(id);\n          });\n        }\n      ),\n      editor.registerMutationListener(MarkNode, (mutations) => {\n        editor.getEditorState().read(() => {\n          for (const [key, mutation] of mutations) {\n            const node: null | MarkNode = $getNodeByKey(key);\n            let ids: NodeKey[] = [];\n\n            if (mutation === 'destroyed') {\n              ids = markNodeKeysToIDs.get(key) || [];\n            } else if ($isMarkNode(node)) {\n              ids = node.getIDs();\n            }\n\n            for (let i = 0; i < ids.length; i++) {\n              const id = ids[i];\n              let markNodeKeys = markNodeMap.get(id);\n              markNodeKeysToIDs.set(key, ids);\n\n              if (mutation === 'destroyed') {\n                if (markNodeKeys !== undefined) {\n                  markNodeKeys.delete(key);\n                  if (markNodeKeys.size === 0) {\n                    markNodeMap.delete(id);\n                  }\n                }\n              } else {\n                if (markNodeKeys === undefined) {\n                  markNodeKeys = new Set();\n                  markNodeMap.set(id, markNodeKeys);\n                }\n                if (!markNodeKeys.has(key)) {\n                  markNodeKeys.add(key);\n                }\n              }\n            }\n          }\n        });\n      }),\n      editor.registerUpdateListener(({ editorState, tags }) => {\n        editorState.read(() => {\n          const selection = $getSelection();\n          let hasActiveIds = false;\n          let hasAnchorKey = false;\n\n          if ($isRangeSelection(selection)) {\n            const anchorNode = selection.anchor.getNode();\n\n            if ($isTextNode(anchorNode)) {\n              const commentIDs = $getMarkIDs(\n                anchorNode,\n                selection.anchor.offset\n              );\n              if (commentIDs !== null) {\n                setActiveIDs(commentIDs);\n                hasActiveIds = true;\n              }\n              if (!selection.isCollapsed()) {\n                setActiveAnchorKey(anchorNode.getKey());\n                hasAnchorKey = true;\n              }\n            }\n          }\n          if (!hasActiveIds) {\n            setActiveIDs((_activeIds) =>\n              _activeIds.length === 0 ? _activeIds : []\n            );\n          }\n          if (!hasAnchorKey) {\n            setActiveAnchorKey(null);\n          }\n        });\n        if (!tags.has('collaboration')) {\n          setShowCommentInput(false);\n        }\n      }),\n      editor.registerCommand(\n        INSERT_INLINE_COMMAND,\n        () => {\n          const domSelection = window.getSelection();\n          if (domSelection !== null) {\n            domSelection.removeAllRanges();\n          }\n          setShowCommentInput(true);\n          return true;\n        },\n        COMMAND_PRIORITY_EDITOR\n      )\n    );\n  }, [editor, markNodeMap]);\n\n  const onAddComment = () => {\n    editor.dispatchCommand(INSERT_INLINE_COMMAND, undefined);\n  };\n\n  return (\n    <>\n      {showCommentInput &&\n        createPortal(\n          <CommentInputBox\n            editor={editor}\n            cancelAddComment={cancelAddComment}\n            submitAddComment={submitAddComment}\n          />,\n          document.body\n        )}\n      {activeAnchorKey !== null &&\n        activeAnchorKey !== undefined &&\n        !showCommentInput &&\n        createPortal(\n          <AddCommentBox\n            anchorKey={activeAnchorKey}\n            editor={editor}\n            onAddComment={onAddComment}\n          />,\n          document.body\n        )}\n      {createPortal(\n        <Button\n          className={`CommentPlugin_ShowCommentsButton ${\n            showComments ? 'active' : ''\n          }`}\n          onClick={() => setShowComments(!showComments)}\n          title={showComments ? 'Hide Comments' : 'Show Comments'}\n        >\n          <i className=\"comments\" />\n        </Button>,\n        document.body\n      )}\n      {showComments &&\n        createPortal(\n          <CommentsPanel\n            comments={comments}\n            submitAddComment={submitAddComment}\n            deleteCommentOrThread={deleteCommentOrThread}\n            activeIDs={activeIDs}\n            markNodeMap={markNodeMap}\n          />,\n          document.body\n        )}\n    </>\n  );\n}\n","/**\n * Copyright (c) Meta Platforms, Inc. and affiliates.\n *\n * This source code is licensed under the MIT license found in the\n * LICENSE file in the root directory of this source tree.\n *\n */\n\nimport { $isCodeHighlightNode } from '@lexical/code';\nimport { $isLinkNode, TOGGLE_LINK_COMMAND } from '@lexical/link';\nimport { useLexicalComposerContext } from '@lexical/react/LexicalComposerContext';\nimport { $isAtNodeEnd } from '@lexical/selection';\nimport { mergeRegister } from '@lexical/utils';\nimport {\n  $getSelection,\n  $isRangeSelection,\n  $isTextNode,\n  COMMAND_PRIORITY_LOW,\n  ElementNode,\n  FORMAT_TEXT_COMMAND,\n  LexicalEditor,\n  RangeSelection,\n  SELECTION_CHANGE_COMMAND,\n  TextNode,\n} from 'lexical';\nimport { useCallback, useEffect, useRef, useState } from 'react';\nimport * as React from 'react';\nimport { createPortal } from 'react-dom';\n\nimport { INSERT_INLINE_COMMAND } from './CommentPlugin';\n\nfunction setPopupPosition(\n  editor: HTMLElement,\n  rect: ClientRect,\n  rootElementRect: ClientRect\n): void {\n  let top = rect.top - 8 + window.pageYOffset;\n  let left =\n    rect.left + 340 + window.pageXOffset - editor.offsetWidth + rect.width;\n  if (\n    rect.width >= rootElementRect.width - 20 ||\n    left > rootElementRect.width - 150\n  ) {\n    left = rect.left;\n    top = rect.top - 50 + window.pageYOffset;\n  }\n  if (top < rootElementRect.top) {\n    top = rect.bottom + 20;\n  }\n  editor.style.opacity = '1';\n  editor.style.top = `${top}px`;\n  editor.style.left = `${left}px`;\n}\n\nfunction FloatingCharacterStylesEditor({\n  editor,\n  isLink,\n  isBold,\n  isItalic,\n  isUnderline,\n  isCode,\n  isStrikethrough,\n  isSubscript,\n  isSuperscript,\n}: {\n  editor: LexicalEditor;\n  isBold: boolean;\n  isCode: boolean;\n  isItalic: boolean;\n  isLink: boolean;\n  isStrikethrough: boolean;\n  isSubscript: boolean;\n  isSuperscript: boolean;\n  isUnderline: boolean;\n}): JSX.Element {\n  const popupCharStylesEditorRef = useRef<HTMLDivElement | null>(null);\n  const mouseDownRef = useRef(false);\n\n  const insertLink = useCallback(() => {\n    if (!isLink) {\n      editor.dispatchCommand(TOGGLE_LINK_COMMAND, 'https://');\n    } else {\n      editor.dispatchCommand(TOGGLE_LINK_COMMAND, null);\n    }\n  }, [editor, isLink]);\n\n  const insertComment = () => {\n    editor.dispatchCommand(INSERT_INLINE_COMMAND, null);\n  };\n\n  const updateCharacterStylesEditor = useCallback(() => {\n    const selection = $getSelection();\n\n    const popupCharStylesEditorElem = popupCharStylesEditorRef.current;\n    const nativeSelection = window.getSelection();\n\n    if (popupCharStylesEditorElem === null) {\n      return;\n    }\n\n    const rootElement = editor.getRootElement();\n    if (\n      selection !== null &&\n      nativeSelection !== null &&\n      !nativeSelection.isCollapsed &&\n      rootElement !== null &&\n      rootElement.contains(nativeSelection.anchorNode)\n    ) {\n      const domRange = nativeSelection.getRangeAt(0);\n      const rootElementRect = rootElement.getBoundingClientRect();\n      let rect;\n\n      if (nativeSelection.anchorNode === rootElement) {\n        let inner = rootElement;\n        while (inner.firstElementChild != null) {\n          inner = inner.firstElementChild as HTMLElement;\n        }\n        rect = inner.getBoundingClientRect();\n      } else {\n        rect = domRange.getBoundingClientRect();\n      }\n\n      if (!mouseDownRef.current) {\n        setPopupPosition(popupCharStylesEditorElem, rect, rootElementRect);\n      }\n    }\n  }, [editor]);\n\n  useEffect(() => {\n    const onResize = () => {\n      editor.getEditorState().read(() => {\n        updateCharacterStylesEditor();\n      });\n    };\n    window.addEventListener('resize', onResize);\n\n    return () => {\n      window.removeEventListener('resize', onResize);\n    };\n  }, [editor, updateCharacterStylesEditor]);\n\n  useEffect(() => {\n    editor.getEditorState().read(() => {\n      updateCharacterStylesEditor();\n    });\n    return mergeRegister(\n      editor.registerUpdateListener(({ editorState }) => {\n        editorState.read(() => {\n          updateCharacterStylesEditor();\n        });\n      }),\n\n      editor.registerCommand(\n        SELECTION_CHANGE_COMMAND,\n        () => {\n          updateCharacterStylesEditor();\n          return false;\n        },\n        COMMAND_PRIORITY_LOW\n      )\n    );\n  }, [editor, updateCharacterStylesEditor]);\n\n  return (\n    <div ref={popupCharStylesEditorRef} className=\"character-style-popup\">\n      <button\n        onClick={() => {\n          editor.dispatchCommand(FORMAT_TEXT_COMMAND, 'bold');\n        }}\n        className={'popup-item spaced ' + (isBold ? 'active' : '')}\n        aria-label=\"Format text as bold\"\n        type=\"button\"\n      >\n        <i className=\"format bold\" />\n      </button>\n      <button\n        onClick={() => {\n          editor.dispatchCommand(FORMAT_TEXT_COMMAND, 'italic');\n        }}\n        className={'popup-item spaced ' + (isItalic ? 'active' : '')}\n        aria-label=\"Format text as italics\"\n        type=\"button\"\n      >\n        <i className=\"format italic\" />\n      </button>\n      <button\n        onClick={() => {\n          editor.dispatchCommand(FORMAT_TEXT_COMMAND, 'underline');\n        }}\n        className={'popup-item spaced ' + (isUnderline ? 'active' : '')}\n        aria-label=\"Format text to underlined\"\n        type=\"button\"\n      >\n        <i className=\"format underline\" />\n      </button>\n      <button\n        onClick={() => {\n          editor.dispatchCommand(FORMAT_TEXT_COMMAND, 'strikethrough');\n        }}\n        className={'popup-item spaced ' + (isStrikethrough ? 'active' : '')}\n        aria-label=\"Format text with a strikethrough\"\n        type=\"button\"\n      >\n        <i className=\"format strikethrough\" />\n      </button>\n      <button\n        onClick={() => {\n          editor.dispatchCommand(FORMAT_TEXT_COMMAND, 'subscript');\n        }}\n        className={'popup-item spaced ' + (isSubscript ? 'active' : '')}\n        title=\"Subscript\"\n        aria-label=\"Format Subscript\"\n        type=\"button\"\n      >\n        <i className=\"format subscript\" />\n      </button>\n      <button\n        onClick={() => {\n          editor.dispatchCommand(FORMAT_TEXT_COMMAND, 'superscript');\n        }}\n        className={'popup-item spaced ' + (isSuperscript ? 'active' : '')}\n        title=\"Superscript\"\n        aria-label=\"Format Superscript\"\n        type=\"button\"\n      >\n        <i className=\"format superscript\" />\n      </button>\n      <button\n        onClick={() => {\n          editor.dispatchCommand(FORMAT_TEXT_COMMAND, 'code');\n        }}\n        className={'popup-item spaced ' + (isCode ? 'active' : '')}\n        aria-label=\"Insert code block\"\n        type=\"button\"\n      >\n        <i className=\"format code\" />\n      </button>\n      <button\n        onClick={insertLink}\n        className={'popup-item spaced ' + (isLink ? 'active' : '')}\n        aria-label=\"Insert link\"\n        type=\"button\"\n      >\n        <i className=\"format link\" />\n      </button>\n      <button\n        onClick={insertComment}\n        className={'popup-item spaced ' + (isLink ? 'active' : '')}\n        aria-label=\"Insert link\"\n        type=\"button\"\n      >\n        <i className=\"format add-comment\" />\n      </button>\n    </div>\n  );\n}\n\nfunction getSelectedNode(selection: RangeSelection): TextNode | ElementNode {\n  const anchor = selection.anchor;\n  const focus = selection.focus;\n  const anchorNode = selection.anchor.getNode();\n  const focusNode = selection.focus.getNode();\n  if (anchorNode === focusNode) {\n    return anchorNode;\n  }\n  const isBackward = selection.isBackward();\n  if (isBackward) {\n    return $isAtNodeEnd(focus) ? anchorNode : focusNode;\n  } else {\n    return $isAtNodeEnd(anchor) ? focusNode : anchorNode;\n  }\n}\n\nfunction useCharacterStylesPopup(editor: LexicalEditor): JSX.Element | null {\n  const [isText, setIsText] = useState(false);\n  const [isLink, setIsLink] = useState(false);\n  const [isBold, setIsBold] = useState(false);\n  const [isItalic, setIsItalic] = useState(false);\n  const [isUnderline, setIsUnderline] = useState(false);\n  const [isStrikethrough, setIsStrikethrough] = useState(false);\n  const [isSubscript, setIsSubscript] = useState(false);\n  const [isSuperscript, setIsSuperscript] = useState(false);\n  const [isCode, setIsCode] = useState(false);\n\n  const updatePopup = useCallback(() => {\n    editor.getEditorState().read(() => {\n      const selection = $getSelection();\n      const nativeSelection = window.getSelection();\n      const rootElement = editor.getRootElement();\n\n      if (\n        nativeSelection !== null &&\n        (!$isRangeSelection(selection) ||\n          rootElement === null ||\n          !rootElement.contains(nativeSelection.anchorNode))\n      ) {\n        setIsText(false);\n        return;\n      }\n\n      if (!$isRangeSelection(selection)) {\n        return;\n      }\n\n      const node = getSelectedNode(selection);\n\n      // Update text format\n      setIsBold(selection.hasFormat('bold'));\n      setIsItalic(selection.hasFormat('italic'));\n      setIsUnderline(selection.hasFormat('underline'));\n      setIsStrikethrough(selection.hasFormat('strikethrough'));\n      setIsSubscript(selection.hasFormat('subscript'));\n      setIsSuperscript(selection.hasFormat('superscript'));\n      setIsCode(selection.hasFormat('code'));\n\n      // Update links\n      const parent = node.getParent();\n      if ($isLinkNode(parent) || $isLinkNode(node)) {\n        setIsLink(true);\n      } else {\n        setIsLink(false);\n      }\n\n      if (\n        !$isCodeHighlightNode(selection.anchor.getNode()) &&\n        selection.getTextContent() !== ''\n      ) {\n        setIsText($isTextNode(node));\n      } else {\n        setIsText(false);\n      }\n    });\n  }, [editor]);\n\n  useEffect(() => {\n    document.addEventListener('selectionchange', updatePopup);\n    return () => {\n      document.removeEventListener('selectionchange', updatePopup);\n    };\n  }, [updatePopup]);\n\n  useEffect(() => {\n    return editor.registerUpdateListener(() => {\n      updatePopup();\n    });\n  }, [editor, updatePopup]);\n\n  if (!isText || isLink) {\n    return null;\n  }\n\n  return createPortal(\n    <FloatingCharacterStylesEditor\n      editor={editor}\n      isLink={isLink}\n      isBold={isBold}\n      isItalic={isItalic}\n      isStrikethrough={isStrikethrough}\n      isSubscript={isSubscript}\n      isSuperscript={isSuperscript}\n      isUnderline={isUnderline}\n      isCode={isCode}\n    />,\n    document.body\n  );\n}\n\nexport default function CharacterStylesPopupPlugin(): JSX.Element | null {\n  const [editor] = useLexicalComposerContext();\n  return useCharacterStylesPopup(editor);\n}\n","/**\n * Copyright (c) Meta Platforms, Inc. and affiliates.\n *\n * This source code is licensed under the MIT license found in the\n * LICENSE file in the root directory of this source tree.\n *\n */\n\nimport type { LinkNode } from '@lexical/link';\nimport type { LexicalEditor } from 'lexical';\n\nimport { $isLinkNode } from '@lexical/link';\nimport { useLexicalComposerContext } from '@lexical/react/LexicalComposerContext';\nimport { $getNearestNodeFromDOMNode } from 'lexical';\nimport { useEffect, useRef } from 'react';\n\ntype LinkFilter = (event: MouseEvent, linkNode: LinkNode) => boolean;\nexport default function ClickableLinkPlugin({\n  filter,\n  newTab = true,\n}: {\n  filter?: LinkFilter;\n  newTab?: boolean;\n}): JSX.Element {\n  const [editor] = useLexicalComposerContext();\n  const hasMoved = useRef(false);\n  useEffect(() => {\n    let prevOffsetX;\n    let prevOffsetY;\n\n    function onPointerDown(event: PointerEvent) {\n      prevOffsetX = event.offsetX;\n      prevOffsetY = event.offsetY;\n    }\n\n    function onPointerUp(event: PointerEvent) {\n      hasMoved.current =\n        event.offsetX !== prevOffsetX || event.offsetY !== prevOffsetY;\n    }\n\n    function onClick(e: Event) {\n      // Based on pointerdown/up we can check if cursor moved during click event,\n      // and ignore clicks with moves (to allow link text selection)\n      const hasMovedDuringClick = hasMoved.current;\n      hasMoved.current = false;\n      // $FlowExpectedError[incompatible-cast] onClick handler will get MouseEvent, safe to cast\n      const event = e as MouseEvent;\n      const linkDomNode = getLinkDomNode(event, editor);\n\n      if (linkDomNode === null) {\n        return;\n      }\n\n      const href = linkDomNode.getAttribute('href');\n\n      if (\n        linkDomNode.getAttribute('contenteditable') === 'false' ||\n        href === undefined\n      ) {\n        return;\n      }\n\n      let linkNode = null;\n      editor.update(() => {\n        const maybeLinkNode = $getNearestNodeFromDOMNode(linkDomNode);\n\n        if ($isLinkNode(maybeLinkNode)) {\n          linkNode = maybeLinkNode;\n        }\n      });\n\n      if (\n        linkNode === null ||\n        (filter !== undefined && !filter(event, linkNode))\n      ) {\n        return;\n      }\n\n      if (hasMovedDuringClick) {\n        return;\n      }\n\n      try {\n        window.open(\n          href,\n          newTab || event.metaKey || event.ctrlKey ? '_blank' : '_self'\n        );\n      } catch {\n        // It didn't work, which is better than throwing an exception!\n      }\n    }\n\n    return editor.registerRootListener(\n      (\n        rootElement: null | HTMLElement,\n        prevRootElement: null | HTMLElement\n      ) => {\n        if (prevRootElement !== null) {\n          prevRootElement.removeEventListener('pointerdown', onPointerDown);\n          prevRootElement.removeEventListener('pointerup', onPointerUp);\n          prevRootElement.removeEventListener('click', onClick);\n        }\n\n        if (rootElement !== null) {\n          rootElement.addEventListener('click', onClick);\n          rootElement.addEventListener('pointerdown', onPointerDown);\n          rootElement.addEventListener('pointerup', onPointerUp);\n        }\n      }\n    );\n  }, [editor, filter, newTab]);\n  return null;\n}\n\nfunction isLinkDomNode(domNode: Node): boolean {\n  return domNode.nodeName.toLowerCase() === 'a';\n}\n\nfunction getLinkDomNode(\n  event: MouseEvent,\n  editor: LexicalEditor\n): HTMLAnchorElement | null {\n  return editor.getEditorState().read(() => {\n    // $FlowExpectedError[incompatible-cast]\n    const domNode = event.target as Node;\n\n    if (isLinkDomNode(domNode)) {\n      // $FlowExpectedError[incompatible-cast]\n      return domNode as HTMLAnchorElement;\n    }\n\n    if (domNode.parentNode && isLinkDomNode(domNode.parentNode)) {\n      // $FlowExpectedError[incompatible-cast]\n      return domNode.parentNode as HTMLAnchorElement;\n    }\n\n    return null;\n  });\n}\n","/**\n * Copyright (c) Meta Platforms, Inc. and affiliates.\n *\n * This source code is licensed under the MIT license found in the\n * LICENSE file in the root directory of this source tree.\n *\n */\n\nimport { registerCodeHighlighting } from '@lexical/code';\nimport { useLexicalComposerContext } from '@lexical/react/LexicalComposerContext';\nimport { useEffect } from 'react';\n\nexport default function CodeHighlightPlugin(): JSX.Element | null {\n  const [editor] = useLexicalComposerContext();\n\n  useEffect(() => {\n    return registerCodeHighlighting(editor);\n  }, [editor]);\n\n  return null;\n}\n","/**\n * Copyright (c) Meta Platforms, Inc. and affiliates.\n *\n * This source code is licensed under the MIT license found in the\n * LICENSE file in the root directory of this source tree.\n *\n */\n\nimport type { RangeSelection } from 'lexical';\n\nimport { $getListDepth, $isListItemNode, $isListNode } from '@lexical/list';\nimport { useLexicalComposerContext } from '@lexical/react/LexicalComposerContext';\nimport {\n  $getSelection,\n  $isElementNode,\n  $isRangeSelection,\n  COMMAND_PRIORITY_CRITICAL,\n  ElementNode,\n  INDENT_CONTENT_COMMAND,\n} from 'lexical';\nimport { useEffect } from 'react';\n\ntype Props = Readonly<{\n  maxDepth: number | null | undefined;\n}>;\n\nfunction getElementNodesInSelection(\n  selection: RangeSelection\n): Set<ElementNode> {\n  const nodesInSelection = selection.getNodes();\n\n  if (nodesInSelection.length === 0) {\n    return new Set([\n      selection.anchor.getNode().getParentOrThrow(),\n      selection.focus.getNode().getParentOrThrow(),\n    ]);\n  }\n\n  return new Set(\n    nodesInSelection.map((n) => ($isElementNode(n) ? n : n.getParentOrThrow()))\n  );\n}\n\nfunction isIndentPermitted(maxDepth: number): boolean {\n  const selection = $getSelection();\n\n  if (!$isRangeSelection(selection)) {\n    return false;\n  }\n\n  const elementNodesInSelection: Set<ElementNode> =\n    getElementNodesInSelection(selection);\n\n  let totalDepth = 0;\n\n  for (const elementNode of elementNodesInSelection) {\n    if ($isListNode(elementNode)) {\n      totalDepth = Math.max($getListDepth(elementNode) + 1, totalDepth);\n    } else if ($isListItemNode(elementNode)) {\n      const parent = elementNode.getParent();\n\n      if (!$isListNode(parent)) {\n        throw new Error(\n          'ListMaxIndentLevelPlugin: A ListItemNode must have a ListNode for a parent.'\n        );\n      }\n\n      totalDepth = Math.max($getListDepth(parent) + 1, totalDepth);\n    }\n  }\n\n  return totalDepth <= maxDepth;\n}\n\nexport default function ListMaxIndentLevelPlugin({ maxDepth }: Props): null {\n  const [editor] = useLexicalComposerContext();\n\n  useEffect(() => {\n    return editor.registerCommand(\n      INDENT_CONTENT_COMMAND,\n      () => !isIndentPermitted(maxDepth ?? 7),\n      COMMAND_PRIORITY_CRITICAL\n    );\n  }, [editor, maxDepth]);\n  return null;\n}\n","/**\n * Copyright (c) Meta Platforms, Inc. and affiliates.\n * This source code is licensed under the MIT license found in the\n * LICENSE file in the root directory of this source tree.\n *\n *\n */\n\nimport { MarkdownShortcutPlugin } from '@lexical/react/LexicalMarkdownShortcutPlugin';\nimport * as React from 'react';\n\nimport { PLAYGROUND_TRANSFORMERS } from './MarkdownTransformers';\n\nexport default function MarkdownPlugin(): JSX.Element {\n  return <MarkdownShortcutPlugin transformers={PLAYGROUND_TRANSFORMERS} />;\n}\n","/**\n * Copyright (c) Meta Platforms, Inc. and affiliates.\n *\n * This source code is licensed under the MIT license found in the\n * LICENSE file in the root directory of this source tree.\n *\n */\n\nimport { useLexicalComposerContext } from '@lexical/react/LexicalComposerContext';\nimport {\n  $getSelection,\n  $isRangeSelection,\n  $setSelection,\n  FOCUS_COMMAND,\n} from 'lexical';\nimport { useEffect } from 'react';\n\nconst COMMAND_PRIORITY_LOW = 1;\nconst TAB_TO_FOCUS_INTERVAL = 100;\n\nlet lastTabKeyDownTimestamp = 0;\nlet hasRegisteredKeyDownListener = false;\n\nfunction registerKeyTimeStampTracker() {\n  window.addEventListener(\n    'keydown',\n    (event: KeyboardEvent) => {\n      // Tab\n      if (event.keyCode === 9) {\n        lastTabKeyDownTimestamp = event.timeStamp;\n      }\n    },\n    true\n  );\n}\n\nexport default function TabFocusPlugin(): null {\n  const [editor] = useLexicalComposerContext();\n\n  useEffect(() => {\n    if (!hasRegisteredKeyDownListener) {\n      registerKeyTimeStampTracker();\n      hasRegisteredKeyDownListener = true;\n    }\n\n    return editor.registerCommand(\n      FOCUS_COMMAND,\n      (event: FocusEvent) => {\n        const selection = $getSelection();\n        if ($isRangeSelection(selection)) {\n          if (\n            lastTabKeyDownTimestamp + TAB_TO_FOCUS_INTERVAL >\n            event.timeStamp\n          ) {\n            $setSelection(selection.clone());\n          }\n        }\n        return false;\n      },\n      COMMAND_PRIORITY_LOW\n    );\n  }, [editor]);\n\n  return null;\n}\n","import { LexicalEditor } from 'lexical';\nimport React, { createContext } from 'react';\n\ninterface IEditorContext {\n  initialEditor: LexicalEditor;\n  activeEditor: LexicalEditor;\n  setActiveEditor: React.Dispatch<React.SetStateAction<LexicalEditor>>;\n}\n\nconst EditorContext = createContext<IEditorContext | null>(null);\n\nexport default EditorContext;\n","import { $isAtNodeEnd } from '@lexical/selection';\nimport { ElementNode, RangeSelection, TextNode } from 'lexical';\n\nexport function getSelectedNode(\n  selection: RangeSelection\n): TextNode | ElementNode {\n  const anchor = selection.anchor;\n  const focus = selection.focus;\n  const anchorNode = selection.anchor.getNode();\n  const focusNode = selection.focus.getNode();\n  if (anchorNode === focusNode) {\n    return anchorNode;\n  }\n  const isBackward = selection.isBackward();\n  if (isBackward) {\n    return $isAtNodeEnd(focus) ? anchorNode : focusNode;\n  } else {\n    return $isAtNodeEnd(anchor) ? focusNode : anchorNode;\n  }\n}\n","import { LexicalEditor } from 'lexical';\nimport React, { createContext } from 'react';\n\ninterface IToolbarContext {\n  isRTL: boolean;\n  isBold: boolean;\n  isItalic: boolean;\n  isUnderline: boolean;\n  isCode: boolean;\n  isLink: boolean;\n  isStrikethrough: boolean;\n  isSubscript: boolean;\n  isSuperscript: boolean;\n  canUndo: boolean;\n  canRedo: boolean;\n  fontFamily: string;\n  fontSize: string;\n  fontColor: string;\n  bgColor: string;\n  blockType: string;\n  codeLanguage: string;\n  selectedElementKey: string;\n  applyStyleText: (styles: Record<string, string>) => void;\n  insertLink: () => void;\n}\n\nconst ToolbarContext = createContext<IToolbarContext | null>(null);\n\nexport default ToolbarContext;\n","/**\n * Copyright (c) Meta Platforms, Inc. and affiliates.\n *\n * This source code is licensed under the MIT license found in the\n * LICENSE file in the root directory of this source tree.\n *\n */\n\nimport { useEffect, useRef, useState } from 'react';\nimport * as React from 'react';\nimport { createPortal } from 'react-dom';\n\nexport default function DropDown({\n  buttonLabel,\n  buttonAriaLabel,\n  buttonClassName,\n  buttonIconClassName,\n  children,\n  stopCloseOnClickSelf,\n}: {\n  buttonAriaLabel?: string;\n  buttonClassName: string;\n  buttonIconClassName?: string;\n  buttonLabel?: string;\n  children: JSX.Element | string | (JSX.Element | string)[];\n  stopCloseOnClickSelf?: boolean;\n}): JSX.Element {\n  const dropDownRef = useRef<HTMLDivElement | null>(null);\n  const buttonRef = useRef<HTMLButtonElement | null>(null);\n  const [showDropDown, setShowDropDown] = useState(false);\n\n  useEffect(() => {\n    const button = buttonRef.current;\n    const dropDown = dropDownRef.current;\n\n    if (showDropDown && button !== null && dropDown !== null) {\n      const { top, left } = button.getBoundingClientRect();\n      dropDown.style.top = `${top + 40}px`;\n      dropDown.style.left = `${Math.min(\n        left,\n        window.innerWidth - dropDown.offsetWidth - 20\n      )}px`;\n    }\n  }, [dropDownRef, buttonRef, showDropDown]);\n\n  useEffect(() => {\n    const button = buttonRef.current;\n\n    if (button !== null && showDropDown) {\n      const handle = (event: MouseEvent) => {\n        const target = event.target;\n        if (stopCloseOnClickSelf) {\n          if (dropDownRef.current.contains(target as Node)) return;\n        }\n        if (!button.contains(target as Node)) {\n          setShowDropDown(false);\n        }\n      };\n      document.addEventListener('click', handle);\n\n      return () => {\n        document.removeEventListener('click', handle);\n      };\n    }\n  }, [dropDownRef, buttonRef, showDropDown, stopCloseOnClickSelf]);\n\n  return (\n    <>\n      <button\n        aria-label={buttonAriaLabel || buttonLabel}\n        className={buttonClassName}\n        onClick={() => setShowDropDown(!showDropDown)}\n        ref={buttonRef}\n        type=\"button\"\n      >\n        {buttonIconClassName && <span className={buttonIconClassName} />}\n        {buttonLabel && (\n          <span className=\"text dropdown-button-text\">{buttonLabel}</span>\n        )}\n        <i className=\"chevron-down\" />\n      </button>\n\n      {showDropDown &&\n        createPortal(\n          <div className=\"dropdown\" ref={dropDownRef}>\n            {children}\n          </div>,\n          document.body\n        )}\n    </>\n  );\n}\n","import React, { useContext } from 'react';\nimport DropDown from '../../../ui/DropDown';\n\nimport {\n  FORMAT_ELEMENT_COMMAND,\n  INDENT_CONTENT_COMMAND,\n  LexicalEditor,\n  OUTDENT_CONTENT_COMMAND,\n} from 'lexical';\nimport EditorContext from '../../../context/EditorContext';\nimport ToolbarContext from '../../../context/ToolbarContext';\n\nfunction Divider(): JSX.Element {\n  return <div className=\"divider\" />;\n}\n\nconst AlignDropdown = () => {\n  const { activeEditor } = useContext(EditorContext);\n  const { isRTL } = useContext(ToolbarContext);\n  return (\n    <DropDown\n      buttonLabel=\"Align\"\n      buttonIconClassName=\"icon left-align\"\n      buttonClassName=\"toolbar-item spaced alignment\"\n      buttonAriaLabel=\"Formatting options for text alignment\"\n    >\n      <button\n        onClick={() => {\n          activeEditor.dispatchCommand(FORMAT_ELEMENT_COMMAND, 'left');\n        }}\n        className=\"item\"\n        type=\"button\"\n      >\n        <i className=\"icon left-align\" />\n        <span className=\"text\">Left Align</span>\n      </button>\n      <button\n        onClick={() => {\n          activeEditor.dispatchCommand(FORMAT_ELEMENT_COMMAND, 'center');\n        }}\n        className=\"item\"\n        type=\"button\"\n      >\n        <i className=\"icon center-align\" />\n        <span className=\"text\">Center Align</span>\n      </button>\n      <button\n        onClick={() => {\n          activeEditor.dispatchCommand(FORMAT_ELEMENT_COMMAND, 'right');\n        }}\n        className=\"item\"\n        type=\"button\"\n      >\n        <i className=\"icon right-align\" />\n        <span className=\"text\">Right Align</span>\n      </button>\n      <button\n        onClick={() => {\n          activeEditor.dispatchCommand(FORMAT_ELEMENT_COMMAND, 'justify');\n        }}\n        className=\"item\"\n        type=\"button\"\n      >\n        <i className=\"icon justify-align\" />\n        <span className=\"text\">Justify Align</span>\n      </button>\n      <Divider />\n      <button\n        onClick={() => {\n          activeEditor.dispatchCommand(OUTDENT_CONTENT_COMMAND, undefined);\n        }}\n        className=\"item\"\n        type=\"button\"\n      >\n        <i className={'icon ' + (isRTL ? 'indent' : 'outdent')} />\n        <span className=\"text\">Outdent</span>\n      </button>\n      <button\n        onClick={() => {\n          activeEditor.dispatchCommand(INDENT_CONTENT_COMMAND, undefined);\n        }}\n        className=\"item\"\n        type=\"button\"\n      >\n        <i className={'icon ' + (isRTL ? 'outdent' : 'indent')} />\n        <span className=\"text\">Indent</span>\n      </button>\n    </DropDown>\n  );\n};\n\nexport default AlignDropdown;\n","/**\n * Copyright (c) Meta Platforms, Inc. and affiliates.\n *\n * This source code is licensed under the MIT license found in the\n * LICENSE file in the root directory of this source tree.\n *\n */\n\nimport './Input.css';\n\nimport * as React from 'react';\n\ntype Props = Readonly<{\n  'data-test-id'?: string;\n  label: string;\n  onChange: (string) => void;\n  placeholder?: string;\n  value: string;\n}>;\n\nexport default function TextInput({\n  label,\n  value,\n  onChange,\n  placeholder = '',\n  'data-test-id': dataTestId,\n}: Props): JSX.Element {\n  return (\n    <div className=\"Input__wrapper\">\n      <label className=\"Input__label\">{label}</label>\n      <input\n        type=\"text\"\n        className=\"Input__input\"\n        placeholder={placeholder}\n        value={value}\n        onChange={(e) => {\n          onChange(e.target.value);\n        }}\n        data-test-id={dataTestId}\n      />\n    </div>\n  );\n}\n","/**\n * Copyright (c) Meta Platforms, Inc. and affiliates.\n *\n * This source code is licensed under the MIT license found in the\n * LICENSE file in the root directory of this source tree.\n *\n */\n\nimport './Input.css';\n\nimport * as React from 'react';\n\ntype Props = Readonly<{\n  'data-test-id'?: string;\n  accept?: string;\n  label: string;\n  onChange: (files: FileList) => void;\n}>;\n\nexport default function FileInput({\n  accept,\n  label,\n  onChange,\n  'data-test-id': dataTestId,\n}: Props): JSX.Element {\n  return (\n    <div className=\"Input__wrapper\">\n      <label className=\"Input__label\">{label}</label>\n      <input\n        type=\"file\"\n        accept={accept}\n        className=\"Input__input\"\n        onChange={(e) => onChange(e.target.files)}\n        data-test-id={dataTestId}\n      />\n    </div>\n  );\n}\n","/**\n * Copyright (c) Meta Platforms, Inc. and affiliates.\n *\n * This source code is licensed under the MIT license found in the\n * LICENSE file in the root directory of this source tree.\n *\n */\n\nimport type { LexicalCommand } from 'lexical';\n\nimport 'katex/dist/katex.css';\n\nimport { useLexicalComposerContext } from '@lexical/react/LexicalComposerContext';\nimport {\n  $getSelection,\n  $isRangeSelection,\n  COMMAND_PRIORITY_EDITOR,\n  createCommand,\n} from 'lexical';\nimport { useEffect } from 'react';\n\nimport { $createEquationNode, EquationNode } from '../nodes/EquationNode';\n\ntype CommandPayload = {\n  equation: string;\n  inline: boolean;\n};\n\nexport const INSERT_EQUATION_COMMAND: LexicalCommand<CommandPayload> =\n  createCommand();\n\nexport default function EquationsPlugin(): JSX.Element | null {\n  const [editor] = useLexicalComposerContext();\n\n  useEffect(() => {\n    if (!editor.hasNodes([EquationNode])) {\n      throw new Error(\n        'EquationsPlugins: EquationsNode not registered on editor'\n      );\n    }\n\n    return editor.registerCommand<CommandPayload>(\n      INSERT_EQUATION_COMMAND,\n      (payload) => {\n        const { equation, inline } = payload;\n        const selection = $getSelection();\n\n        if ($isRangeSelection(selection)) {\n          const equationNode = $createEquationNode(equation, inline);\n          selection.insertNodes([equationNode]);\n        }\n\n        return true;\n      },\n      COMMAND_PRIORITY_EDITOR\n    );\n  }, [editor]);\n\n  return null;\n}\n","/**\n * Copyright (c) Meta Platforms, Inc. and affiliates.\n *\n * This source code is licensed under the MIT license found in the\n * LICENSE file in the root directory of this source tree.\n *\n */\n\nimport type { LexicalCommand } from 'lexical';\n\nimport { useLexicalComposerContext } from '@lexical/react/LexicalComposerContext';\nimport {\n  $createParagraphNode,\n  $getSelection,\n  $isRangeSelection,\n  COMMAND_PRIORITY_EDITOR,\n  createCommand,\n} from 'lexical';\nimport { useEffect } from 'react';\n\nimport { $createYouTubeNode, YouTubeNode } from '../nodes/YouTubeNode';\n\nexport const INSERT_YOUTUBE_COMMAND: LexicalCommand<string> = createCommand();\n\nexport default function YouTubePlugin(): JSX.Element {\n  const [editor] = useLexicalComposerContext();\n\n  useEffect(() => {\n    if (!editor.hasNodes([YouTubeNode])) {\n      throw new Error('YouTubePlugin: YouTubeNode not registered on editor');\n    }\n\n    return editor.registerCommand<string>(\n      INSERT_YOUTUBE_COMMAND,\n      (payload) => {\n        const selection = $getSelection();\n\n        if ($isRangeSelection(selection)) {\n          const focusNode = selection.focus.getNode();\n\n          if (focusNode !== null) {\n            const youTubeNode = $createYouTubeNode(payload);\n            selection.focus\n              .getNode()\n              .getTopLevelElementOrThrow()\n              .insertAfter(youTubeNode);\n            const paragraphNode = $createParagraphNode();\n            youTubeNode.insertAfter(paragraphNode);\n            paragraphNode.select();\n          }\n        }\n\n        return true;\n      },\n      COMMAND_PRIORITY_EDITOR\n    );\n  }, [editor]);\n\n  return null;\n}\n","/**\n * Copyright (c) Meta Platforms, Inc. and affiliates.\n *\n * This source code is licensed under the MIT license found in the\n * LICENSE file in the root directory of this source tree.\n *\n */\n\nimport './KatexEquationAlterer.css';\n\nimport * as React from 'react';\nimport { useCallback, useState } from 'react';\n\nimport Button from '../ui/Button';\nimport KatexRenderer from './KatexRenderer';\n\ntype Props = {\n  initialEquation?: string;\n  onConfirm: (string, boolean) => void;\n};\n\nexport default function KatexEquationAlterer({\n  onConfirm,\n  initialEquation = '',\n}: Props): JSX.Element {\n  const [equation, setEquation] = useState<string>(initialEquation);\n  const [inline, setInline] = useState<boolean>(true);\n\n  const onClick = useCallback(() => {\n    onConfirm(equation, inline);\n  }, [onConfirm, equation, inline]);\n\n  const onCheckboxChange = useCallback(() => {\n    setInline(!inline);\n  }, [setInline, inline]);\n\n  return (\n    <>\n      <div className=\"KatexEquationAlterer_defaultRow\">\n        Inline\n        <input type=\"checkbox\" checked={inline} onChange={onCheckboxChange} />\n      </div>\n      <div className=\"KatexEquationAlterer_defaultRow\">Equation </div>\n      <div className=\"KatexEquationAlterer_centerRow\">\n        {inline ? (\n          <input\n            onChange={(event) => {\n              setEquation(event.target.value);\n            }}\n            value={equation}\n            className=\"KatexEquationAlterer_textArea\"\n          />\n        ) : (\n          <textarea\n            onChange={(event) => {\n              setEquation(event.target.value);\n            }}\n            value={equation}\n            className=\"KatexEquationAlterer_textArea\"\n          />\n        )}\n      </div>\n      <div className=\"KatexEquationAlterer_defaultRow\">Visualization </div>\n      <div className=\"KatexEquationAlterer_centerRow\">\n        <KatexRenderer\n          equation={equation}\n          inline={false}\n          onClick={() => null}\n        />\n      </div>\n      <div className=\"KatexEquationAlterer_dialogActions\">\n        <Button onClick={onClick}>Confirm</Button>\n      </div>\n    </>\n  );\n}\n","/**\n * Copyright (c) Meta Platforms, Inc. and affiliates.\n *\n * This source code is licensed under the MIT license found in the\n * LICENSE file in the root directory of this source tree.\n *\n */\nimport type { Cell } from '@lexical/table';\nimport type { LexicalEditor } from 'lexical';\n\nimport './TableCellResizer.css';\n\nimport { useLexicalComposerContext } from '@lexical/react/LexicalComposerContext';\nimport {\n  $getTableColumnIndexFromTableCellNode,\n  $getTableNodeFromLexicalNodeOrThrow,\n  $getTableRowIndexFromTableCellNode,\n  $isTableCellNode,\n  $isTableRowNode,\n  getCellFromTarget,\n} from '@lexical/table';\nimport {\n  $getNearestNodeFromDOMNode,\n  $getSelection,\n  $isGridSelection,\n  COMMAND_PRIORITY_HIGH,\n  SELECTION_CHANGE_COMMAND,\n} from 'lexical';\nimport * as React from 'react';\nimport {\n  ReactPortal,\n  useCallback,\n  useEffect,\n  useMemo,\n  useRef,\n  useState,\n} from 'react';\nimport { createPortal } from 'react-dom';\n\ntype MousePosition = {\n  x: number;\n  y: number;\n};\n\ntype MouseDraggingDirection = 'right' | 'bottom';\n\nconst MIN_ROW_HEIGHT = 33;\nconst MIN_COLUMN_WIDTH = 50;\n\nfunction TableCellResizer({ editor }: { editor: LexicalEditor }): JSX.Element {\n  const targetRef = useRef<HTMLElement | null>(null);\n  const resizerRef = useRef<HTMLDivElement | null>(null);\n  const tableRectRef = useRef<ClientRect | null>(null);\n\n  const mouseStartPosRef = useRef<MousePosition | null>(null);\n  const [mouseCurrentPos, updateMouseCurrentPos] =\n    useState<MousePosition | null>(null);\n\n  const [activeCell, updateActiveCell] = useState<Cell | null>(null);\n  const [isSelectingGrid, updateIsSelectingGrid] = useState<boolean>(false);\n  const [draggingDirection, updateDraggingDirection] =\n    useState<MouseDraggingDirection | null>(null);\n\n  useEffect(() => {\n    return editor.registerCommand(\n      SELECTION_CHANGE_COMMAND,\n      (payload) => {\n        const selection = $getSelection();\n        const isGridSelection = $isGridSelection(selection);\n\n        if (isSelectingGrid !== isGridSelection) {\n          updateIsSelectingGrid(isGridSelection);\n        }\n\n        return false;\n      },\n      COMMAND_PRIORITY_HIGH\n    );\n  });\n\n  const resetState = useCallback(() => {\n    updateActiveCell(null);\n    targetRef.current = null;\n    updateDraggingDirection(null);\n    mouseStartPosRef.current = null;\n    tableRectRef.current = null;\n  }, []);\n\n  useEffect(() => {\n    const onMouseMove = (event: MouseEvent) => {\n      setTimeout(() => {\n        const target = event.target;\n\n        if (draggingDirection) {\n          updateMouseCurrentPos({\n            x: event.clientX,\n            y: event.clientY,\n          });\n          return;\n        }\n\n        if (resizerRef.current && resizerRef.current.contains(target as Node)) {\n          return;\n        }\n\n        if (targetRef.current !== target) {\n          targetRef.current = target as HTMLElement;\n          const cell = getCellFromTarget(target as HTMLElement);\n\n          if (cell && activeCell !== cell) {\n            editor.update(() => {\n              const tableCellNode = $getNearestNodeFromDOMNode(cell.elem);\n              if (!tableCellNode) {\n                throw new Error('TableCellResizer: Table cell node not found.');\n              }\n\n              const tableNode =\n                $getTableNodeFromLexicalNodeOrThrow(tableCellNode);\n              const tableElement = editor.getElementByKey(tableNode.getKey());\n\n              if (!tableElement) {\n                throw new Error('TableCellResizer: Table element not found.');\n              }\n\n              targetRef.current = target as HTMLElement;\n              tableRectRef.current = tableElement.getBoundingClientRect();\n              updateActiveCell(cell);\n            });\n          } else if (cell == null) {\n            resetState();\n          }\n        }\n      }, 0);\n    };\n\n    document.addEventListener('mousemove', onMouseMove);\n\n    return () => {\n      document.removeEventListener('mousemove', onMouseMove);\n    };\n  }, [activeCell, draggingDirection, editor, resetState]);\n\n  const isHeightChanging = (direction: MouseDraggingDirection) => {\n    if (direction === 'bottom') return true;\n    return false;\n  };\n\n  const updateRowHeight = useCallback(\n    (newHeight: number) => {\n      if (!activeCell) {\n        throw new Error('TableCellResizer: Expected active cell.');\n      }\n\n      editor.update(() => {\n        const tableCellNode = $getNearestNodeFromDOMNode(activeCell.elem);\n        if (!$isTableCellNode(tableCellNode)) {\n          throw new Error('TableCellResizer: Table cell node not found.');\n        }\n\n        const tableNode = $getTableNodeFromLexicalNodeOrThrow(tableCellNode);\n\n        const tableRowIndex = $getTableRowIndexFromTableCellNode(tableCellNode);\n\n        const tableRows = tableNode.getChildren();\n\n        if (tableRowIndex >= tableRows.length || tableRowIndex < 0) {\n          throw new Error('Expected table cell to be inside of table row.');\n        }\n\n        const tableRow = tableRows[tableRowIndex];\n\n        if (!$isTableRowNode(tableRow)) {\n          throw new Error('Expected table row');\n        }\n\n        tableRow.setHeight(newHeight);\n      });\n    },\n    [activeCell, editor]\n  );\n\n  const updateColumnWidth = useCallback(\n    (newWidth: number) => {\n      if (!activeCell) {\n        throw new Error('TableCellResizer: Expected active cell.');\n      }\n      editor.update(() => {\n        const tableCellNode = $getNearestNodeFromDOMNode(activeCell.elem);\n        if (!$isTableCellNode(tableCellNode)) {\n          throw new Error('TableCellResizer: Table cell node not found.');\n        }\n\n        const tableNode = $getTableNodeFromLexicalNodeOrThrow(tableCellNode);\n\n        const tableColumnIndex =\n          $getTableColumnIndexFromTableCellNode(tableCellNode);\n\n        const tableRows = tableNode.getChildren();\n\n        for (let r = 0; r < tableRows.length; r++) {\n          const tableRow = tableRows[r];\n\n          if (!$isTableRowNode(tableRow)) {\n            throw new Error('Expected table row');\n          }\n\n          const tableCells = tableRow.getChildren();\n\n          if (tableColumnIndex >= tableCells.length || tableColumnIndex < 0) {\n            throw new Error('Expected table cell to be inside of table row.');\n          }\n\n          const tableCell = tableCells[tableColumnIndex];\n\n          if (!$isTableCellNode(tableCell)) {\n            throw new Error('Expected table cell');\n          }\n\n          tableCell.setWidth(newWidth);\n        }\n      });\n    },\n    [activeCell, editor]\n  );\n\n  const toggleResize = useCallback(\n    (direction) => (event) => {\n      event.preventDefault();\n      event.stopPropagation();\n\n      if (!activeCell) {\n        throw new Error('TableCellResizer: Expected active cell.');\n      }\n\n      if (draggingDirection === direction && mouseStartPosRef.current) {\n        const { x, y } = mouseStartPosRef.current;\n\n        if (!activeCell) {\n          return;\n        }\n\n        const { height, width } = activeCell.elem.getBoundingClientRect();\n\n        if (isHeightChanging(direction)) {\n          const heightChange = Math.abs(event.clientY - y);\n\n          const isShrinking = direction === 'bottom' && y > event.clientY;\n\n          updateRowHeight(\n            Math.max(\n              isShrinking ? height - heightChange : heightChange + height,\n              MIN_ROW_HEIGHT\n            )\n          );\n        } else {\n          const widthChange = Math.abs(event.clientX - x);\n\n          const isShrinking = direction === 'right' && x > event.clientX;\n\n          updateColumnWidth(\n            Math.max(\n              isShrinking ? width - widthChange : widthChange + width,\n              MIN_COLUMN_WIDTH\n            )\n          );\n        }\n\n        resetState();\n      } else {\n        mouseStartPosRef.current = {\n          x: event.clientX,\n          y: event.clientY,\n        };\n        updateMouseCurrentPos(mouseStartPosRef.current);\n        updateDraggingDirection(direction);\n      }\n    },\n    [\n      activeCell,\n      draggingDirection,\n      resetState,\n      updateColumnWidth,\n      updateRowHeight,\n    ]\n  );\n\n  const getResizers = useCallback(() => {\n    if (activeCell) {\n      const { height, width, top, left } =\n        activeCell.elem.getBoundingClientRect();\n\n      const styles = {\n        bottom: {\n          backgroundColor: 'none',\n          cursor: 'row-resize',\n          height: '10px',\n          left: `${window.pageXOffset + left}px`,\n          top: `${window.pageYOffset + top + height}px`,\n          width: `${width}px`,\n        },\n        right: {\n          backgroundColor: 'none',\n          cursor: 'col-resize',\n          height: `${height}px`,\n          left: `${window.pageXOffset + left + width}px`,\n          top: `${window.pageYOffset + top}px`,\n          width: '10px',\n        },\n      };\n\n      const tableRect = tableRectRef.current;\n\n      if (draggingDirection && mouseCurrentPos && tableRect) {\n        if (isHeightChanging(draggingDirection)) {\n          styles[draggingDirection].left = `${\n            window.pageXOffset + tableRect.left\n          }px`;\n          styles[draggingDirection].top = `${\n            window.pageYOffset + mouseCurrentPos.y\n          }px`;\n          styles[draggingDirection].height = '3px';\n          styles[draggingDirection].width = `${tableRect.width}px`;\n        } else {\n          styles[draggingDirection].top = `${\n            window.pageYOffset + tableRect.top\n          }px`;\n          styles[draggingDirection].left = `${\n            window.pageXOffset + mouseCurrentPos.x\n          }px`;\n          styles[draggingDirection].width = '3px';\n          styles[draggingDirection].height = `${tableRect.height}px`;\n        }\n\n        styles[draggingDirection].backgroundColor = '#adf';\n      }\n\n      return styles;\n    }\n\n    return {\n      bottom: null,\n      left: null,\n      right: null,\n      top: null,\n    };\n  }, [activeCell, draggingDirection, mouseCurrentPos]);\n\n  const resizerStyles = getResizers();\n\n  return (\n    <div ref={resizerRef}>\n      {activeCell != null && !isSelectingGrid && (\n        <>\n          <div\n            className=\"TableCellResizer__resizer TableCellResizer__ui\"\n            style={resizerStyles.right}\n            onMouseDown={toggleResize('right')}\n            onMouseUp={toggleResize('right')}\n          />\n          <div\n            className=\"TableCellResizer__resizer TableCellResizer__ui\"\n            style={resizerStyles.bottom}\n            onMouseDown={toggleResize('bottom')}\n            onMouseUp={toggleResize('bottom')}\n          />\n        </>\n      )}\n    </div>\n  );\n}\n\nexport default function TableCellResizerPlugin(): ReactPortal {\n  const [editor] = useLexicalComposerContext();\n\n  return useMemo(\n    () => createPortal(<TableCellResizer editor={editor} />, document.body),\n    [editor]\n  );\n}\n","/**\n * Copyright (c) Meta Platforms, Inc. and affiliates.\n *\n * This source code is licensed under the MIT license found in the\n * LICENSE file in the root directory of this source tree.\n *\n */\n\nimport { useLexicalComposerContext } from '@lexical/react/LexicalComposerContext';\nimport {\n  $createHorizontalRuleNode,\n  INSERT_HORIZONTAL_RULE_COMMAND,\n} from '@lexical/react/LexicalHorizontalRuleNode';\nimport {\n  $getSelection,\n  $isRangeSelection,\n  COMMAND_PRIORITY_EDITOR,\n} from 'lexical';\nimport { useEffect } from 'react';\n\nexport default function HorizontalRulePlugin(): null {\n  const [editor] = useLexicalComposerContext();\n\n  useEffect(() => {\n    return editor.registerCommand(\n      INSERT_HORIZONTAL_RULE_COMMAND,\n      (type) => {\n        const selection = $getSelection();\n\n        if (!$isRangeSelection(selection)) {\n          return false;\n        }\n\n        const focusNode = selection.focus.getNode();\n\n        if (focusNode !== null) {\n          const horizontalRuleNode = $createHorizontalRuleNode();\n          selection.insertParagraph();\n          selection.focus\n            .getNode()\n            .getTopLevelElementOrThrow()\n            .insertBefore(horizontalRuleNode);\n        }\n\n        return true;\n      },\n      COMMAND_PRIORITY_EDITOR\n    );\n  }, [editor]);\n\n  return null;\n}\n","import React, { useState, useCallback, useContext } from 'react';\nimport { $getRoot, LexicalEditor, RangeSelection } from 'lexical';\nimport DropDown from '../../../ui/DropDown';\nimport Button from '../../../ui/Button';\nimport TextInput from '../../../ui/TextInput';\nimport FileInput from '../../../ui/FileInput';\nimport type { InsertImagePayload } from '../../ImagesPlugin';\nimport ImagesPlugin, { INSERT_IMAGE_COMMAND } from '../../ImagesPlugin';\nimport { INSERT_TABLE_COMMAND } from '@lexical/table';\nimport { INSERT_HORIZONTAL_RULE_COMMAND } from '@lexical/react/LexicalHorizontalRuleNode';\nimport EquationsPlugin, {\n  INSERT_EQUATION_COMMAND,\n} from '../../EquationsPlugin';\n// import ExcalidrawPlugin, {\n//   INSERT_EXCALIDRAW_COMMAND,\n// } from '../../ExcalidrawPlugin';\n// import PollPlugin, { INSERT_POLL_COMMAND } from '../../PollPlugin';\n// import TwitterPlugin, { INSERT_TWEET_COMMAND } from '../../TwitterPlugin';\nimport YouTubePlugin, { INSERT_YOUTUBE_COMMAND } from '../../YouTubePlugin';\nimport { $createStickyNode } from '../../../nodes/StickyNode';\nimport KatexEquationAlterer from '../../../ui/KatexEquationAlterer';\nimport { useLexicalComposerContext } from '@lexical/react/LexicalComposerContext';\nimport useModal from '../../../hooks/useModal';\nimport TableCellResizer from '../../TableCellResizer';\nimport { TablePlugin } from '@lexical/react/LexicalTablePlugin';\nimport TableCellActionMenuPlugin from '../../TableActionMenuPlugin';\nimport HorizontalRulePlugin from '../../HorizontalRulePlugin';\nimport EditorContext from '../../../context/EditorContext';\n\n// Taken from https://stackoverflow.com/a/9102270\nconst YOUTUBE_ID_PARSER =\n  /^.*(youtu\\.be\\/|v\\/|u\\/\\w\\/|embed\\/|watch\\?v=|&v=)([^#&?]*).*/;\n\nconst parseYouTubeVideoID = (url: string) => {\n  const urlMatches = url.match(YOUTUBE_ID_PARSER);\n\n  return urlMatches?.[2].length === 11 ? urlMatches[2] : null;\n};\n\n//#region Inserting different modules\nfunction InsertImageDialog({\n  activeEditor,\n  onClose,\n}: {\n  activeEditor: LexicalEditor;\n  onClose: () => void;\n}): JSX.Element {\n  const [mode, setMode] = useState<null | 'url' | 'file'>(null);\n\n  const onClick = (payload: InsertImagePayload) => {\n    activeEditor.dispatchCommand(INSERT_IMAGE_COMMAND, payload);\n    onClose();\n  };\n\n  return (\n    <>\n      {!mode && (\n        <div className=\"ToolbarPlugin__dialogButtonsList\">\n          <Button\n            data-test-id=\"image-modal-option-sample\"\n            onClick={() =>\n              onClick({\n                altText: 'Yellow flower in tilt shift lens',\n                src: null, //yellowFlowerImage,\n              })\n            }\n          >\n            Sample\n          </Button>\n          <Button\n            data-test-id=\"image-modal-option-url\"\n            onClick={() => setMode('url')}\n          >\n            URL\n          </Button>\n          <Button\n            data-test-id=\"image-modal-option-file\"\n            onClick={() => setMode('file')}\n          >\n            File\n          </Button>\n        </div>\n      )}\n      {mode === 'url' && <InsertImageUriDialogBody onClick={onClick} />}\n      {mode === 'file' && <InsertImageUploadedDialogBody onClick={onClick} />}\n    </>\n  );\n}\n\nfunction InsertTableDialog({\n  activeEditor,\n  onClose,\n}: {\n  activeEditor: LexicalEditor;\n  onClose: () => void;\n}): JSX.Element {\n  const [rows, setRows] = useState('5');\n  const [columns, setColumns] = useState('5');\n\n  const onClick = () => {\n    activeEditor.dispatchCommand(INSERT_TABLE_COMMAND, { columns, rows });\n    onClose();\n  };\n\n  return (\n    <>\n      <TextInput label=\"No of rows\" onChange={setRows} value={rows} />\n      <TextInput label=\"No of columns\" onChange={setColumns} value={columns} />\n      <div\n        className=\"ToolbarPlugin__dialogActions\"\n        data-test-id=\"table-model-confirm-insert\"\n      >\n        <Button onClick={onClick}>Confirm</Button>\n      </div>\n    </>\n  );\n}\n\n// function InsertPollDialog({\n//   activeEditor,\n//   onClose,\n// }: {\n//   activeEditor: LexicalEditor;\n//   onClose: () => void;\n// }): JSX.Element {\n//   const [question, setQuestion] = useState('');\n\n//   const onClick = () => {\n//     activeEditor.dispatchCommand(INSERT_POLL_COMMAND, question);\n//     onClose();\n//   };\n\n//   return (\n//     <>\n//       <TextInput label=\"Question\" onChange={setQuestion} value={question} />\n//       <div className=\"ToolbarPlugin__dialogActions\">\n//         <Button disabled={question.trim() === ''} onClick={onClick}>\n//           Confirm\n//         </Button>\n//       </div>\n//     </>\n//   );\n// }\n\nconst VALID_TWITTER_URL = /twitter.com\\/[0-9a-zA-Z]{1,20}\\/status\\/([0-9]*)/g;\n\n// function InsertTweetDialog({\n//   activeEditor,\n//   onClose,\n// }: {\n//   activeEditor: LexicalEditor;\n//   onClose: () => void;\n// }): JSX.Element {\n//   const [text, setText] = useState('');\n\n//   const onClick = () => {\n//     const tweetID = text.split('status/')?.[1]?.split('?')?.[0];\n//     activeEditor.dispatchCommand(INSERT_TWEET_COMMAND, tweetID);\n//     onClose();\n//   };\n\n//   const isDisabled = text === '' || !text.match(VALID_TWITTER_URL);\n\n//   return (\n//     <>\n//       <TextInput\n//         label=\"Tweet URL\"\n//         placeholder=\"i.e. https://twitter.com/jack/status/20\"\n//         onChange={setText}\n//         value={text}\n//       />\n//       <div className=\"ToolbarPlugin__dialogActions\">\n//         <Button disabled={isDisabled} onClick={onClick}>\n//           Confirm\n//         </Button>\n//       </div>\n//     </>\n//   );\n// }\n\nfunction InsertImageUriDialogBody({\n  onClick,\n}: {\n  onClick: (payload: InsertImagePayload) => void;\n}) {\n  const [src, setSrc] = useState('');\n  const [altText, setAltText] = useState('');\n\n  const isDisabled = src === '';\n\n  return (\n    <>\n      <TextInput\n        label=\"Image URL\"\n        placeholder=\"i.e. https://source.unsplash.com/random\"\n        onChange={setSrc}\n        value={src}\n        data-test-id=\"image-modal-url-input\"\n      />\n      <TextInput\n        label=\"Alt Text\"\n        placeholder=\"Random unsplash image\"\n        onChange={setAltText}\n        value={altText}\n        data-test-id=\"image-modal-alt-text-input\"\n      />\n      <div className=\"ToolbarPlugin__dialogActions\">\n        <Button\n          data-test-id=\"image-modal-confirm-btn\"\n          disabled={isDisabled}\n          onClick={() => onClick({ altText, src })}\n        >\n          Confirm\n        </Button>\n      </div>\n    </>\n  );\n}\n\nfunction InsertImageUploadedDialogBody({\n  onClick,\n}: {\n  onClick: (payload: InsertImagePayload) => void;\n}) {\n  const [src, setSrc] = useState('');\n  const [altText, setAltText] = useState('');\n\n  const isDisabled = src === '';\n\n  const loadImage = (files: FileList) => {\n    const reader = new FileReader();\n    reader.onload = function () {\n      if (typeof reader.result === 'string') {\n        setSrc(reader.result);\n      }\n      return '';\n    };\n    reader.readAsDataURL(files[0]);\n  };\n\n  return (\n    <>\n      <FileInput\n        label=\"Image Upload\"\n        onChange={loadImage}\n        accept=\"image/*\"\n        data-test-id=\"image-modal-file-upload\"\n      />\n      <TextInput\n        label=\"Alt Text\"\n        placeholder=\"Descriptive alternative text\"\n        onChange={setAltText}\n        value={altText}\n        data-test-id=\"image-modal-alt-text-input\"\n      />\n      <div className=\"ToolbarPlugin__dialogActions\">\n        <Button\n          data-test-id=\"image-modal-file-upload-btn\"\n          disabled={isDisabled}\n          onClick={() => onClick({ altText, src })}\n        >\n          Confirm\n        </Button>\n      </div>\n    </>\n  );\n}\n\nfunction InsertYouTubeDialog({\n  activeEditor,\n  onClose,\n}: {\n  activeEditor: LexicalEditor;\n  onClose: () => void;\n}): JSX.Element {\n  const [text, setText] = useState('');\n\n  const onClick = () => {\n    const videoID = parseYouTubeVideoID(text);\n    if (videoID) {\n      activeEditor.dispatchCommand(INSERT_YOUTUBE_COMMAND, videoID);\n    }\n    onClose();\n  };\n\n  const isDisabled = text === '' || !parseYouTubeVideoID(text);\n\n  return (\n    <>\n      <TextInput\n        data-test-id=\"youtube-embed-modal-url\"\n        label=\"YouTube URL\"\n        placeholder=\"i.e. https://www.youtube.com/watch?v=jNQXAC9IVRw\"\n        onChange={setText}\n        value={text}\n      />\n      <div className=\"ToolbarPlugin__dialogActions\">\n        <Button\n          data-test-id=\"youtube-embed-modal-submit-btn\"\n          disabled={isDisabled}\n          onClick={onClick}\n        >\n          Confirm\n        </Button>\n      </div>\n    </>\n  );\n}\n\nfunction InsertEquationDialog({\n  activeEditor,\n  onClose,\n}: {\n  activeEditor: LexicalEditor;\n  onClose: () => void;\n}): JSX.Element {\n  const onEquationConfirm = useCallback(\n    (equation: string, inline: boolean) => {\n      activeEditor.dispatchCommand(INSERT_EQUATION_COMMAND, {\n        equation,\n        inline,\n      });\n      onClose();\n    },\n    [activeEditor, onClose]\n  );\n\n  return <KatexEquationAlterer onConfirm={onEquationConfirm} />;\n}\n\n//#endregion Inserting different modules\n\nexport interface IInsertDropdownProps {\n  enableTable?: boolean;\n  enableYoutube?: boolean;\n  enableTwitter?: boolean;\n  enablePoll?: boolean;\n  enableImage?: boolean;\n  enableEquations?: boolean;\n  enableExcalidraw?: boolean;\n  enableHorizontalRule?: boolean;\n  enableStickyNote?: boolean;\n}\n\nconst InsertDropdown: React.FC<IInsertDropdownProps> = ({\n  enableTable = true,\n  enableImage = true,\n  enableYoutube = false,\n  enableTwitter = false,\n  enablePoll = false,\n  enableEquations = false,\n  enableExcalidraw = false,\n  enableHorizontalRule = false,\n  enableStickyNote = false,\n}: IInsertDropdownProps) => {\n  const { initialEditor, activeEditor } = useContext(EditorContext);\n  const [modal, showModal] = useModal();\n\n  return (\n    <div>\n      {enableTable && (\n        <>\n          <TablePlugin />\n          <TableCellActionMenuPlugin />\n          <TableCellResizer />\n        </>\n      )}\n      {enableYoutube && <YouTubePlugin />}\n      {/* {enableTwitter && <TwitterPlugin />} */}\n      {/* {enablePoll && <PollPlugin />} */}\n      {enableImage && <ImagesPlugin />}\n      {enableEquations && <EquationsPlugin />}\n      {/* {enableExcalidraw && <ExcalidrawPlugin />} */}\n      {enableHorizontalRule && <HorizontalRulePlugin />}\n\n      <DropDown\n        buttonClassName=\"toolbar-item spaced\"\n        buttonLabel=\"Insert\"\n        buttonAriaLabel=\"Insert specialized editor node\"\n        buttonIconClassName=\"icon plus\"\n      >\n        {enableHorizontalRule && (\n          <button\n            onClick={() => {\n              activeEditor.dispatchCommand(\n                INSERT_HORIZONTAL_RULE_COMMAND,\n                undefined\n              );\n            }}\n            className=\"item\"\n            type=\"button\"\n          >\n            <i className=\"icon horizontal-rule\" />\n            <span className=\"text\">Horizontal Rule</span>\n          </button>\n        )}\n        {enableImage && (\n          <button\n            onClick={() => {\n              showModal('Insert Image', (onClose) => (\n                <InsertImageDialog\n                  activeEditor={activeEditor}\n                  onClose={onClose}\n                />\n              ));\n            }}\n            className=\"item\"\n            type=\"button\"\n          >\n            <i className=\"icon image\" />\n            <span className=\"text\">Image</span>\n          </button>\n        )}\n        {/* {enableExcalidraw && (\n          <button\n            onClick={() => {\n              activeEditor.dispatchCommand(\n                INSERT_EXCALIDRAW_COMMAND,\n                undefined\n              );\n            }}\n            className=\"item\"\n            type=\"button\"\n          >\n            <i className=\"icon diagram-2\" />\n            <span className=\"text\">Excalidraw</span>\n          </button>\n        )} */}\n        {enableTable && (\n          <div>\n            <button\n              onClick={() => {\n                showModal('Insert Table', (onClose) => (\n                  <InsertTableDialog\n                    activeEditor={activeEditor}\n                    onClose={onClose}\n                  />\n                ));\n              }}\n              className=\"item\"\n              type=\"button\"\n            >\n              <i className=\"icon table\" />\n              <span className=\"text\">Table</span>\n            </button>\n          </div>\n        )}\n        {/* {enablePoll && (\n          <button\n            onClick={() => {\n              showModal('Insert Poll', (onClose) => (\n                <InsertPollDialog\n                  activeEditor={activeEditor}\n                  onClose={onClose}\n                />\n              ));\n            }}\n            className=\"item\"\n            type=\"button\"\n          >\n            <i className=\"icon poll\" />\n            <span className=\"text\">Poll</span>\n          </button>\n        )} */}\n        {/* {enableTwitter && (\n          <button\n            onClick={() => {\n              showModal('Insert Tweet', (onClose) => (\n                <InsertTweetDialog\n                  activeEditor={activeEditor}\n                  onClose={onClose}\n                />\n              ));\n            }}\n            className=\"item\"\n            type=\"button\"\n          >\n            <i className=\"icon tweet\" />\n            <span className=\"text\">Tweet</span>\n          </button>\n        )} */}\n        {enableYoutube && (\n          <button\n            onClick={() => {\n              showModal('Insert YouTube Video', (onClose) => (\n                <InsertYouTubeDialog\n                  activeEditor={activeEditor}\n                  onClose={onClose}\n                />\n              ));\n            }}\n            className=\"item\"\n            type=\"button\"\n          >\n            <i className=\"icon youtube\" />\n            <span className=\"text\">YouTube Video</span>\n          </button>\n        )}\n        {enableEquations && (\n          <button\n            onClick={() => {\n              showModal('Insert Equation', (onClose) => (\n                <InsertEquationDialog\n                  activeEditor={activeEditor}\n                  onClose={onClose}\n                />\n              ));\n            }}\n            className=\"item\"\n            type=\"button\"\n          >\n            <i className=\"icon equation\" />\n            <span className=\"text\">Equation</span>\n          </button>\n        )}\n        {enableStickyNote && (\n          <button\n            onClick={() => {\n              initialEditor.update(() => {\n                const root = $getRoot();\n                const stickyNode = $createStickyNode(0, 0);\n                root.append(stickyNode);\n              });\n            }}\n            className=\"item\"\n            type=\"button\"\n          >\n            <i className=\"icon sticky\" />\n            <span className=\"text\">Sticky Note</span>\n          </button>\n        )}\n      </DropDown>\n      {modal}\n    </div>\n  );\n};\n\nexport default InsertDropdown;\n","/**\n * Copyright (c) Meta Platforms, Inc. and affiliates.\n *\n * This source code is licensed under the MIT license found in the\n * LICENSE file in the root directory of this source tree.\n *\n * @flow strict\n */\n\nimport { CAN_USE_DOM } from './canUseDOM';\n\nconst documentMode =\n  // @ts-ignore\n  CAN_USE_DOM && 'documentMode' in document ? document.documentMode : null;\n\nexport const IS_APPLE: boolean =\n  CAN_USE_DOM && /Mac|iPod|iPhone|iPad/.test(navigator.platform);\n\nexport const IS_FIREFOX: boolean =\n  CAN_USE_DOM && /^(?!.*Seamonkey)(?=.*Firefox).*/i.test(navigator.userAgent);\n\nexport const CAN_USE_BEFORE_INPUT: boolean =\n  CAN_USE_DOM && 'InputEvent' in window && !documentMode\n    ? 'getTargetRanges' in new window.InputEvent('input')\n    : false;\n\nexport const IS_SAFARI: boolean =\n  CAN_USE_DOM && /Version\\/[\\d\\.]+.*Safari/.test(navigator.userAgent);\n\nexport const IS_IOS: boolean =\n  CAN_USE_DOM &&\n  /iPad|iPhone|iPod/.test(navigator.userAgent) &&\n  !(window as any).MSStream;\n\n// Keep these in case we need to use them in the future.\n// export const IS_WINDOWS: boolean = CAN_USE_DOM && /Win/.test(navigator.platform);\n// export const IS_CHROME: boolean = CAN_USE_DOM && /^(?=.*Chrome).*/i.test(navigator.userAgent);\n// export const canUseTextInputEvent: boolean = CAN_USE_DOM && 'TextEvent' in window && !documentMode;\n","import * as React from 'react';\nimport { useContext } from 'react';\nimport ToolbarContext from '../../../context/ToolbarContext';\nimport { UNDO_COMMAND } from 'lexical';\nimport EditorContext from '../../../context/EditorContext';\nimport { IS_APPLE } from '../../../shared/src/environment';\n\nconst UndoButton = () => {\n  const { canUndo } = useContext(ToolbarContext);\n  const { activeEditor } = useContext(EditorContext);\n  return (\n    <button\n      disabled={!canUndo}\n      onClick={() => {\n        activeEditor.dispatchCommand(UNDO_COMMAND, undefined);\n      }}\n      title={IS_APPLE ? 'Undo (⌘Z)' : 'Undo (Ctrl+Z)'}\n      className=\"toolbar-item spaced\"\n      aria-label=\"Undo\"\n      type=\"button\"\n    >\n      <i className=\"format undo\" />\n    </button>\n  );\n};\n\nexport default UndoButton;\n","import * as React from 'react';\nimport { useContext } from 'react';\nimport ToolbarContext from '../../../context/ToolbarContext';\nimport { REDO_COMMAND } from 'lexical';\nimport EditorContext from '../../../context/EditorContext';\nimport { IS_APPLE } from '../../../shared/src/environment';\n\nconst RedoButton = () => {\n  const { canRedo } = useContext(ToolbarContext);\n  const { activeEditor } = useContext(EditorContext);\n  return (\n    <button\n      disabled={!canRedo}\n      onClick={() => {\n        activeEditor.dispatchCommand(REDO_COMMAND, undefined);\n      }}\n      title={IS_APPLE ? 'Redo (⌘Y)' : 'Undo (Ctrl+Y)'}\n      className=\"toolbar-item\"\n      aria-label=\"Redo\"\n      type=\"button\"\n    >\n      <i className=\"format redo\" />\n    </button>\n  );\n};\n\nexport default RedoButton;\n","import React from 'react';\n\nconst Select = ({\n  onChange,\n  className,\n  options,\n  value,\n}: {\n  className: string;\n  onChange: (event: { target: { value: string } }) => void;\n  options: [string, string][];\n  value: string;\n}): JSX.Element => {\n  return (\n    <select className={className} onChange={onChange} value={value}>\n      {options.map(([option, text]) => (\n        <option key={option} value={option}>\n          {text}\n        </option>\n      ))}\n    </select>\n  );\n};\n\nexport default Select;\n","import { $isCodeNode } from '@lexical/code';\nimport { $getNodeByKey } from 'lexical';\nimport React, { useCallback, useContext } from 'react';\nimport EditorContext from '../../../context/EditorContext';\nimport Select from '../../../ui/Select';\nimport ToolbarContext from '../../../context/ToolbarContext';\n\nconst CODE_LANGUAGE_OPTIONS: [string, string][] = [\n  ['', '- Select language -'],\n  ['c', 'C'],\n  ['clike', 'C-like'],\n  ['css', 'CSS'],\n  ['html', 'HTML'],\n  ['js', 'JavaScript'],\n  ['markdown', 'Markdown'],\n  ['objc', 'Objective-C'],\n  ['plain', 'Plain Text'],\n  ['py', 'Python'],\n  ['rust', 'Rust'],\n  ['sql', 'SQL'],\n  ['swift', 'Swift'],\n  ['xml', 'XML'],\n];\n\nconst CodeLanguageDropdown = () => {\n  const { activeEditor } = useContext(EditorContext);\n  const { selectedElementKey, codeLanguage } = useContext(ToolbarContext);\n  const onCodeLanguageSelect = useCallback(\n    (e) => {\n      activeEditor.update(() => {\n        if (selectedElementKey !== null) {\n          const node = $getNodeByKey(selectedElementKey);\n          if ($isCodeNode(node)) {\n            console.log(e.target.value);\n            node.setLanguage(e.target.value);\n          }\n        }\n      });\n    },\n    [activeEditor, selectedElementKey]\n  );\n\n  return (\n    <>\n      <Select\n        className=\"toolbar-item code-language\"\n        onChange={onCodeLanguageSelect}\n        options={CODE_LANGUAGE_OPTIONS}\n        value={codeLanguage}\n      />\n      <i className=\"chevron-down inside\" />\n    </>\n  );\n};\n\nexport default CodeLanguageDropdown;\n","import { $createCodeNode } from '@lexical/code';\nimport {\n  INSERT_CHECK_LIST_COMMAND,\n  INSERT_ORDERED_LIST_COMMAND,\n  INSERT_UNORDERED_LIST_COMMAND,\n  REMOVE_LIST_COMMAND,\n} from '@lexical/list';\nimport { $createHeadingNode, $createQuoteNode } from '@lexical/rich-text';\nimport { $wrapLeafNodesInElements } from '@lexical/selection';\nimport {\n  $createParagraphNode,\n  $getSelection,\n  $isRangeSelection,\n  LexicalEditor,\n} from 'lexical';\nimport React, { useContext } from 'react';\nimport EditorContext from '../../../context/EditorContext';\nimport DropDown from '../../../ui/DropDown';\nimport ToolbarContext from '../../../context/ToolbarContext';\n\nconst blockTypeToBlockName = {\n  bullet: 'Bulleted List',\n  check: 'Check List',\n  code: 'Code Block',\n  h1: 'Heading 1',\n  h2: 'Heading 2',\n  h3: 'Heading 3',\n  h4: 'Heading 4',\n  h5: 'Heading 5',\n  number: 'Numbered List',\n  paragraph: 'Normal',\n  quote: 'Quote',\n};\n\nconst BlockFormatDropdown = () => {\n  const { initialEditor } = useContext(EditorContext);\n  const { blockType } = useContext(ToolbarContext);\n  const formatParagraph = () => {\n    if (blockType !== 'paragraph') {\n      initialEditor.update(() => {\n        const selection = $getSelection();\n\n        if ($isRangeSelection(selection)) {\n          $wrapLeafNodesInElements(selection, () => $createParagraphNode());\n        }\n      });\n    }\n  };\n\n  const formatHeading = (headingSize) => {\n    if (blockType !== headingSize) {\n      initialEditor.update(() => {\n        const selection = $getSelection();\n\n        if ($isRangeSelection(selection)) {\n          $wrapLeafNodesInElements(selection, () =>\n            $createHeadingNode(headingSize)\n          );\n        }\n      });\n    }\n  };\n\n  const formatBulletList = () => {\n    if (blockType !== 'bullet') {\n      initialEditor.dispatchCommand(INSERT_UNORDERED_LIST_COMMAND, undefined);\n    } else {\n      initialEditor.dispatchCommand(REMOVE_LIST_COMMAND, undefined);\n    }\n  };\n\n  const formatCheckList = () => {\n    if (blockType !== 'check') {\n      initialEditor.dispatchCommand(INSERT_CHECK_LIST_COMMAND, undefined);\n    } else {\n      initialEditor.dispatchCommand(REMOVE_LIST_COMMAND, undefined);\n    }\n  };\n\n  const formatNumberedList = () => {\n    if (blockType !== 'number') {\n      initialEditor.dispatchCommand(INSERT_ORDERED_LIST_COMMAND, undefined);\n    } else {\n      initialEditor.dispatchCommand(REMOVE_LIST_COMMAND, undefined);\n    }\n  };\n\n  const formatQuote = () => {\n    if (blockType !== 'quote') {\n      initialEditor.update(() => {\n        const selection = $getSelection();\n\n        if ($isRangeSelection(selection)) {\n          $wrapLeafNodesInElements(selection, () => $createQuoteNode());\n        }\n      });\n    }\n  };\n\n  const formatCode = () => {\n    if (blockType !== 'code') {\n      initialEditor.update(() => {\n        const selection = $getSelection();\n\n        if ($isRangeSelection(selection)) {\n          if (selection.isCollapsed()) {\n            $wrapLeafNodesInElements(selection, () => $createCodeNode());\n          } else {\n            const textContent = selection.getTextContent();\n            const codeNode = $createCodeNode();\n            selection.removeText();\n            selection.insertNodes([codeNode]);\n            selection.insertRawText(textContent);\n          }\n        }\n      });\n    }\n  };\n\n  return (\n    <DropDown\n      buttonClassName=\"toolbar-item block-controls\"\n      buttonIconClassName={'icon block-type ' + blockType}\n      buttonLabel={blockTypeToBlockName[blockType]}\n      buttonAriaLabel=\"Formatting options for text style\"\n    >\n      <button className=\"item\" onClick={formatParagraph} type=\"button\">\n        <span className=\"icon paragraph\" />\n        <span className=\"text\">Normal</span>\n        {blockType === 'paragraph' && <span className=\"active\" />}\n      </button>\n      <button className=\"item\" onClick={() => formatHeading('h1')} type=\"button\">\n        <span className=\"icon h1\" />\n        <span className=\"text\">Heading 1</span>\n        {blockType === 'h1' && <span className=\"active\" />}\n      </button>\n      <button className=\"item\" onClick={() => formatHeading('h2')} type=\"button\">\n        <span className=\"icon h2\" />\n        <span className=\"text\">Heading 2</span>\n        {blockType === 'h2' && <span className=\"active\" />}\n      </button>\n      <button className=\"item\" onClick={() => formatHeading('h3')} type=\"button\">\n        <span className=\"icon h3\" />\n        <span className=\"text\">Heading 3</span>\n        {blockType === 'h3' && <span className=\"active\" />}\n      </button>\n      <button className=\"item\" onClick={formatBulletList} type=\"button\">\n        <span className=\"icon bullet-list\" />\n        <span className=\"text\">Bullet List</span>\n        {blockType === 'bullet' && <span className=\"active\" />}\n      </button>\n      <button className=\"item\" onClick={formatNumberedList} type=\"button\">\n        <span className=\"icon numbered-list\" />\n        <span className=\"text\">Numbered List</span>\n        {blockType === 'number' && <span className=\"active\" />}\n      </button>\n      <button className=\"item\" onClick={formatCheckList} type=\"button\">\n        <span className=\"icon check-list\" />\n        <span className=\"text\">Check List</span>\n        {blockType === 'check' && <span className=\"active\" />}\n      </button>\n      <button className=\"item\" onClick={formatQuote} type=\"button\">\n        <span className=\"icon quote\" />\n        <span className=\"text\">Quote</span>\n        {blockType === 'quote' && <span className=\"active\" />}\n      </button>\n      <button className=\"item\" onClick={formatCode} type=\"button\">\n        <span className=\"icon code\" />\n        <span className=\"text\">Code Block</span>\n        {blockType === 'code' && <span className=\"active\" />}\n      </button>\n    </DropDown>\n  );\n};\n\nexport default BlockFormatDropdown;\n","import React from 'react';\n\nexport default function Divider(): JSX.Element {\n  return <div className=\"divider\" />;\n}\n","/**\n * Copyright (c) Meta Platforms, Inc. and affiliates.\n *\n * This source code is licensed under the MIT license found in the\n * LICENSE file in the root directory of this source tree.\n *\n */\n\nimport { $isCodeNode } from '@lexical/code';\nimport { $isLinkNode, TOGGLE_LINK_COMMAND } from '@lexical/link';\nimport { $isListNode, ListNode } from '@lexical/list';\nimport { $isHeadingNode } from '@lexical/rich-text';\nimport {\n  $getSelectionStyleValueForProperty,\n  $isParentElementRTL,\n  $patchStyleText,\n} from '@lexical/selection';\nimport { $getNearestNodeOfType, mergeRegister } from '@lexical/utils';\nimport {\n  $getSelection,\n  $isRangeSelection,\n  CAN_REDO_COMMAND,\n  CAN_UNDO_COMMAND,\n  COMMAND_PRIORITY_CRITICAL,\n  SELECTION_CHANGE_COMMAND,\n} from 'lexical';\nimport * as React from 'react';\nimport { useCallback, useContext, useEffect, useRef, useState } from 'react';\nimport useChild from 'use-child';\nimport { getSelectedNode } from '../../utils/node.util';\nimport EditorContext from '../../context/EditorContext';\nimport ToolbarContext from '../../context/ToolbarContext';\nimport AlignDropdown from './components/AlignDropdown';\nimport InsertDropdown from './components/InsertDropdown';\nimport './ToolbarPlugin.css';\nimport UndoButton from './components/UndoButton';\nimport RedoButton from './components/RedoButton';\nimport CodeLanguageDropdown from './components/CodeLanguageDropdown';\nimport BlockFormatDropdown from './components/BlockFormatDropdown';\nimport Divider from '../../ui/Divider';\n\nconst supportedBlockTypes = new Set([\n  'paragraph',\n  'quote',\n  'code',\n  'h1',\n  'h2',\n  'h3',\n  'bullet',\n  'number',\n  'check',\n]);\n\nconst CODE_LANGUAGE_MAP = {\n  javascript: 'js',\n  md: 'markdown',\n  plaintext: 'plain',\n  python: 'py',\n  text: 'plain',\n};\n\ninterface IToolbarProps {\n  children?: React.ReactElement | React.ReactElement[];\n  defaultFontSize?: string /** The default selected font size in the toolbar */;\n  defaultFontColor?: string /** The default selected font color in the toolbar */;\n  defaultBgColor?: string /** The default selected background color in the toolbar */;\n  defaultFontFamily?: string /** The default selected font family in the toolbar */;\n}\n\nconst ToolbarPlugin = ({\n  children,\n  defaultFontSize = '15px',\n  defaultFontColor = '#000',\n  defaultBgColor = '#fff',\n  defaultFontFamily = 'Arial',\n}: IToolbarProps) => {\n  const [insertExists, InsertComponent] = useChild(children, InsertDropdown);\n  const [alignExists, AlignComponent] = useChild(children, AlignDropdown);\n\n  const { initialEditor, activeEditor, setActiveEditor } =\n    useContext(EditorContext);\n  const [blockType, setBlockType] = useState('paragraph');\n  const [selectedElementKey, setSelectedElementKey] = useState(null);\n  const [fontSize, setFontSize] = useState<string>(defaultFontSize);\n  const [fontColor, setFontColor] = useState<string>(defaultFontColor);\n  const [bgColor, setBgColor] = useState<string>(defaultBgColor);\n  const [fontFamily, setFontFamily] = useState<string>(defaultFontFamily);\n  const [isLink, setIsLink] = useState(false);\n  const [isBold, setIsBold] = useState(false);\n  const [isItalic, setIsItalic] = useState(false);\n  const [isUnderline, setIsUnderline] = useState(false);\n  const [isStrikethrough, setIsStrikethrough] = useState(false);\n  const [isSubscript, setIsSubscript] = useState(false);\n  const [isSuperscript, setIsSuperscript] = useState(false);\n  const [isCode, setIsCode] = useState(false);\n  const [canUndo, setCanUndo] = useState(false);\n  const [canRedo, setCanRedo] = useState(false);\n  const [isRTL, setIsRTL] = useState(false);\n  const [codeLanguage, setCodeLanguage] = useState<string>('');\n\n  const updateToolbar = useCallback(() => {\n    const selection = $getSelection();\n    if ($isRangeSelection(selection)) {\n      const anchorNode = selection.anchor.getNode();\n      const element =\n        anchorNode.getKey() === 'root'\n          ? anchorNode\n          : anchorNode.getTopLevelElementOrThrow();\n      const elementKey = element.getKey();\n      const elementDOM = activeEditor.getElementByKey(elementKey);\n\n      // Update text format\n      setIsBold(selection.hasFormat('bold'));\n      setIsItalic(selection.hasFormat('italic'));\n      setIsUnderline(selection.hasFormat('underline'));\n      setIsStrikethrough(selection.hasFormat('strikethrough'));\n      setIsSubscript(selection.hasFormat('subscript'));\n      setIsSuperscript(selection.hasFormat('superscript'));\n      setIsCode(selection.hasFormat('code'));\n      setIsRTL($isParentElementRTL(selection));\n\n      // Update links\n      const node = getSelectedNode(selection);\n      const parent = node.getParent();\n      if ($isLinkNode(parent) || $isLinkNode(node)) {\n        setIsLink(true);\n      } else {\n        setIsLink(false);\n      }\n\n      if (elementDOM !== null) {\n        setSelectedElementKey(elementKey);\n        if ($isListNode(element)) {\n          const parentList = $getNearestNodeOfType<ListNode>(\n            anchorNode,\n            ListNode\n          );\n          const type = parentList\n            ? parentList.getListType()\n            : element.getListType();\n          setBlockType(type);\n        } else {\n          const type = $isHeadingNode(element)\n            ? element.getTag()\n            : element.getType();\n          setBlockType(type);\n          if ($isCodeNode(element)) {\n            const language = element.getLanguage();\n            setCodeLanguage(\n              language ? CODE_LANGUAGE_MAP[language] || language : ''\n            );\n            return;\n          }\n        }\n      }\n      // Hande buttons\n      setFontSize(\n        $getSelectionStyleValueForProperty(\n          selection,\n          'font-size',\n          defaultFontSize\n        )\n      );\n      setFontColor(\n        $getSelectionStyleValueForProperty(selection, 'color', defaultFontColor)\n      );\n      setBgColor(\n        $getSelectionStyleValueForProperty(\n          selection,\n          'background-color',\n          defaultBgColor\n        )\n      );\n\n      setFontFamily(\n        $getSelectionStyleValueForProperty(\n          selection,\n          'font-family',\n          defaultFontFamily\n        )\n      );\n    }\n  }, [activeEditor]);\n\n  useEffect(() => {\n    return initialEditor.registerCommand(\n      SELECTION_CHANGE_COMMAND,\n      (_payload, newEditor) => {\n        updateToolbar();\n        setActiveEditor(newEditor);\n        return false;\n      },\n      COMMAND_PRIORITY_CRITICAL\n    );\n  }, [initialEditor, updateToolbar]);\n\n  useEffect(() => {\n    return mergeRegister(\n      activeEditor.registerUpdateListener(({ editorState }) => {\n        editorState.read(() => {\n          updateToolbar();\n        });\n      }),\n      activeEditor.registerCommand<boolean>(\n        CAN_UNDO_COMMAND,\n        (payload) => {\n          setCanUndo(payload);\n          return false;\n        },\n        COMMAND_PRIORITY_CRITICAL\n      ),\n      activeEditor.registerCommand<boolean>(\n        CAN_REDO_COMMAND,\n        (payload) => {\n          setCanRedo(payload);\n          return false;\n        },\n        COMMAND_PRIORITY_CRITICAL\n      )\n    );\n  }, [activeEditor, updateToolbar]);\n\n  const applyStyleText = useCallback(\n    (styles: Record<string, string>) => {\n      activeEditor.update(() => {\n        const selection = $getSelection();\n        if ($isRangeSelection(selection)) {\n          $patchStyleText(selection, styles);\n        }\n      });\n    },\n    [activeEditor]\n  );\n\n  const insertLink = useCallback(() => {\n    if (!isLink) {\n      initialEditor.dispatchCommand(TOGGLE_LINK_COMMAND, 'https://');\n    } else {\n      initialEditor.dispatchCommand(TOGGLE_LINK_COMMAND, null);\n    }\n  }, [initialEditor, isLink]);\n\n  return (\n    <ToolbarContext.Provider\n      value={{\n        isRTL,\n        canUndo,\n        canRedo,\n        fontFamily,\n        fontSize,\n        fontColor,\n        bgColor,\n        isBold,\n        isItalic,\n        isUnderline,\n        isCode,\n        isLink,\n        applyStyleText,\n        insertLink,\n        isStrikethrough,\n        isSubscript,\n        isSuperscript,\n        selectedElementKey,\n        codeLanguage,\n        blockType,\n      }}\n    >\n      <div className=\"toolbar\">\n        <UndoButton />\n        <RedoButton />\n        <Divider />\n        {supportedBlockTypes.has(blockType) && activeEditor === initialEditor && (\n          <>\n            <BlockFormatDropdown />\n            <Divider />\n          </>\n        )}\n        {blockType === 'code' ? (\n          <>\n            <CodeLanguageDropdown />\n            <Divider />\n            {alignExists && AlignComponent}\n          </>\n        ) : (\n          <>{children}</>\n        )}\n      </div>\n    </ToolbarContext.Provider>\n  );\n};\n\nexport default ToolbarPlugin;\n","/**\n * Copyright (c) Facebook, Inc. and its affiliates.\n *\n * This source code is licensed under the MIT license found in the\n * LICENSE file in the root directory of this source tree.\n *\n */\n\nimport './ColorPicker.css';\n\nimport { useEffect, useMemo, useRef, useState } from 'react';\nimport * as React from 'react';\n\nimport DropDown from './DropDown';\n\ninterface ColorPickerProps {\n  buttonAriaLabel?: string;\n  buttonClassName: string;\n  buttonIconClassName?: string;\n  buttonLabel?: string;\n  color?: string;\n  children?: JSX.Element;\n  onChange?: (color: string) => void;\n  title?: string;\n}\n\nconst basicColors = [\n  '#d0021b',\n  '#f5a623',\n  '#f8e71c',\n  '#8b572a',\n  '#7ed321',\n  '#417505',\n  '#bd10e0',\n  '#9013fe',\n  '#4a90e2',\n  '#50e3c2',\n  '#b8e986',\n  '#000000',\n  '#4a4a4a',\n  '#9b9b9b',\n  '#ffffff',\n];\n\nconst WIDTH = 214;\nconst HEIGHT = 150;\n\nexport default function ColorPicker({\n  color,\n  children,\n  onChange,\n  ...rest\n}: Readonly<ColorPickerProps>): JSX.Element {\n  const [selfColor, setSelfColor] = useState(transformColor('hex', color));\n\n  const saturationPosition = useMemo(\n    () => ({\n      x: (selfColor.hsv.s / 100) * WIDTH,\n      y: ((100 - selfColor.hsv.v) / 100) * HEIGHT,\n    }),\n    [selfColor.hsv.s, selfColor.hsv.v]\n  );\n\n  const huePosition = useMemo(\n    () => ({\n      x: (selfColor.hsv.h / 360) * WIDTH,\n    }),\n    [selfColor.hsv]\n  );\n\n  const onMoveSaturation = ({ x, y }: Position) => {\n    const newHsv = {\n      ...selfColor.hsv,\n      s: (x / WIDTH) * 100,\n      v: 100 - (y / HEIGHT) * 100,\n    };\n    const newColor = transformColor('hsv', newHsv);\n    setSelfColor(newColor);\n  };\n\n  const onMoveHue = ({ x }: Position) => {\n    const newHsv = { ...selfColor.hsv, h: (x / WIDTH) * 360 };\n    const newColor = transformColor('hsv', newHsv);\n\n    setSelfColor(newColor);\n  };\n\n  useEffect(() => {\n    onChange(selfColor.hex);\n  }, [selfColor, onChange]);\n\n  useEffect(() => {\n    if (color === undefined) return;\n    setSelfColor(transformColor('hex', color));\n  }, [color]);\n\n  return (\n    <DropDown {...rest} stopCloseOnClickSelf={true}>\n      <div className=\"color-picker-wrapper\" style={{ width: WIDTH }}>\n        <div className=\"color-picker-basic-color\">\n          {basicColors.map((basicColor) => (\n            <button\n              className={basicColor === selfColor.hex ? ' active' : ''}\n              key={basicColor}\n              style={{ backgroundColor: basicColor }}\n              onClick={() => setSelfColor(transformColor('hex', basicColor))}\n              type=\"button\"\n            />\n          ))}\n        </div>\n        <MoveWrapper\n          className=\"color-picker-saturation\"\n          style={{ backgroundColor: `hsl(${selfColor.hsv.h}, 100%, 50%)` }}\n          onChange={onMoveSaturation}\n        >\n          <div\n            className=\"color-picker-saturation_cursor\"\n            style={{\n              backgroundColor: selfColor.hex,\n              left: saturationPosition.x,\n              top: saturationPosition.y,\n            }}\n          />\n        </MoveWrapper>\n        <MoveWrapper className=\"color-picker-hue\" onChange={onMoveHue}>\n          <div\n            className=\"color-picker-hue_cursor\"\n            style={{\n              backgroundColor: `hsl(${selfColor.hsv.h}, 100%, 50%)`,\n              left: huePosition.x,\n            }}\n          />\n        </MoveWrapper>\n        <div className=\"color-picker-info\">\n          <span>{selfColor.hex}</span>\n          <div\n            className=\"color-picker-color\"\n            style={{ backgroundColor: selfColor.hex }}\n          />\n        </div>\n      </div>\n      {children}\n    </DropDown>\n  );\n}\n\nexport interface Position {\n  x: number;\n  y: number;\n}\n\ninterface MoveWrapperProps {\n  className?: string;\n  style?: React.CSSProperties;\n  onChange: (position: Position) => void;\n  children: JSX.Element;\n}\n\nfunction MoveWrapper({\n  className,\n  style,\n  onChange,\n  children,\n}: MoveWrapperProps) {\n  const divRef = useRef<HTMLDivElement>(null);\n\n  const move = (e: React.MouseEvent | MouseEvent): void => {\n    if (divRef.current) {\n      const { current: div } = divRef;\n      const { width, height, left, top } = div.getBoundingClientRect();\n\n      const x = clamp(e.clientX - left, width, 0);\n      const y = clamp(e.clientY - top, height, 0);\n\n      onChange({ x, y });\n    }\n  };\n\n  const onMouseDown = (e: React.MouseEvent): void => {\n    if (e.button !== 0) return;\n\n    move(e);\n\n    const onMouseMove = (_e: MouseEvent): void => {\n      move(_e);\n    };\n\n    const onMouseUp = (_e: MouseEvent): void => {\n      document.removeEventListener('mousemove', onMouseMove, false);\n      document.removeEventListener('mouseup', onMouseUp, false);\n\n      move(_e);\n    };\n\n    document.addEventListener('mousemove', onMouseMove, false);\n    document.addEventListener('mouseup', onMouseUp, false);\n  };\n\n  return (\n    <div\n      ref={divRef}\n      className={className}\n      style={style}\n      onMouseDown={onMouseDown}\n    >\n      {children}\n    </div>\n  );\n}\n\nfunction clamp(value: number, max: number, min: number) {\n  return value > max ? max : value < min ? min : value;\n}\n\ninterface RGB {\n  b: number;\n  g: number;\n  r: number;\n}\ninterface HSV {\n  h: number;\n  s: number;\n  v: number;\n}\ninterface Color {\n  hex: string;\n  hsv: HSV;\n  rgb: RGB;\n}\n\nexport function toHex(value: string): string {\n  if (!value.startsWith('#')) {\n    const ctx = document.createElement('canvas').getContext('2d');\n\n    if (!ctx) {\n      throw new Error('2d context not supported or canvas already initialized');\n    }\n\n    ctx.fillStyle = value;\n\n    return ctx.fillStyle;\n  } else if (value.length === 4 || value.length === 5) {\n    value = value\n      .split('')\n      .map((v, i) => (i ? v + v : '#'))\n      .join('');\n\n    return value;\n  } else if (value.length === 7 || value.length === 9) {\n    return value;\n  }\n\n  return '#000000';\n}\n\nfunction hex2rgb(hex: string): RGB {\n  const rbgArr = hex\n    .replace(\n      /^#?([a-f\\d])([a-f\\d])([a-f\\d])$/i,\n      (m, r, g, b) => '#' + r + r + g + g + b + b\n    )\n    .substring(1)\n    .match(/.{2}/g)\n    .map((x) => parseInt(x, 16));\n\n  return {\n    b: rbgArr[2],\n    g: rbgArr[1],\n    r: rbgArr[0],\n  };\n}\n\nfunction rgb2hsv({ r, g, b }: RGB): HSV {\n  r /= 255;\n  g /= 255;\n  b /= 255;\n\n  const max = Math.max(r, g, b);\n  const d = max - Math.min(r, g, b);\n\n  const h = d\n    ? (max === r\n        ? (g - b) / d + (g < b ? 6 : 0)\n        : max === g\n        ? 2 + (b - r) / d\n        : 4 + (r - g) / d) * 60\n    : 0;\n  const s = max ? (d / max) * 100 : 0;\n  const v = max * 100;\n\n  return { h, s, v };\n}\n\nfunction hsv2rgb({ h, s, v }: HSV): RGB {\n  s /= 100;\n  v /= 100;\n\n  const i = ~~(h / 60);\n  const f = h / 60 - i;\n  const p = v * (1 - s);\n  const q = v * (1 - s * f);\n  const t = v * (1 - s * (1 - f));\n  const index = i % 6;\n\n  const r = Math.round([v, q, p, p, t, v][index] * 255);\n  const g = Math.round([t, v, v, q, p, p][index] * 255);\n  const b = Math.round([p, p, t, v, v, q][index] * 255);\n\n  return { b, g, r };\n}\n\nfunction rgb2hex({ b, g, r }: RGB): string {\n  return '#' + [r, g, b].map((x) => x.toString(16).padStart(2, '0')).join('');\n}\n\nfunction transformColor<M extends keyof Color, C extends Color[M]>(\n  format: M,\n  color: C\n): Color {\n  let hex: Color['hex'] = toHex('#121212');\n  let rgb: Color['rgb'] = hex2rgb(hex);\n  let hsv: Color['hsv'] = rgb2hsv(rgb);\n\n  if (format === 'hex') {\n    const value = color as Color['hex'];\n\n    hex = toHex(value);\n    rgb = hex2rgb(hex);\n    hsv = rgb2hsv(rgb);\n  } else if (format === 'rgb') {\n    const value = color as Color['rgb'];\n\n    rgb = value;\n    hex = rgb2hex(rgb);\n    hsv = rgb2hsv(rgb);\n  } else if (format === 'hsv') {\n    const value = color as Color['hsv'];\n\n    hsv = value;\n    rgb = hsv2rgb(hsv);\n    hex = rgb2hex(rgb);\n  }\n\n  return { hex, hsv, rgb };\n}\n","/**\n * Copyright (c) Meta Platforms, Inc. and affiliates.\n *\n * This source code is licensed under the MIT license found in the\n * LICENSE file in the root directory of this source tree.\n *\n */\n\nimport './LinkPreview.css';\n\nimport * as React from 'react';\nimport { Suspense } from 'react';\n\n// Cached responses or running request promises\nconst PREVIEW_CACHE = {};\n\nconst URL_MATCHER =\n  /((https?:\\/\\/(www\\.)?)|(www\\.))[-a-zA-Z0-9@:%._+~#=]{1,256}\\.[a-zA-Z0-9()]{1,6}\\b([-a-zA-Z0-9()@:%_+.~#?&//=]*)/;\n\nfunction useSuspenseRequest(url: string) {\n  let cached = PREVIEW_CACHE[url];\n\n  if (!url.match(URL_MATCHER)) {\n    return { preview: null };\n  }\n\n  if (!cached) {\n    cached = PREVIEW_CACHE[url] = fetch(\n      `/api/link-preview?url=${encodeURI(url)}`\n    )\n      .then((response) => response.json())\n      .then((preview) => {\n        PREVIEW_CACHE[url] = preview;\n        return preview;\n      })\n      .catch(() => {\n        PREVIEW_CACHE[url] = { preview: null };\n      });\n  }\n\n  if (cached instanceof Promise) {\n    throw cached;\n  }\n\n  return cached;\n}\n\nfunction LinkPreviewContent({\n  url,\n}: Readonly<{\n  url: string;\n}>): JSX.Element {\n  const { preview } = useSuspenseRequest(url);\n  if (preview === null) {\n    return null;\n  }\n  return (\n    <div className=\"LinkPreview__container\">\n      {preview.img && (\n        <div className=\"LinkPreview__imageWrapper\">\n          <img\n            src={preview.img}\n            alt={preview.title}\n            className=\"LinkPreview__image\"\n          />\n        </div>\n      )}\n      {preview.domain && (\n        <div className=\"LinkPreview__domain\">{preview.domain}</div>\n      )}\n      {preview.title && (\n        <div className=\"LinkPreview__title\">{preview.title}</div>\n      )}\n      {preview.description && (\n        <div className=\"LinkPreview__description\">{preview.description}</div>\n      )}\n    </div>\n  );\n}\n\nfunction Glimmer(props): JSX.Element {\n  return (\n    <div\n      className=\"LinkPreview__glimmer\"\n      {...props}\n      style={{\n        animationDelay: (props.index || 0) * 300,\n        ...(props.style || {}),\n      }}\n    />\n  );\n}\n\nexport default function LinkPreview({\n  url,\n}: Readonly<{\n  url: string;\n}>): JSX.Element {\n  return (\n    <Suspense\n      fallback={\n        <>\n          <Glimmer style={{ height: '80px' }} index={0} />\n          <Glimmer style={{ width: '60%' }} index={1} />\n          <Glimmer style={{ width: '80%' }} index={2} />\n        </>\n      }\n    >\n      <LinkPreviewContent url={url} />\n    </Suspense>\n  );\n}\n","import { $isLinkNode, TOGGLE_LINK_COMMAND } from '@lexical/link';\nimport { $isAtNodeEnd } from '@lexical/selection';\nimport { mergeRegister } from '@lexical/utils';\nimport {\n  $getSelection,\n  $isRangeSelection,\n  COMMAND_PRIORITY_LOW,\n  ElementNode,\n  LexicalEditor,\n  RangeSelection,\n  SELECTION_CHANGE_COMMAND,\n  TextNode,\n} from 'lexical';\nimport React from 'react';\nimport { useCallback, useEffect, useRef, useState } from 'react';\nimport LinkPreview from '../../../ui/LinkPreview';\nimport { getSelectedNode } from '../../../utils/node.util';\n\nfunction positionEditorElement(editor, rect) {\n  if (rect === null) {\n    editor.style.opacity = '0';\n    editor.style.top = '-1000px';\n    editor.style.left = '-1000px';\n  } else {\n    editor.style.opacity = '1';\n    editor.style.top = `${rect.top + rect.height + window.pageYOffset + 10}px`;\n    editor.style.left = `${\n      rect.left + window.pageXOffset - editor.offsetWidth / 2 + rect.width / 2\n    }px`;\n  }\n}\n\nfunction FloatingLinkEditor({\n  editor,\n}: {\n  editor: LexicalEditor;\n}): JSX.Element {\n  const editorRef = useRef<HTMLDivElement | null>(null);\n  const inputRef = useRef(null);\n  const [linkUrl, setLinkUrl] = useState('');\n  const [isEditMode, setEditMode] = useState(false);\n  const [lastSelection, setLastSelection] = useState(null);\n\n  const updateLinkEditor = useCallback(() => {\n    const selection = $getSelection();\n    if ($isRangeSelection(selection)) {\n      const node = getSelectedNode(selection);\n      const parent = node.getParent();\n      if ($isLinkNode(parent)) {\n        setLinkUrl(parent.getURL());\n      } else if ($isLinkNode(node)) {\n        setLinkUrl(node.getURL());\n      } else {\n        setLinkUrl('');\n      }\n    }\n    const editorElem = editorRef.current;\n    const nativeSelection = window.getSelection();\n    const activeElement = document.activeElement;\n\n    if (editorElem === null) {\n      return;\n    }\n\n    const rootElement = editor.getRootElement();\n    if (\n      selection !== null &&\n      !nativeSelection.isCollapsed &&\n      rootElement !== null &&\n      rootElement.contains(nativeSelection.anchorNode)\n    ) {\n      const domRange = nativeSelection.getRangeAt(0);\n      let rect;\n      if (nativeSelection.anchorNode === rootElement) {\n        let inner = rootElement;\n        while (inner.firstElementChild != null) {\n          inner = inner.firstElementChild as HTMLElement;\n        }\n        rect = inner.getBoundingClientRect();\n      } else {\n        rect = domRange.getBoundingClientRect();\n      }\n\n      positionEditorElement(editorElem, rect);\n      setLastSelection(selection);\n    } else if (!activeElement || activeElement.className !== 'link-input') {\n      positionEditorElement(editorElem, null);\n      setLastSelection(null);\n      setEditMode(false);\n      setLinkUrl('');\n    }\n\n    return true;\n  }, [editor]);\n\n  useEffect(() => {\n    const onResize = () => {\n      editor.getEditorState().read(() => {\n        updateLinkEditor();\n      });\n    };\n    window.addEventListener('resize', onResize);\n\n    return () => {\n      window.removeEventListener('resize', onResize);\n    };\n  }, [editor, updateLinkEditor]);\n\n  useEffect(() => {\n    return mergeRegister(\n      editor.registerUpdateListener(({ editorState }) => {\n        editorState.read(() => {\n          updateLinkEditor();\n        });\n      }),\n\n      editor.registerCommand(\n        SELECTION_CHANGE_COMMAND,\n        () => {\n          updateLinkEditor();\n          return true;\n        },\n        COMMAND_PRIORITY_LOW\n      )\n    );\n  }, [editor, updateLinkEditor]);\n\n  useEffect(() => {\n    editor.getEditorState().read(() => {\n      updateLinkEditor();\n    });\n  }, [editor, updateLinkEditor]);\n\n  useEffect(() => {\n    if (isEditMode && inputRef.current) {\n      inputRef.current.focus();\n    }\n  }, [isEditMode]);\n\n  return (\n    <div ref={editorRef} className=\"link-editor\">\n      {isEditMode ? (\n        <input\n          ref={inputRef}\n          className=\"link-input\"\n          value={linkUrl}\n          onChange={(event) => {\n            setLinkUrl(event.target.value);\n          }}\n          onKeyDown={(event) => {\n            if (event.key === 'Enter') {\n              event.preventDefault();\n              if (lastSelection !== null) {\n                if (linkUrl !== '') {\n                  editor.dispatchCommand(TOGGLE_LINK_COMMAND, linkUrl);\n                }\n                setEditMode(false);\n              }\n            } else if (event.key === 'Escape') {\n              event.preventDefault();\n              setEditMode(false);\n            }\n          }}\n        />\n      ) : (\n        <>\n          <div className=\"link-input\">\n            <a href={linkUrl} target=\"_blank\" rel=\"noopener noreferrer\">\n              {linkUrl}\n            </a>\n            <div\n              className=\"link-edit\"\n              role=\"button\"\n              tabIndex={0}\n              onMouseDown={(event) => event.preventDefault()}\n              onClick={() => {\n                setEditMode(true);\n              }}\n            />\n          </div>\n          <LinkPreview url={linkUrl} />\n        </>\n      )}\n    </div>\n  );\n}\n\nexport default FloatingLinkEditor;\n","import React, { useCallback, useContext } from 'react';\nimport Select from '../../../ui/Select';\nimport ToolbarContext from '../../../context/ToolbarContext';\nimport { FontOptions } from '../../../types';\n\nconst defaultFontFamilyOptions: FontOptions = [\n  ['Arial', 'Arial'],\n  ['Courier New', 'Courier New'],\n  ['Georgia', 'Georgia'],\n  ['Times New Roman', 'Times New Roman'],\n  ['Trebuchet MS', 'Trebuchet MS'],\n  ['Verdana', 'Verdana'],\n];\n\ninterface IFontFamilyDropdown {\n  fontOptions?: FontOptions;\n}\n\nconst FontFamilyDropdown = ({\n  fontOptions = defaultFontFamilyOptions,\n}: IFontFamilyDropdown) => {\n  const { fontFamily, applyStyleText } = useContext(ToolbarContext);\n\n  const onFontFamilySelect = useCallback(\n    (e) => {\n      applyStyleText({ 'font-family': e.target.value });\n    },\n    [applyStyleText]\n  );\n\n  return (\n    <>\n      <Select\n        className=\"toolbar-item font-family\"\n        onChange={onFontFamilySelect}\n        options={fontOptions}\n        value={fontFamily}\n      />\n      <i className=\"chevron-down inside\" />\n    </>\n  );\n};\n\nexport default FontFamilyDropdown;\n","import React, { useCallback, useContext } from 'react';\nimport Select from '../../../ui/Select';\nimport ToolbarContext from '../../../context/ToolbarContext';\nimport { FontOptions } from '../../../types';\n\nconst defaultFontSizeOptions: FontOptions = [\n  ['10px', '10px'],\n  ['11px', '11px'],\n  ['12px', '12px'],\n  ['13px', '13px'],\n  ['14px', '14px'],\n  ['15px', '15px'],\n  ['16px', '16px'],\n  ['17px', '17px'],\n  ['18px', '18px'],\n  ['19px', '19px'],\n  ['20px', '20px'],\n];\n\ninterface IFontSizeDropdown {\n  fontSizeOptions?: FontOptions;\n}\n\nconst FontSizeDropdown = ({\n  fontSizeOptions = defaultFontSizeOptions,\n}: IFontSizeDropdown) => {\n  const { fontSize, applyStyleText } = useContext(ToolbarContext);\n\n  const onFontSizeSelect = useCallback(\n    (e) => {\n      applyStyleText({ 'font-size': e.target.value });\n    },\n    [applyStyleText]\n  );\n\n  return (\n    <>\n      <Select\n        className=\"toolbar-item font-size\"\n        onChange={onFontSizeSelect}\n        options={fontSizeOptions}\n        value={fontSize}\n      />\n      <i className=\"chevron-down inside\" />\n    </>\n  );\n};\n\nexport default FontSizeDropdown;\n","import React, { useCallback, useContext } from 'react';\nimport ToolbarContext from '../../../context/ToolbarContext';\nimport ColorPicker from '../../../ui/ColorPicker';\n\nconst BackgroundColorPicker = () => {\n  const { bgColor, applyStyleText } = useContext(ToolbarContext);\n\n  const onBgColorSelect = useCallback(\n    (value: string) => {\n      applyStyleText({ 'background-color': value });\n    },\n    [applyStyleText]\n  );\n\n  return (\n    <ColorPicker\n      buttonClassName=\"toolbar-item color-picker\"\n      buttonAriaLabel=\"Formatting background color\"\n      buttonIconClassName=\"icon bg-color\"\n      color={bgColor}\n      onChange={onBgColorSelect}\n      title=\"bg color\"\n    />\n  );\n};\n\nexport default BackgroundColorPicker;\n","import { FORMAT_TEXT_COMMAND } from 'lexical';\nimport React from 'react';\nimport { useContext } from 'react';\nimport { IS_APPLE } from '../../../shared/src/environment';\nimport EditorContext from '../../../context/EditorContext';\nimport ToolbarContext from '../../../context/ToolbarContext';\n\nconst BoldButton = () => {\n  const { activeEditor } = useContext(EditorContext);\n  const { isBold } = useContext(ToolbarContext);\n\n  return (\n    <button\n      onClick={() => {\n        activeEditor.dispatchCommand(FORMAT_TEXT_COMMAND, 'bold');\n      }}\n      className={'toolbar-item spaced ' + (isBold ? 'active' : '')}\n      title={IS_APPLE ? 'Bold (⌘B)' : 'Bold (Ctrl+B)'}\n      aria-label={`Format text as bold. Shortcut: ${\n        IS_APPLE ? '⌘B' : 'Ctrl+B'\n      }`}\n      type=\"button\"\n    >\n      <i className=\"format bold\" />\n    </button>\n  );\n};\n\nexport default BoldButton;\n","import { FORMAT_TEXT_COMMAND } from 'lexical';\nimport React from 'react';\nimport { useContext } from 'react';\nimport EditorContext from '../../../context/EditorContext';\nimport ToolbarContext from '../../../context/ToolbarContext';\n\nconst CodeFormatButton = () => {\n  const { activeEditor } = useContext(EditorContext);\n  const { isCode } = useContext(ToolbarContext);\n\n  return (\n    <button\n      onClick={() => {\n        activeEditor.dispatchCommand(FORMAT_TEXT_COMMAND, 'code');\n      }}\n      className={'toolbar-item spaced ' + (isCode ? 'active' : '')}\n      title=\"Insert code block\"\n      aria-label=\"Insert code block\"\n      type=\"button\"\n    >\n      <i className=\"format code\" />\n    </button>\n  );\n};\n\nexport default CodeFormatButton;\n","/**\n * Copyright (c) Meta Platforms, Inc. and affiliates.\n *\n * This source code is licensed under the MIT license found in the\n * LICENSE file in the root directory of this source tree.\n *\n */\n\nimport { AutoFocusPlugin } from '@lexical/react/LexicalAutoFocusPlugin';\nimport { AutoScrollPlugin } from '@lexical/react/LexicalAutoScrollPlugin';\nimport { CheckListPlugin } from '@lexical/react/LexicalCheckListPlugin';\nimport { ClearEditorPlugin } from '@lexical/react/LexicalClearEditorPlugin';\nimport { HashtagPlugin } from '@lexical/react/LexicalHashtagPlugin';\nimport { LinkPlugin } from '@lexical/react/LexicalLinkPlugin';\nimport { ListPlugin } from '@lexical/react/LexicalListPlugin';\nimport { RichTextPlugin } from '@lexical/react/LexicalRichTextPlugin';\nimport { OnChangePlugin } from '@lexical/react/LexicalOnChangePlugin';\nimport React, { ReactNode, useEffect, useState } from 'react';\nimport { useRef } from 'react';\n\nimport { useSettings } from './context/SettingsContext';\nimport { useSharedHistoryContext } from './context/SharedHistoryContext';\nimport ActionsPlugin from './plugins/ActionsPlugin';\nimport AutoLinkPlugin from './plugins/AutoLinkPlugin';\nimport CharacterStylesPopupPlugin from './plugins/CharacterStylesPopupPlugin';\nimport ClickableLinkPlugin from './plugins/ClickableLinkPlugin';\nimport CodeHighlightPlugin from './plugins/CodeHighlightPlugin';\nimport EmojisPlugin from './plugins/EmojisPlugin';\nimport KeywordsPlugin from './plugins/KeywordsPlugin';\nimport ListMaxIndentLevelPlugin from './plugins/ListMaxIndentLevelPlugin';\nimport MarkdownShortcutPlugin from './plugins/MarkdownShortcutPlugin';\nimport SpeechToTextPlugin from './plugins/SpeechToTextPlugin';\nimport TabFocusPlugin from './plugins/TabFocusPlugin';\nimport ContentEditable from './ui/ContentEditable';\nimport Placeholder from './ui/Placeholder';\nimport { HistoryPlugin } from '@lexical/react/LexicalHistoryPlugin';\nimport { useLexicalComposerContext } from '@lexical/react/LexicalComposerContext';\nimport EditorContext from './context/EditorContext';\nimport { LexicalEditor } from 'lexical';\n\ninterface IEditorProps {\n  children?: ReactNode;\n  hashtagsEnabled?: boolean;\n  autoLinkEnabled?: boolean;\n  emojisEnabled?: boolean;\n  actionsEnabled?: boolean;\n  placeholder?: string;\n  listMaxIndent?: number;\n  initialEditorState?: string;\n  isReadOnly?: boolean;\n  onChange?: (editorState: string, editorInstance?: LexicalEditor) => void;\n}\n\nconst Editor = ({\n  children,\n  hashtagsEnabled = false,\n  autoLinkEnabled = false,\n  emojisEnabled = false,\n  actionsEnabled = false,\n  listMaxIndent = 7,\n  placeholder = '',\n  initialEditorState,\n  isReadOnly = false,\n  onChange,\n}: IEditorProps) => {\n  const [editor] = useLexicalComposerContext();\n  const [activeEditor, setActiveEditor] = useState(editor);\n\n  const editorStateRef = useRef(null);\n  const { historyState } = useSharedHistoryContext();\n  const {\n    settings: { isRichText },\n  } = useSettings();\n  const placeholderComponent = <Placeholder>{placeholder}</Placeholder>;\n  const scrollRef = useRef(null);\n\n  useEffect(() => {\n    editor.setReadOnly(isReadOnly);\n  }, []);\n\n  return (\n    <EditorContext.Provider\n      value={{ initialEditor: editor, activeEditor, setActiveEditor }}\n    >\n      {children}\n      <div className={`editor-container`} ref={scrollRef}>\n        <AutoFocusPlugin />\n        <ClearEditorPlugin />\n        {hashtagsEnabled && <HashtagPlugin />}\n        {emojisEnabled && <EmojisPlugin />}\n        <KeywordsPlugin />\n        <SpeechToTextPlugin />\n        {autoLinkEnabled && <AutoLinkPlugin />}\n        <AutoScrollPlugin scrollRef={scrollRef} />\n\n        <>\n          <RichTextPlugin\n            contentEditable={<ContentEditable />}\n            placeholder={placeholderComponent}\n            initialEditorState={initialEditorState}\n          />\n          <OnChangePlugin\n            ignoreInitialChange={false}\n            onChange={(editorState) => {\n              onChange?.(JSON.stringify(editorState), activeEditor);\n              return (editorStateRef.current = editorState);\n            }}\n          />\n          <MarkdownShortcutPlugin />\n          <CodeHighlightPlugin />\n          <ListPlugin />\n          <CheckListPlugin />\n          <ListMaxIndentLevelPlugin maxDepth={listMaxIndent} />\n          <LinkPlugin />\n          <ClickableLinkPlugin />\n          <CharacterStylesPopupPlugin />\n          <TabFocusPlugin />\n        </>\n\n        <HistoryPlugin externalHistoryState={historyState} />\n        {actionsEnabled && <ActionsPlugin isRichText={isRichText} />}\n      </div>\n    </EditorContext.Provider>\n  );\n};\n\nexport default Editor;\n","import { LexicalComposer } from '@lexical/react/LexicalComposer';\nimport React, { useState } from 'react';\nimport PlaygroundNodes from './nodes/PlaygroundNodes';\nimport PlaygroundEditorTheme from './themes/PlaygroundEditorTheme';\nimport './EditorComposer.css';\n\ninterface IEditorComposer {\n  children: React.ReactElement;\n}\n\nconst EditorComposer = ({ children }: IEditorComposer) => {\n  const initialConfig = {\n    namespace: 'VerbumEditor',\n    nodes: [...PlaygroundNodes],\n    onError: (error) => {\n      throw error;\n    },\n    theme: PlaygroundEditorTheme,\n  };\n  return (\n    <LexicalComposer initialConfig={initialConfig}>\n      <div className=\"editor-shell\">{children}</div>\n    </LexicalComposer>\n  );\n};\n\nexport default EditorComposer;\n","import React from 'react';\nimport { useContext } from 'react';\nimport EditorContext from '../../../context/EditorContext';\nimport ToolbarContext from '../../../context/ToolbarContext';\nimport FloatingLinkEditor from './FloatingLinkEditor';\nimport { createPortal } from 'react-dom';\n\nconst InsertLinkButton = () => {\n  const { activeEditor } = useContext(EditorContext);\n  const { isLink, insertLink } = useContext(ToolbarContext);\n\n  return (\n    <>\n      <button\n        onClick={insertLink}\n        className={'toolbar-item spaced ' + (isLink ? 'active' : '')}\n        aria-label=\"Insert link\"\n        title=\"Insert link\"\n        type=\"button\"\n      >\n        <i className=\"format link\" />\n      </button>\n      {isLink &&\n        createPortal(\n          <FloatingLinkEditor editor={activeEditor} />,\n          document.body\n        )}\n    </>\n  );\n};\n\nexport default InsertLinkButton;\n","import { FORMAT_TEXT_COMMAND } from 'lexical';\nimport React from 'react';\nimport { useContext } from 'react';\nimport { IS_APPLE } from '../../../shared/src/environment';\nimport EditorContext from '../../../context/EditorContext';\nimport ToolbarContext from '../../../context/ToolbarContext';\n\nconst ItalicButton = () => {\n  const { activeEditor } = useContext(EditorContext);\n  const { isItalic } = useContext(ToolbarContext);\n\n  return (\n    <button\n      onClick={() => {\n        activeEditor.dispatchCommand(FORMAT_TEXT_COMMAND, 'italic');\n      }}\n      className={'toolbar-item spaced ' + (isItalic ? 'active' : '')}\n      title={IS_APPLE ? 'Italic (⌘I)' : 'Italic (Ctrl+I)'}\n      aria-label={`Format text as italics. Shortcut: ${\n        IS_APPLE ? '⌘I' : 'Ctrl+I'\n      }`}\n      type=\"button\"\n    >\n      <i className=\"format italic\" />\n    </button>\n  );\n};\n\nexport default ItalicButton;\n","import React, { useCallback, useContext } from 'react';\nimport ToolbarContext from '../../../context/ToolbarContext';\nimport ColorPicker from '../../../ui/ColorPicker';\n\nconst TextColorPicker = () => {\n  const { fontColor, applyStyleText } = useContext(ToolbarContext);\n\n  const onFontColorSelect = useCallback(\n    (value: string) => {\n      applyStyleText({ color: value });\n    },\n    [applyStyleText]\n  );\n\n  return (\n    <ColorPicker\n      buttonClassName=\"toolbar-item color-picker\"\n      buttonAriaLabel=\"Formatting text color\"\n      buttonIconClassName=\"icon font-color\"\n      color={fontColor}\n      onChange={onFontColorSelect}\n      title=\"text color\"\n    />\n  );\n};\n\nexport default TextColorPicker;\n","import { FORMAT_TEXT_COMMAND } from 'lexical';\nimport React, { useContext } from 'react';\nimport DropDown from '../../../ui/DropDown';\nimport EditorContext from '../../../context/EditorContext';\nimport ToolbarContext from '../../../context/ToolbarContext';\n\nconst TextFormatDropdown = () => {\n  const { activeEditor } = useContext(EditorContext);\n  const { isStrikethrough, isSubscript, isSuperscript } =\n    useContext(ToolbarContext);\n  return (\n    <DropDown\n      buttonClassName=\"toolbar-item spaced\"\n      buttonLabel=\"\"\n      buttonAriaLabel=\"Formatting options for additional text styles\"\n      buttonIconClassName=\"icon dropdown-more\"\n    >\n      <button\n        onClick={() => {\n          activeEditor.dispatchCommand(FORMAT_TEXT_COMMAND, 'strikethrough');\n        }}\n        className={\n          'item ' + (isStrikethrough ? 'active dropdown-item-active' : '')\n        }\n        title=\"Strikethrough\"\n        aria-label=\"Format text with a strikethrough\"\n        type=\"button\"\n      >\n        <i className=\"icon strikethrough\" />\n        <span className=\"text\">Strikethrough</span>\n      </button>\n      <button\n        onClick={() => {\n          activeEditor.dispatchCommand(FORMAT_TEXT_COMMAND, 'subscript');\n        }}\n        className={'item ' + (isSubscript ? 'active dropdown-item-active' : '')}\n        title=\"Subscript\"\n        aria-label=\"Format text with a subscript\"\n        type=\"button\"\n      >\n        <i className=\"icon subscript\" />\n        <span className=\"text\">Subscript</span>\n      </button>\n      <button\n        onClick={() => {\n          activeEditor.dispatchCommand(FORMAT_TEXT_COMMAND, 'superscript');\n        }}\n        className={\n          'item ' + (isSuperscript ? 'active dropdown-item-active' : '')\n        }\n        title=\"Superscript\"\n        aria-label=\"Format text with a superscript\"\n        type=\"button\"\n      >\n        <i className=\"icon superscript\" />\n        <span className=\"text\">Superscript</span>\n      </button>\n    </DropDown>\n  );\n};\n\nexport default TextFormatDropdown;\n","import { FORMAT_TEXT_COMMAND } from 'lexical';\nimport React from 'react';\nimport { useContext } from 'react';\nimport { IS_APPLE } from '../../../shared/src/environment';\nimport EditorContext from '../../../context/EditorContext';\nimport ToolbarContext from '../../../context/ToolbarContext';\n\nconst UnderlineButton = () => {\n  const { activeEditor } = useContext(EditorContext);\n  const { isUnderline } = useContext(ToolbarContext);\n\n  return (\n    <button\n      onClick={() => {\n        activeEditor.dispatchCommand(FORMAT_TEXT_COMMAND, 'underline');\n      }}\n      className={'toolbar-item spaced ' + (isUnderline ? 'active' : '')}\n      title={IS_APPLE ? 'Underline (⌘U)' : 'Underline (Ctrl+U)'}\n      aria-label={`Format text to underlined. Shortcut: ${\n        IS_APPLE ? '⌘U' : 'Ctrl+U'\n      }`}\n      type=\"button\"\n    >\n      <i className=\"format underline\" />\n    </button>\n  );\n};\n\nexport default UnderlineButton;\n"],"names":["__className","EmojiNode","TextNode","[object Object]","node","__text","__key","constructor","className","text","key","super","createDOM","config","dom","document","createElement","inner","appendChild","updateDOM","prevNode","firstChild","serializedNode","$createEmojiNode","setFormat","format","setDetail","detail","setMode","mode","setStyle","style","exportJSON","this","getClassName","type","getLatest","emojiText","styleInject","css","ref","insertAt","head","getElementsByTagName","insertBefore","styleSheet","cssText","createTextNode","EquationEditor","equation","setEquation","inline","inputRef","React","InlineEquationEditor","BlockEquationEditor","onChange","event","target","value","autoFocus","KatexRenderer","onClick","katexElementRef","useRef","useEffect","katexElement","current","katex","render","displayMode","errorColor","output","strict","throwOnError","trust","role","tabIndex","EquationComponent","nodeKey","editor","useLexicalComposerContext","equationValue","setEquationValue","useState","showEquationEditor","setShowEquationEditor","onHide","useCallback","restoreSelection","update","$getNodeByKey","$isEquationNode","selectNext","mergeRegister","registerCommand","SELECTION_CHANGE_COMMAND","payload","activeElement","COMMAND_PRIORITY_HIGH","KEY_ESCAPE_COMMAND","EquationNode","DecoratorNode","__equation","__inline","$createEquationNode","getEquation","version","_config","getWritable","decorate","url","URL","window","location","href","WEBSOCKET_ID","URLSearchParams","search","get","createWebsocketProvider","id","yjsDocMap","doc","undefined","Doc","set","load","WebsocketProvider","WEBSOCKET_SLUG","connect","hostName","hostname","Context","createContext","setOption","name","settings","disableBeforeInput","emptyEditor","isAutocomplete","isCharLimit","isCharLimitUtf8","isCollab","isRichText","measureTypingPerf","showNestedEditorTreeView","showTreeView","useSettings","useContext","historyState","redoStack","undoStack","useSharedHistoryContext","emojis","Map","findAndTransformEmoji","getTextContent","i","length","emojiData","slice","emojiStyle","targetNode","splitText","emojiNode","replace","textNodeTransform","isSimpleText","EmojisPlugin","hasNodes","Error","registerNodeTransform","useEmojis","INSERT_IMAGE_COMMAND","createCommand","ImagesPlugin","ImageNode","selection","$getSelection","$isRangeSelection","$isRootNode","anchor","getNode","insertParagraph","imageNode","$createImageNode","insertNodes","COMMAND_PRIORITY_EDITOR","DRAGSTART_COMMAND","getImageNodeInSelection","dataTransfer","setData","setDragImage","img","JSON","stringify","data","altText","__altText","caption","__caption","height","__height","getKey","maxWidth","__maxWidth","showCaption","__showCaption","src","__src","width","__width","onDragStart","DRAGOVER_COMMAND","canDropImage","preventDefault","onDragover","COMMAND_PRIORITY_LOW","DROP_COMMAND","dragData","_event$dataTransfer","getData","parse","getDragImageData","range","domSelection","getSelection","caretRangeFromPoint","clientX","clientY","rangeParent","collapse","rangeOffset","getRangeAt","getDragSelection","remove","rangeSelection","$createRangeSelection","applyDOMRange","$setSelection","dispatchCommand","onDrop","$isNodeSelection","getNodes","$isImageNode","HTMLElement","closest","parentElement","KeywordNode","$createKeywordNode","cursor","canInsertTextBefore","canInsertTextAfter","isTextEntity","keyword","KEYWORDS_REGEX","KeywordsPlugin","createKeywordNode","textNode","getKeywordMatch","matchArr","exec","startOffset","index","end","start","useLexicalTextEntity","CAN_USE_DOM","useLayoutEffectImpl","useLayoutEffect","MentionNode","mentionName","__mention","$createMentionNode","setTextContent","mentionNode","toggleDirectionless","CapitalizedNameMentionsRegex","RegExp","PUNC","TRIGGERS","join","VALID_CHARS","AtSignMentionsRegex","AtSignMentionsRegexAliasRegex","mentionsCache","dummyMentionsData","dummyLookupService","string","callback","setTimeout","results","filter","mention","toLowerCase","includes","MentionsTypeaheadItem","isSelected","onMouseEnter","result","liRef","MentionsTypeahead","close","resolution","divRef","match","mentionString","setResults","cachedResults","newResults","useMentionLookupService","matchingString","selectedIndex","setSelectedIndex","div","rootElement","getRootElement","left","top","getBoundingClientRect","display","setAttribute","removeAttribute","applyCurrentSelected","selectedEntry","entryText","isCollapsed","anchorNode","selectionOffset","offset","documentText","triggerOffset","ii","substr","getMentionOffset","replaceableString","nodeToReplace","select","createMentionNodeFromSearchResult","updateSelectedIndex","rootElem","KEY_ARROW_DOWN_COMMAND","SUGGESTION_LIST_LENGTH_LIMIT","stopImmediatePropagation","KEY_ARROW_UP_COMMAND","KEY_TAB_COMMAND","KEY_ENTER_COMMAND","map","MentionsPlugin","setResolution","activeRange","createRange","previousText","removeUpdateListener","registerUpdateListener","getEditorState","read","anchorOffset","getTextUpToAnchor","getMentionsTextToSearch","minMatchLength","leadOffset","checkForAtSignMentions","checkForCapitalizedNameMentions","getPossibleMentionMatch","prevSibling","getPreviousSibling","$isTextNode","isSelectionOnEntityBoundary","endOffset","setStart","setEnd","error","tryToPositionRange","startTransition","closeTypeahead","createPortal","body","useMentions","TableActionMenu","onClose","tableCellNode","_tableCellNode","setIsMenuOpen","contextRef","dropDownRef","updateTableCellNode","selectionCounts","updateSelectionCounts","columns","rows","registerMutationListener","TableCellNode","nodeMutations","$isGridSelection","selectionShape","getShape","toX","fromX","toY","fromY","menuButtonElement","dropDownElement","menuButtonRect","opacity","pageXOffset","pageYOffset","handleClickOutside","contains","addEventListener","removeEventListener","clearTableSelection","isAttached","tableNode","$getTableNodeFromLexicalNodeOrThrow","tableElement","getElementByKey","tableSelection","getTableSelectionFromTableElement","clearHighlight","markDirty","insertTableRowAtSelection","shouldInsertAfter","tableRowIndex","$getTableRowIndexFromTableCellNode","grid","$getElementGridForTableNode","$insertTableRow","insertTableColumnAtSelection","tableColumnIndex","$getTableColumnIndexFromTableCellNode","$insertTableColumn","deleteTableRowAtSelection","$removeTableRowAtIndex","deleteTableAtSelection","deleteTableColumnAtSelection","$deleteTableColumn","toggleTableRowIsHeader","tableRows","getChildren","tableRow","$isTableRowNode","forEach","tableCell","$isTableCellNode","toggleHeaderStyle","TableCellHeaderStates","ROW","toggleTableColumnIsHeader","r","tableCells","COLUMN","e","stopPropagation","__headerState","TableCellActionMenuContainer","menuButtonRef","menuRootRef","isMenuOpen","setTableMenuCellNode","moveMenu","menu","nativeSelection","tableCellNodeFromSelection","$getTableCellNodeFromLexicalNode","menuButtonDOM","tableCellNodeDOM","tableCellRect","menuRect","prevTableCellDOM","TableActionMenuPlugin","TreeViewPlugin","TreeView","viewClassName","timeTravelPanelClassName","timeTravelButtonClassName","timeTravelPanelSliderClassName","timeTravelPanelButtonClassName","LexicalContentEditable","ContentEditable","clamp","min","max","Math","ImageResizer","onResizeStart","onResizeEnd","imageRef","setShowCaption","buttonRef","positioningRef","currentHeight","currentWidth","direction","isResizing","ratio","startHeight","startWidth","startX","startY","editorRootElement","maxWidthContainer","maxHeightContainer","handlePointerDown","image","positioning","cursorDir","setProperty","setStartCursor","handlePointerMove","handlePointerUp","isVertical","diff","floor","onPointerDown","Direction","Placeholder","children","imageCache","Set","LazyImage","has","Promise","resolve","Image","onload","add","useSuspenseImage","alt","draggable","ImageComponent","resizable","setSelected","clearSelection","useLexicalNodeSelection","setIsResizing","useCollaborationContext","setSelection","onDelete","_ref3","editorState","CLICK_COMMAND","shiftKey","KEY_DELETE_COMMAND","KEY_BACKSPACE_COMMAND","isFocused","Suspense","fallback","LexicalNestedComposer","initialEditor","TablePlugin","TableCellActionMenuPlugin","LinkPlugin","HashtagPlugin","CollaborationPlugin","providerFactory","shouldBootstrap","HistoryPlugin","externalHistoryState","RichTextPlugin","contentEditable","placeholder","initialEditorState","nextWidth","nextHeight","setWidthAndHeight","createEditor","nestedEditor","parseEditorState","isEmpty","setEditorState","getAltText","toJSON","getSrc","writable","span","theme","joinClasses","args","Boolean","Button","data-test-id","dataTestId","disabled","small","title","createPollOption","uid","random","toString","votes","cloneOption","option","Array","from","PollOptionComponent","options","totalVotes","withPollNode","clientID","checkboxRef","votesArray","checked","indexOf","toggleVote","setOptionText","deleteOption","PollComponent","question","useMemo","reduce","next","getTotalVotes","cb","PollNode","$isPollNode","addOption","convertPollElement","domNode","$createPollNode","getAttribute","__question","__options","self","push","splice","clonedOption","votesClone","voteIndex","hasAttribute","conversion","priority","exportDOM","element","elem","characterLimit","code","codeHighlight","atrule","attr","boolean","builtin","cdata","char","class","class-name","comment","constant","deleted","doctype","entity","function","important","inserted","namespace","number","operator","prolog","property","punctuation","regex","selector","symbol","tag","variable","hashtag","heading","h1","h2","h3","h4","h5","link","list","listitem","listitemChecked","listitemUnchecked","nested","olDepth","ul","ltr","mark","markOverlap","paragraph","quote","rtl","table","tableCellHeader","bold","italic","strikethrough","subscript","superscript","underline","underlineStrikethrough","baseTheme","positionSticky","stickyElem","rootElementRect","rectLeft","y","x","StickyComponent","color","stickyContainerRef","isDragging","offsetX","offsetY","position","stickyContainer","resizeObserver","ResizeObserver","entries","entry","removeRootListener","registerRootListener","nextRootElem","prevRootElem","unobserve","observe","handleWindowResize","pageX","pageY","classList","$isStickyNode","setPosition","button","stickContainer","toggleColor","initialTheme","StickyEditorTheme","PlainTextPlugin","StickyNode","__x","__y","__color","xOffset","yOffset","isIsolated","convertTweetElement","$createTweetNode","isTwitterScriptLoading","TweetComponent","loadingComponent","onError","onLoad","tweetID","containerRef","previousTweetIDRef","isTweetLoading","setIsTweetLoading","createTweet","twttr","widgets","String","script","async","onerror","BlockWithAlignableContents","TweetNode","DecoratorBlockNode","__id","__format","getId","embedBlockTheme","embedBlock","base","focus","isTopLevel","TypeaheadNode","YouTubeComponent","videoID","frameBorder","allow","allowFullScreen","YouTubeNode","$createYouTubeNode","_editor","PlaygroundNodes","HeadingNode","ListNode","ListItemNode","QuoteNode","CodeNode","TableNode","TableRowNode","HashtagNode","CodeHighlightNode","AutoLinkNode","LinkNode","OverflowNode","HorizontalRuleNode","MarkNode","PortalImpl","closeOnClickOutside","modalRef","modalOverlayElement","handler","keyCode","clickOutsideHandler","_modalRef$current","Modal","useModal","modalContent","setModalContent","content","getContent","TABLE_ROW_REG_EXP","TABLE","export","exportChildren","$isTableNode","row","rowOutput","cell","$isElementNode","regExp","parentNode","_1","matchCells","mapToTableCells","sibling","maxCells","$isParagraphNode","getChildrenSize","getFirstChild","cells","unshift","previousSibling","$createTableNode","$createTableRowNode","append","createTableCell","getTableColumnsSize","selectEnd","textContent","$createTableCellNode","NO_STATUS","$createParagraphNode","$createTextNode","trim","split","PLAYGROUND_TRANSFORMERS","$isHorizontalRuleNode","_2","isImport","line","$createHorizontalRuleNode","getNextSibling","exportFormat","importRegExp","trigger","equationNode","$isTweetNode","tweetNode","CHECK_LIST","ELEMENT_TRANSFORMERS","TEXT_FORMAT_TRANSFORMERS","TEXT_MATCH_TRANSFORMERS","getElement","getElementById","fontSize","transform","padding","background","borderRadius","SPEECH_TO_TEXT_COMMAND","VOICE_COMMANDS","\n","_ref","redo","_ref2","REDO_COMMAND","undo","UNDO_COMMAND","SUPPORT_SPEECH_RECOGNITION","timer","cleanup","isEnabled","setIsEnabled","SpeechRecognition","webkitSpeechRecognition","recognition","report","clearTimeout","removeChild","console","log","innerHTML","continuous","interimResults","resultItem","item","resultIndex","transcript","isFinal","command","insertText","stop","_isEnabled","ActionsPlugin","isReadOnly","setIsReadyOnly","isSpeechToText","setIsSpeechToText","connected","setConnected","isEditorEmpty","setIsEditorEmpty","modal","showModal","registerReadOnlyListener","readOnly","CONNECTED_COMMAND","$getRoot","paragraphChildren","handleMarkdownToggle","root","$isCodeNode","getLanguage","$convertFromMarkdownString","markdown","$convertToMarkdownString","clear","$createCodeNode","importFile","exportFile","fileName","Date","toISOString","source","ShowClearDialog","setReadOnly","TOGGLE_CONNECT_COMMAND","CLEAR_EDITOR_COMMAND","URL_MATCHER","EMAIL_MATCHER","MATCHERS","LexicalAutoLinkPlugin","AutoLinkPlugin","matchers","INSERT_INLINE_COMMAND","FloatingCharacterStylesEditor","isLink","isBold","isItalic","isUnderline","isCode","isStrikethrough","isSubscript","isSuperscript","popupCharStylesEditorRef","mouseDownRef","insertLink","TOGGLE_LINK_COMMAND","updateCharacterStylesEditor","popupCharStylesEditorElem","rect","domRange","firstElementChild","offsetWidth","bottom","setPopupPosition","onResize","FORMAT_TEXT_COMMAND","getSelectedNode","focusNode","isBackward","$isAtNodeEnd","CharacterStylesPopupPlugin","isText","setIsText","setIsLink","setIsBold","setIsItalic","setIsUnderline","setIsStrikethrough","setIsSubscript","setIsSuperscript","setIsCode","updatePopup","hasFormat","parent","getParent","$isLinkNode","$isCodeHighlightNode","useCharacterStylesPopup","ClickableLinkPlugin","newTab","hasMoved","prevOffsetX","prevOffsetY","onPointerUp","hasMovedDuringClick","linkDomNode","isLinkDomNode","getLinkDomNode","linkNode","maybeLinkNode","$getNearestNodeFromDOMNode","open","metaKey","ctrlKey","prevRootElement","nodeName","CodeHighlightPlugin","registerCodeHighlighting","ListMaxIndentLevelPlugin","maxDepth","INDENT_CONTENT_COMMAND","elementNodesInSelection","nodesInSelection","getParentOrThrow","n","getElementNodesInSelection","totalDepth","elementNode","$isListNode","$getListDepth","$isListItemNode","isIndentPermitted","COMMAND_PRIORITY_CRITICAL","MarkdownPlugin","MarkdownShortcutPlugin","transformers","lastTabKeyDownTimestamp","hasRegisteredKeyDownListener","TabFocusPlugin","timeStamp","FOCUS_COMMAND","clone","EditorContext","ToolbarContext","DropDown","buttonLabel","buttonAriaLabel","buttonClassName","buttonIconClassName","stopCloseOnClickSelf","showDropDown","setShowDropDown","dropDown","innerWidth","handle","Divider","AlignDropdown","activeEditor","isRTL","FORMAT_ELEMENT_COMMAND","OUTDENT_CONTENT_COMMAND","TextInput","label","FileInput","accept","files","INSERT_EQUATION_COMMAND","EquationsPlugin","INSERT_YOUTUBE_COMMAND","YouTubePlugin","youTubeNode","getTopLevelElementOrThrow","insertAfter","paragraphNode","KatexEquationAlterer","onConfirm","initialEquation","setInline","onCheckboxChange","TableCellResizer","targetRef","resizerRef","tableRectRef","mouseStartPosRef","mouseCurrentPos","updateMouseCurrentPos","activeCell","updateActiveCell","isSelectingGrid","updateIsSelectingGrid","draggingDirection","updateDraggingDirection","isGridSelection","resetState","onMouseMove","getCellFromTarget","isHeightChanging","updateRowHeight","newHeight","setHeight","updateColumnWidth","newWidth","setWidth","toggleResize","heightChange","abs","widthChange","resizerStyles","styles","backgroundColor","right","tableRect","getResizers","onMouseDown","onMouseUp","TableCellResizerPlugin","HorizontalRulePlugin","INSERT_HORIZONTAL_RULE_COMMAND","horizontalRuleNode","YOUTUBE_ID_PARSER","parseYouTubeVideoID","urlMatches","InsertImageDialog","InsertImageUriDialogBody","InsertImageUploadedDialogBody","InsertTableDialog","setRows","setColumns","INSERT_TABLE_COMMAND","setSrc","setAltText","isDisabled","reader","FileReader","readAsDataURL","InsertYouTubeDialog","setText","InsertEquationDialog","onEquationConfirm","InsertDropdown","_ref7","enableTable","enableImage","enableYoutube","enableTwitter","enablePoll","enableEquations","enableExcalidraw","enableHorizontalRule","enableStickyNote","stickyNode","IS_APPLE","test","navigator","platform","UndoButton","canUndo","RedoButton","canRedo","Select","CODE_LANGUAGE_OPTIONS","CodeLanguageDropdown","selectedElementKey","codeLanguage","onCodeLanguageSelect","setLanguage","blockTypeToBlockName","bullet","check","BlockFormatDropdown","blockType","formatHeading","headingSize","$wrapLeafNodesInElements","$createHeadingNode","INSERT_UNORDERED_LIST_COMMAND","REMOVE_LIST_COMMAND","INSERT_ORDERED_LIST_COMMAND","INSERT_CHECK_LIST_COMMAND","$createQuoteNode","codeNode","removeText","insertRawText","supportedBlockTypes","CODE_LANGUAGE_MAP","javascript","md","plaintext","python","basicColors","ColorPicker","rest","selfColor","setSelfColor","transformColor","saturationPosition","hsv","s","v","huePosition","h","hex","basicColor","MoveWrapper","newColor","move","_e","toHex","startsWith","ctx","getContext","fillStyle","hex2rgb","rbgArr","m","g","b","substring","parseInt","rgb2hsv","d","rgb2hex","padStart","rgb","f","p","q","t","round","hsv2rgb","PREVIEW_CACHE","LinkPreviewContent","preview","cached","fetch","encodeURI","then","response","json","catch","useSuspenseRequest","domain","description","Glimmer","props","animationDelay","LinkPreview","positionEditorElement","FloatingLinkEditor","editorRef","linkUrl","setLinkUrl","isEditMode","setEditMode","lastSelection","setLastSelection","updateLinkEditor","getURL","editorElem","onKeyDown","rel","defaultFontFamilyOptions","defaultFontSizeOptions","bgColor","applyStyleText","onBgColorSelect","background-color","hashtagsEnabled","autoLinkEnabled","emojisEnabled","actionsEnabled","listMaxIndent","setActiveEditor","editorStateRef","placeholderComponent","scrollRef","Provider","AutoFocusPlugin","ClearEditorPlugin","SpeechToTextPlugin","AutoScrollPlugin","OnChangePlugin","ignoreInitialChange","ListPlugin","CheckListPlugin","initialConfig","nodes","PlaygroundEditorTheme","LexicalComposer","fontOptions","fontFamily","onFontFamilySelect","font-family","fontSizeOptions","onFontSizeSelect","font-size","fontColor","onFontColorSelect","defaultFontSize","defaultFontColor","defaultBgColor","defaultFontFamily","insertExists","InsertComponent","useChild","alignExists","AlignComponent","setBlockType","setSelectedElementKey","setFontSize","setFontColor","setBgColor","setFontFamily","setCanUndo","setCanRedo","setIsRTL","setCodeLanguage","updateToolbar","elementKey","elementDOM","$isParentElementRTL","parentList","$getNearestNodeOfType","getListType","$isHeadingNode","getTag","getType","language","$getSelectionStyleValueForProperty","_payload","newEditor","CAN_UNDO_COMMAND","CAN_REDO_COMMAND","$patchStyleText"],"mappings":"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C,GACR,IAAMC,EAAMH,MAAMC,UAAUC,GAG5B,OAFAC,EAAIiB,MAAMe,QArCO,4CAsCjBhC,EAAIN,UAAY,UACTM,EAGTgP,eACE,OAAO,YAIKoB,GAAmBF,GACjC,IAAMI,EAAc,IAAIL,GAAYC,GAEpC,OADAI,EAAYxP,QAAQ,aAAayP,sBAC1BD,EC3BT,IASME,GAA+B,IAAIC,OACvC,iGAGIC,GAZJ,+DAcIC,GAAW,CAAC,IAAK,WAAWC,KAAK,IAGjCC,GAAc,KAAOF,GAAWD,GAAO,OAevCI,GAAsB,IAAIL,OAC9B,gBAEEE,GAFF,QAKEE,GAhBF,kBAIAH,GAOA,iBAiBIK,GAAgC,IAAIN,OACxC,gBAEEE,GAFF,QAKEE,GALF,cAeIG,GAAgB,IAAInI,IAEpBoI,GAAoB,CACxB,eACA,aACA,sBACA,uBACA,sBACA,gBACA,iBACA,2BACA,iBACA,uBACA,aACA,eACA,2BACA,UACA,QACA,eACA,OACA,OACA,eACA,QACA,eACA,iBACA,aACA,QACA,WACA,SACA,kBACA,kBACA,gBACA,cACA,eACA,OACA,QACA,iBACA,eACA,YACA,cACA,oBACA,kBACA,iBACA,YACA,UACA,aACA,iBACA,YACA,QACA,wBACA,cACA,cACA,OACA,QACA,SACA,WACA,eACA,iBACA,iBACA,wBACA,cACA,kBACA,gBACA,gBACA,eACA,gBACA,uBACA,YACA,uBACA,eACA,eACA,YACA,cACA,iBACA,cACA,eACA,iBACA,iBACA,gBACA,2BACA,0BACA,gBACA,iBACA,gBACA,mBACA,sBACA,aACA,kBACA,QACA,gBACA,cACA,eACA,aACA,OACA,aACA,aACA,gBACA,iBACA,YACA,cACA,SACA,eACA,gBACA,kBACA,kBACA,KACA,eACA,gBACA,QACA,QACA,WACA,YACA,gBACA,aACA,WACA,kBACA,iBACA,YACA,iBACA,SACA,YACA,OACA,YACA,OACA,WACA,aACA,SACA,iBACA,aACA,eACA,cACA,QACA,gBACA,gBACA,OACA,QACA,UACA,UACA,sBACA,UACA,OACA,QACA,aACA,cACA,yBACA,oBACA,iBACA,eACA,cACA,cACA,eACA,aACA,mBACA,sBACA,SACA,eACA,WACA,WACA,QACA,aACA,WACA,iBACA,YACA,gBACA,OACA,eACA,SACA,cACA,QACA,aACA,cACA,oBACA,QACA,iBACA,cACA,aACA,kBACA,gBACA,YACA,SACA,mBACA,kBACA,OACA,iBACA,aACA,eACA,YACA,aACA,kBACA,cACA,SACA,WACA,QACA,eACA,SACA,mBACA,cACA,aACA,eACA,gBACA,YACA,gBACA,SACA,YACA,aACA,WACA,QACA,UACA,mBACA,oBACA,cACA,gBACA,8BACA,mBACA,QACA,SACA,WACA,iBACA,gBACA,cACA,WACA,iBACA,QACA,kBACA,cACA,SACA,YACA,aACA,WACA,gBACA,WACA,aACA,WACA,WACA,mBACA,aACA,SACA,cACA,kBACA,eACA,gBACA,eACA,aACA,eACA,aACA,gBACA,cACA,SACA,gBACA,cACA,kBACA,YACA,iBACA,QACA,eACA,cACA,aACA,iBACA,WACA,eACA,MACA,gBACA,OACA,QACA,gBACA,eACA,cACA,YACA,aACA,YACA,aACA,gBACA,eACA,aACA,SACA,0BACA,kBACA,WACA,UACA,cACA,oBACA,aACA,iBACA,SACA,UACA,eACA,iBACA,iBACA,kBACA,eACA,WACA,cACA,QACA,QACA,QACA,SACA,QACA,OACA,OACA,eACA,mBACA,cACA,gBACA,kBACA,WACA,gBACA,MACA,WACA,cACA,QACA,eACA,aACA,iBACA,QACA,eACA,YACA,iBACA,OACA,aACA,cACA,iBACA,gBACA,OACA,cACA,QACA,cACA,cACA,qBACA,WACA,eACA,cACA,SACA,eACA,gBACA,UACA,iBACA,iBACA,iBACA,WACA,YACA,iBACA,UACA,eACA,YACA,WACA,oBACA,aACA,gBACA,YACA,YACA,eACA,cACA,QACA,gBACA,YACA,eACA,cACA,mBACA,UACA,aACA,UACA,QACA,eACA,QACA,QACA,kBACA,eACA,SACA,UACA,eACA,YACA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"}